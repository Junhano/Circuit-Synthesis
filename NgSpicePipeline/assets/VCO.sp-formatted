nmos:VCO

.include ../assets/45nm_CS.pm

.option TEMP=27C

L2 net16 net18 590.00p
L0 0 ouputn 590.00p
L1 0 ouputp 590.00p
mn3 net1 net1 vdd! 0 PMOS w=2u l=1u
C6 net16 net18 400f ic=200.0m
C0 ouputn 0 80f
C1 ouputp 0 80f ic=200.0m
V2 vctrl 0 dc 0
V0 vdd! 0 dc 1.2
mp2 net18 net1 vdd! vdd! PMOS w=100u l=1u
mp1 ouputp ouputn net16 vdd! PMOS w=4u l=65n
mp0 ouputn ouputp net16 vdd! PMOS w=4u l=65n
R0 0 net1 5.0K
mp4 ouputn vctrl ouputn ouputn PMOS w=15u l=65n
mp5 ouputp vctrl ouputp ouputp PMOS w=15u l=65n

.control
set w_array = ( 4.800130389713028e-06 4.880469612800375e-06 4.800363673707691e-06 4.88073324717307e-06 4.880711477475601e-06 4.880436916549771e-06 4.880476243800179e-06 4.880703991535572e-06 4.829919457781939e-06 4.880512547481493e-06 4.800363673707691e-06 4.880512547481493e-06 4.8001546095440715e-06 4.880731891780028e-06 4.800134257796247e-06 4.15303262792555e-06 4.880731891780028e-06 4.800363673707691e-06 4.800125155810667e-06 4.8303779559696165e-06 4.880512547481493e-06 4.800125155810667e-06 4.800152388784704e-06 4.15303262792555e-06 4.880579045149335e-06 4.881086400043113e-06 4.881138071796299e-06 4.800123185277707e-06 4.8000740991974e-06 4.880579045149335e-06 4.880169758155169e-06 4.88055443955258e-06 4.88144655925257e-06 4.880533775021745e-06 4.829919457781939e-06 4.88055443955258e-06 4.8001630755375316e-06 4.800134257796247e-06 4.880436916549771e-06 4.880533775021745e-06 4.800134174387444e-06 4.881086400043113e-06 4.88073324717307e-06 4.800243168840191e-06 4.800149792685724e-06 4.8001630755375316e-06 4.880731891780028e-06 4.800363673707691e-06 4.800243168840191e-06 4.880512547481493e-06 )
set w1_array = ( 9.261600777670813e-06 4.82492312178792e-06 9.268060865113524e-06 4.8251926390053076e-06 4.825235338334982e-06 4.8247970457727254e-06 4.8252298671116805e-06 4.82279529168242e-06 8.876690465402753e-06 4.825238430765543e-06 9.268060865113524e-06 4.825238430765543e-06 9.267693579514542e-06 4.824990084803537e-06 9.262607244878903e-06 7.923944723145296e-06 4.824990084803537e-06 9.268060865113524e-06 9.266176861263825e-06 8.88108028952426e-06 4.825238430765543e-06 9.266176861263825e-06 9.266937123423375e-06 7.923944723145296e-06 4.825181577619069e-06 4.824210792302071e-06 4.82373098980651e-06 9.265110210599426e-06 9.257395309986618e-06 4.825181577619069e-06 4.82435042743588e-06 4.824618874196535e-06 4.820968259918833e-06 4.825272447501718e-06 8.876690465402753e-06 4.824618874196535e-06 9.268267344323315e-06 9.262607244878903e-06 4.8247970457727254e-06 4.825272447501718e-06 9.264607095935016e-06 4.824210792302071e-06 4.8251926390053076e-06 9.257683143908099e-06 9.266929987045156e-06 9.268267344323315e-06 4.824990084803537e-06 9.268060865113524e-06 9.257683143908099e-06 4.825238430765543e-06 )
set w2_array = ( 1.5995744986704093e-05 1.7196776046869042e-05 1.599452511670664e-05 1.719663145487699e-05 1.7196593474491982e-05 1.7196869831767113e-05 1.7196534504946837e-05 1.7198416866133674e-05 1.7027033876975083e-05 1.7196543666881817e-05 1.599452511670664e-05 1.7196543666881817e-05 1.5994610405992275e-05 1.7196784126029887e-05 1.5995464714784017e-05 1.5151615354595337e-05 1.7196784126029887e-05 1.599452511670664e-05 1.5994776361950893e-05 1.703073929664234e-05 1.7196543666881817e-05 1.5994776361950893e-05 1.5994824295528905e-05 1.5151615354595337e-05 1.7196604552104276e-05 1.719755381185854e-05 1.7197916624483755e-05 1.5994839704237732e-05 1.5995155874284866e-05 1.7196604552104276e-05 1.7197189000265696e-05 1.7197019254597606e-05 1.7200045358431242e-05 1.7196515681334968e-05 1.7027033876975083e-05 1.7197019254597606e-05 1.599471768392186e-05 1.5995464714784017e-05 1.7196869831767113e-05 1.7196515681334968e-05 1.5994926909200682e-05 1.719755381185854e-05 1.719663145487699e-05 1.5995164661413416e-05 1.5994755581016553e-05 1.599471768392186e-05 1.7196784126029887e-05 1.599452511670664e-05 1.5995164661413416e-05 1.7196543666881817e-05 )

set i = 50
let index = 1
repeat $i
    alter @mp1[w] = w_array[$&index]
    alter @mp0[w] = w_array[$&index]
    alter @mp5[w]= w2_array[$&index]
    alter @mp4[w]= w2_array[$&index]
    alter @mn3[w] = w1_array[$&index]

    op
    let gm = @mp1[gm]
    let rs = (590p*20G)/15
    let vn = (1.38e-23)*300*gm*15*rs*rs*10k
    let ib = @mp2[id]
    let Va =  ib*15*15*rs
    let Pnoise = (8*vn)/(Va*Va)
    let dbpn = db(Pnoise)
    let pw = ib*1.2
    print pw >> ../out/power-test.csv
    print dbpn >> ../out/pnoise-test.csv

    tran 1ns 100ns
    meas tran tdiff1 TRIG v(ouputn) VAL=0 RISE=1 TARG v(ouputn) VAL=0 RISE=2
    let f1 = 1/tdiff1
    alter V2 dc = 1
    tran 1ns 100ns
    meas tran tdiff2 TRIG v(ouputn) VAL=0 RISE=1 TARG v(ouputn) VAL=0 RISE=2
    let f2 = 1/tdiff2
    let ft = abs(tran1.f1-f2)
    print ft >> ../out/tuningrange-test.csv

    print $w_array[$&index] >> ../out/w-test.csv
    print $w1_array[$&index] >> ../out/w1-test.csv
    print $w2_array[$&index] >> ../out/w2-test.csv

end
.endc
.end