nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 715.0229570269585 714.9880603700876 715.0577335432172 715.0489660724998 715.0687641277909 715.0587421655655 715.0736004859209 715.0809570029378 715.0725136324763 715.0741481035948 715.0594434514642 715.053830370307 715.0711417943239 715.0338842347264 715.0559677556157 714.9745487421751 715.0716195628047 715.0439704582095 715.0194086879492 715.0734943151474 715.0679678469896 715.0556324794888 715.0256979092956 715.0760927051306 715.0771683827043 715.0735948979855 715.0342334806919 714.9962271377444 715.0779646635056 715.0480161234736 715.0238259509206 715.0669787824154 715.0008008629084 715.0726225972176 715.0713681057096 715.0674621388316 715.0708959251642 715.0644865632057 715.0697895139456 715.0729634612799 715.0090933591127 715.0588818639517 715.0694877654314 714.9984986335039 715.0719045475125 714.9872305616736 715.0739217922091 715.0599854812026 715.0740335509181 715.0166370719671 715.0857682153583 715.066213235259 715.0723487883806 715.09068839252 715.002169907093 715.0523747131228 715.0387457385659 715.0173383578658 715.0715329498053 715.0691301375628 715.070169493556 715.0888220220804 715.0567053630948 715.0155474245548 715.0719073414803 715.0744079425931 715.0181709602475 715.0683813542128 715.0374744832516 715.0732372701168 715.0527155771852 715.0470997020602 715.0716055929661 715.0655343011022 715.0588203966618 715.0723739340901 714.9997587129474 715.0370470061898 715.0395615771413 715.0712312012911 715.0387485325336 715.0667133554816 715.0720302760601 715.0704377144575 715.0660344213247 715.0531458482146 715.0679678469896 715.0939014554024 715.0712814927101 715.0728405267 715.0683506205678 715.0730808079243 715.019562356174 714.9695838615298 715.0633578002453 715.0697923079133 715.0692670419812 714.9971854686737 715.0408523902297 715.0731199234724 715.0719716027379 714.9846237897873 714.9722884222865 715.0602676719427 715.0549256056547 714.9917735531926 715.0611868873239 715.0702896341681 715.0276033952832 715.0727818533778 714.984757900238 715.072890818119 715.0738267973065 715.0728768482804 715.0597340241075 715.0893389061093 715.0734859332442 715.0677610933781 715.0701331719756 715.0655985623598 715.029740780592 715.0682919472456 715.0384048745036 715.0787944719195 715.0550373643637 715.0677275657654 715.0526820495725 715.0640199705958 715.0695855543017 715.0534615665674 715.0657326728106 715.0419895350933 715.0714686885476 715.0641037896276 715.0228005647659 715.0727958232164 715.0402209535241 715.0459457933903 715.0727762654424 715.019512064755 715.0714631006122 715.0295032933354 715.0455714017153 715.0630225241184 715.0690491124988 715.0732288882136 715.07059417665 715.0634527951479 715.0691552832723 715.0757294893265 715.0663305819035 715.0703203678131 715.07652297616 715.0622737407684 715.072365552187 715.0637293979526 715.0697783380747 715.0669983401895 715.0154412537813 715.0549200177193 715.056308619678 715.0495388358831 715.0718626379967 715.0725667178631 )
set w1_array = ( 613.4602484107018 613.5143411159515 613.4239000082016 613.4358283877373 613.4327811002731 613.4235610067844 613.4579446911812 613.518128246069 613.4570677578449 613.4647478163242 613.4354290366173 613.4259079396725 613.4277169406414 613.4444524347782 613.4241741895676 613.5403138399124 613.4294022619724 613.4349581599236 613.4637598693371 613.4653073549271 613.4518463909626 613.4248588979244 613.4590876102448 613.4850916266441 613.4966012835503 613.4727869927883 613.4476763010025 613.5034036636353 613.502389639616 613.4310555458069 613.4595003724098 613.4221684932709 613.4926018118858 613.4374138712883 613.4568017721176 613.4220887720585 613.4425853192806 613.4199556708336 613.4235453605652 613.4591710567474 613.4843949973583 613.4225372970104 613.4228092432022 613.4959381818771 613.436162173748 613.5171350836754 613.4622906148434 613.4358537197113 613.4635326266289 613.4684321284294 613.5444191098213 613.4242881834507 613.446946144104 613.5635432600975 613.4904247522354 613.4347376227379 613.4399403631687 613.465518951416 613.4302859008312 613.4342749416828 613.4246972203255 613.5561165213585 613.4285894036293 613.4715330600739 613.4414744377136 613.4726692736149 613.4675961732864 613.4234440326691 613.4437200427055 613.4444643557072 613.4272721409798 613.4313431382179 613.4350706636906 613.4267915785313 613.4225961565971 613.4344865381718 613.4926554560661 613.4419400990009 613.4392213821411 613.4310898184776 613.4407651424408 613.4353932738304 613.4511594474316 613.4403344988823 613.433578312397 613.4263564646244 613.4385977685452 613.5749381780624 613.4274464845657 613.4453658759594 613.4524767100811 613.4405967593193 613.4654496610165 613.5565903782845 613.4223227202892 613.4458255767822 613.4436529874802 613.5052871704102 613.4397846460342 613.45433562994 613.4429533779621 613.5221508145332 613.5507833957672 613.4244185686111 613.4345126152039 613.5154438018799 613.4245094656944 613.4393860399723 613.4521667659283 613.4369325637817 613.5251072049141 613.4445798397064 613.4745773673058 613.4592545032501 613.4233166277409 613.5583971440792 613.4586569666862 613.4232249855995 613.438421189785 613.4262655675411 613.4534549713135 613.4262841939926 613.4399276971817 613.5067191720009 613.4254862368107 613.4224158525467 613.427386879921 613.4307910501957 613.4265695512295 613.4264808893204 613.423742800951 613.4372536838055 613.427774310112 613.4199742972851 613.4610314667225 613.4433877468109 613.4381775557995 613.4340454638004 613.4395529329777 613.4643864631653 613.429759144783 613.4505388140678 613.4345550835133 613.4251844882965 613.4249222278595 613.4479251503944 613.429609388113 613.4385769069195 613.4229709208012 613.4956356883049 613.4335336089134 613.4410087764263 613.4889398515224 613.4296980500221 613.4535376727581 613.4401772916317 613.4301972389221 613.4352844953537 613.468139320612 613.4265613555908 613.4242270886898 613.4294231235981 613.4496313333511 613.4366956353188 )
set r_array = ( 2.9795189999230203e-06 2.979301559384912e-06 2.979687189795077e-06 2.9797092761099337e-06 2.9798866790905594e-06 2.979699357524514e-06 2.980009082816541e-06 2.9801251023262736e-06 2.9799974738806486e-06 2.9800267965719104e-06 2.97981716517359e-06 2.979643471185118e-06 2.979874064326286e-06 2.979499386269599e-06 2.9796407121419904e-06 2.979066460970789e-06 2.9798889561742544e-06 2.979519935902208e-06 2.9793466889485714e-06 2.98002305265516e-06 2.979950018338859e-06 2.9796630219742654e-06 2.9793255735374986e-06 2.9800727992504835e-06 2.9800912953168152e-06 2.980038251839578e-06 2.979402505438775e-06 2.979115069024265e-06 2.9800993279740212e-06 2.9795590444654225e-06 2.9793437552824614e-06 2.9797944083064793e-06 2.9792029532790184e-06 2.9799342673458155e-06 2.9799893364496526e-06 2.979801665637642e-06 2.979944514222443e-06 2.9797301121242343e-06 2.979833628628403e-06 2.9800073575414715e-06 2.9791784362122414e-06 2.979675238598138e-06 2.979825330544263e-06 2.9793653666228053e-06 2.9799250402674077e-06 2.9790979420021175e-06 2.980020293612033e-06 2.9798241500928996e-06 2.9800236184336243e-06 2.9794781451299783e-06 2.980150848738849e-06 2.9798064363375307e-06 2.979968472495675e-06 2.9801686882227656e-06 2.979214094225317e-06 2.979740973673761e-06 2.979504373501986e-06 2.9794252902455627e-06 2.9798907722532747e-06 2.979896416068077e-06 2.9798449930921194e-06 2.980163477472961e-06 2.979740666337311e-06 2.9792756453342736e-06 2.979948132410645e-06 2.980043239071965e-06 2.9792969493381676e-06 2.9798217961750924e-06 2.9794326802901924e-06 2.979965217523277e-06 2.9796617646887897e-06 2.979577624350786e-06 2.979916581530124e-06 2.979822550546378e-06 2.9796536761522293e-06 2.9799203603714703e-06 2.97924887213856e-06 2.979566322751343e-06 2.9795850143954156e-06 2.9798970586806534e-06 2.9794726410135625e-06 2.9798814264312387e-06 2.979979983642697e-06 2.9799320950359105e-06 2.979867715034634e-06 2.9796362697333094e-06 2.979906208924949e-06 2.980177461281419e-06 2.979875503219664e-06 2.9799662093818187e-06 2.979955766927451e-06 2.979951918236911e-06 2.9793079994805158e-06 2.9788850416615605e-06 2.979758058786392e-06 2.979947517737746e-06 2.9799356224201617e-06 2.9790724051371217e-06 2.9794647201150656e-06 2.979995497148484e-06 2.979952952004969e-06 2.979077420309186e-06 2.9789091605879363e-06 2.9797451925650236e-06 2.9797667550109327e-06 2.9790225607529283e-06 2.979757290445268e-06 2.979927484989166e-06 2.9794963129051028e-06 2.97993564337492e-06 2.979017908796668e-06 2.9799651197344064e-06 2.9800426593236624e-06 2.9800061701051888e-06 2.9797118186205625e-06 2.9801646299846468e-06 2.9800083982944486e-06 2.9798111022636293e-06 2.979922609515488e-06 2.9798216704465446e-06 2.9793614131584764e-06 2.9798446089215573e-06 2.9795364831760523e-06 2.980107514299452e-06 2.979609615281224e-06 2.9798071976937352e-06 2.979583100527525e-06 2.9798343201354145e-06 2.9798535146936774e-06 2.9795906512252984e-06 2.979797418806702e-06 2.9795023059658706e-06 2.979880043417215e-06 2.9797240911237895e-06 2.9793357226252554e-06 2.9799604747630655e-06 2.979516394548118e-06 2.9795137682184574e-06 2.979943494424224e-06 2.9794959007948637e-06 2.979887559190392e-06 2.9794271412491796e-06 2.9796353966183958e-06 2.9797834978625176e-06 2.9798383853584525e-06 2.979978712387383e-06 2.9798812657780944e-06 2.979869419354945e-06 2.979820350296795e-06 2.980079770199954e-06 2.979871368147433e-06 2.9799320740811527e-06 2.9800790018588304e-06 2.9798096563853324e-06 2.97998936438933e-06 2.9798763274401423e-06 2.9798809514567253e-06 2.9798848350718616e-06 2.979412326235324e-06 2.9796859883889554e-06 2.9796230472810566e-06 2.9795732657611367e-06 2.9799744655564425e-06 2.979931005388498e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
