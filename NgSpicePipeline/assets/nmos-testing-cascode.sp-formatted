nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 6.118005469441413e-06 5.023462042212486e-06 6.790746092796325e-06 4.955246984958649e-06 5.7758178543299435e-06 5.762501088902354e-06 5.696061933413148e-06 5.332816496491432e-06 5.6107929497957225e-06 4.683934211730957e-06 4.201486349105835e-06 5.786801810376346e-06 4.423979163169861e-06 5.242655828595161e-06 6.537856966257095e-06 4.993078649044037e-06 5.789895886555314e-06 6.7840927839279176e-06 4.813532829284668e-06 5.878778420388699e-06 5.3177947849035265e-06 6.005843088030815e-06 5.508034102618694e-06 5.996267713606358e-06 5.807282943278551e-06 5.5259804278612135e-06 5.407849259674549e-06 5.5106142982840536e-06 6.011374786496163e-06 4.324105143547058e-06 4.661059975624084e-06 4.523096263408661e-06 5.783072307705879e-06 5.238989070057869e-06 6.76570588350296e-06 6.037100367248058e-06 4.643239021301269e-06 4.346319556236267e-06 5.777159182354808e-06 6.0101616457104685e-06 6.8915921449661255e-06 5.508320897817611e-06 5.522950515151024e-06 5.242219880223274e-06 6.487180694937706e-06 7.158168494701385e-06 4.268145859241485e-06 4.9938736557960505e-06 6.721359938383103e-06 6.7429696023464205e-06 4.76159006357193e-06 6.1743071824312206e-06 6.7814350724220275e-06 4.349066942930221e-06 4.366422533988952e-06 6.677254855632782e-06 5.931700639426708e-06 7.158764660358429e-06 5.242291450500488e-06 6.986305415630341e-06 4.939129501581192e-06 4.371703624725342e-06 6.564583122730255e-06 4.339421719312668e-06 5.26951752603054e-06 5.242909923195839e-06 6.771966874599457e-06 7.135778486728668e-06 6.981746733188629e-06 6.580273061990738e-06 4.728636175394058e-06 5.2629865705966945e-06 6.259852662682533e-06 7.097280025482177e-06 6.492028340697288e-06 5.351421639323234e-06 5.73686152882874e-06 6.114353083074093e-06 6.82677960395813e-06 6.772951155900955e-06 4.968831837177276e-06 6.706270277500153e-06 5.1450231969356535e-06 6.043037638068199e-06 4.973357617855072e-06 4.9725147783756255e-06 6.98097425699234e-06 4.26184731721878e-06 6.803113222122192e-06 4.740852922201157e-06 6.522515892982483e-06 5.227024272084236e-06 4.520017981529235e-06 4.3040397167205805e-06 7.1763808727264405e-06 4.216898679733276e-06 5.791029807180166e-06 6.295949250459671e-06 5.762965345755219e-06 4.710324466228485e-06 5.800838796421885e-06 5.535685285925865e-06 6.175039649009705e-06 6.398616656661033e-06 4.3083695173263546e-06 4.476373076438904e-06 5.808314565569162e-06 6.513543993234634e-06 6.972776174545288e-06 6.5745187401771545e-06 6.978819727897644e-06 5.91406936198473e-06 5.312936812639236e-06 5.773101402446627e-06 6.968049585819244e-06 6.967192173004151e-06 4.17710417509079e-06 5.0771484225988385e-06 5.265572801232338e-06 6.036479011178017e-06 6.514741599559784e-06 5.121080324053764e-06 6.025081388652325e-06 6.245029345154762e-06 6.729875952005386e-06 6.566121369600296e-06 7.139879316091537e-06 6.031674638390541e-06 7.161922961473465e-06 4.225837409496307e-06 6.222668394446373e-06 4.696393698453903e-06 6.9556407928466794e-06 4.33834159374237e-06 6.558244705200195e-06 6.2722506821155545e-06 6.805763065814972e-06 6.761729061603546e-06 6.557671070098877e-06 4.1859052181243894e-06 4.161234438419342e-06 4.3301865160465236e-06 5.773115070536732e-06 5.538482114672661e-06 6.801089316606522e-06 5.9664031267166135e-06 5.7125899232923984e-06 6.596879959106445e-06 5.242236196994782e-06 6.642061591148376e-06 6.592048674821854e-06 6.360328391194343e-06 6.986177742481232e-06 6.9812912940979004e-06 4.703366100788116e-06 6.847283124923706e-06 6.208958640694618e-06 6.83622008562088e-06 6.446636602282524e-06 6.512140393257141e-06 5.762915724888444e-06 6.981319636106491e-06 4.968973278999329e-06 6.197694480419159e-06 6.507644832134246e-06 6.700587749481201e-06 4.365814745426178e-06 5.5972591042518615e-06 5.274731248617172e-06 4.220559179782867e-06 5.291740834712982e-06 4.872474014759064e-06 6.445130631327629e-06 4.255653381347656e-06 6.055494464933872e-06 4.733314394950867e-06 6.243344828486442e-06 4.4484455585479735e-06 4.3430360853672024e-06 5.505003049969673e-06 5.501680463552475e-06 4.315515637397766e-06 4.9875318408012385e-06 )
set w1_array = ( 7.049337714910507e-06 7.1423476934432975e-06 7.094612866640091e-06 7.087893038988113e-06 7.085151016712188e-06 7.113341033458709e-06 7.079793661832809e-06 7.134950429201125e-06 7.068590968847274e-06 7.086989760398864e-06 7.093050211668014e-06 7.105400532484054e-06 7.104358762502669e-06 7.038141727447509e-06 7.06999984383583e-06 7.1407716274261465e-06 7.229059487581253e-06 7.065030515193938e-06 7.1307872831821435e-06 7.058571577072143e-06 7.099037796258926e-06 7.191888630390166e-06 7.102776974439621e-06 7.264368444681167e-06 7.13453397154808e-06 7.168122023344039e-06 7.112121611833572e-06 7.207776516675948e-06 7.114210069179534e-06 7.111621111631393e-06 7.083008021116256e-06 7.134398967027663e-06 7.082161426544189e-06 7.116684406995773e-06 7.053524106740951e-06 7.111114174127578e-06 7.122458666563034e-06 7.155285954475402e-06 7.19870314002037e-06 7.064742714166641e-06 7.101475656032562e-06 7.05579200387001e-06 7.096540659666061e-06 7.050505816936492e-06 7.275144129991531e-06 7.088358670473098e-06 7.1026233732700345e-06 7.111177295446395e-06 7.091610401868819e-06 7.199771553277969e-06 7.123050540685653e-06 7.102384835481643e-06 7.071649402379989e-06 7.146343201398849e-06 7.124968498945236e-06 7.087869793176651e-06 7.04637798666954e-06 7.072955816984176e-06 7.064520001411438e-06 7.050440996885299e-06 7.050949811935424e-06 7.031534284353256e-06 7.121179342269897e-06 7.0290738046169276e-06 7.134909301996231e-06 7.103482574224472e-06 7.228212624788284e-06 7.090503543615341e-06 7.078908890485763e-06 7.1086780130863186e-06 7.122331172227859e-06 7.088948398828506e-06 7.198954731225967e-06 7.044111341238021e-06 7.211090832948684e-06 7.121650606393813e-06 7.077489107847213e-06 7.108874082565307e-06 7.113266378641128e-06 7.053166210651397e-06 7.1043846011161795e-06 7.052662581205367e-06 7.0635587871074674e-06 7.271673083305358e-06 7.04152300953865e-06 7.04562222957611e-06 7.066029459238052e-06 7.083857387304306e-06 7.086418539285659e-06 7.081914484500885e-06 7.19171580672264e-06 7.062539994716644e-06 7.153893530368804e-06 7.109713971614837e-06 7.059793680906295e-06 7.115059882402419e-06 7.097525298595428e-06 7.085658222436905e-06 7.06511428952217e-06 7.144472450017929e-06 7.106181412935256e-06 7.195490032434463e-06 7.090572208166122e-06 7.064271360635757e-06 7.092907786369323e-06 7.105313271284102e-06 7.125595688819884e-06 7.254994302988052e-06 7.09167119860649e-06 7.1264782249927515e-06 7.064637660980224e-06 7.113891959190368e-06 7.1181470155715936e-06 7.06281492114067e-06 7.098334342241286e-06 7.20401918888092e-06 7.0919102728366845e-06 7.186429440975189e-06 7.128115981817245e-06 7.079207062721252e-06 7.059895068407058e-06 7.136052995920181e-06 7.240198522806167e-06 7.320439398288727e-06 7.158146172761917e-06 7.110419124364853e-06 7.102526098489761e-06 7.061523884534835e-06 7.098238855600357e-06 7.071236163377762e-06 7.131685823202132e-06 7.130439311265945e-06 7.077221244573592e-06 7.0590811073780055e-06 7.094298511743545e-06 7.066834121942519e-06 7.074349045753478e-06 7.0337435305118555e-06 7.065241783857345e-06 7.070620328187942e-06 7.041154116392135e-06 7.134489357471466e-06 7.080154955387115e-06 7.191412359476089e-06 7.108508139848708e-06 7.098745435476303e-06 7.094338208436965e-06 7.054714828729629e-06 7.115475624799727e-06 7.005065530538558e-06 7.058776229619979e-06 7.0836966335773466e-06 7.03784292936325e-06 7.046364575624466e-06 7.15575686097145e-06 7.048794835805893e-06 7.065560072660446e-06 7.055631518363952e-06 7.080493718385696e-06 7.293322533369064e-06 7.108853429555893e-06 7.0608629882335655e-06 7.05927637219429e-06 7.117127507925033e-06 7.258736699819564e-06 7.06444427371025e-06 7.1566686332225796e-06 7.10639813542366e-06 7.184492617845535e-06 7.088156968355179e-06 7.151977539062499e-06 7.1269917786121365e-06 7.0333674848079674e-06 7.059678435325622e-06 7.11819565296173e-06 7.139199048280715e-06 7.282004863023757e-06 7.110799640417099e-06 7.099723368883133e-06 7.083441466093063e-06 7.112143248319626e-06 7.110093772411346e-06 7.051881521940231e-06 )
set r_array = ( 393.63198578357697 498.48188757896423 342.41658598184586 232.6720505952835 290.7876208424568 456.5457195043564 400.6531909108162 231.04467391967773 371.08780443668365 408.4615394473076 344.25130635499954 283.6111158132553 406.51256144046783 430.04963397979736 350.53802765905857 292.4760043621063 503.9484441280365 369.12743151187897 342.16604195535183 390.60015082359314 342.1104218810797 473.2153445482254 458.7389886379242 486.4869862794876 274.73063468933105 496.404105424881 374.8635858297348 487.51969933509827 459.5079243183136 310.5105072259903 284.03809666633606 324.26660284399986 329.51545119285583 411.6503417491913 293.42383444309235 248.0569690465927 382.952918112278 291.9249355792999 495.9379017353058 260.0568860769272 419.85603272914886 447.07179069519043 305.55903762578964 427.28253304958344 487.1036887168884 473.0059087276459 431.0643583536148 303.1603291630745 446.05167508125305 470.5400824546814 325.2509690821171 231.82689547538757 367.8200054913759 315.6263738870621 224.21280145645142 252.07906663417816 410.24356335401535 457.2301208972931 468.5372769832611 327.3546636104584 394.0961956977844 493.0713891983032 315.3286352753639 487.2390776872635 292.701855301857 482.89934396743774 489.92592692375183 454.04269099235535 339.3351558595896 382.2275325655937 436.1052393913269 271.29527032375336 477.702134847641 425.42116045951843 472.7394849061966 246.27569615840912 420.25572657585144 380.11661171913147 397.62834310531616 312.6972809433937 229.47202324867249 258.7488889694214 370.820477604866 502.4981200695038 413.3368253707886 412.290495634079 342.49272383749485 438.5341763496399 384.5352292060852 484.6166729927063 480.87055683135986 280.435174703598 223.33132028579712 270.97307443618774 459.58476066589355 256.8415701389313 324.5762638747692 271.64010405540466 278.62499207258224 225.81220269203186 342.4491988494992 503.7663400173187 234.53247547149658 240.8443123102188 461.56651973724365 297.3995164036751 335.67225858569145 492.7795648574829 300.3751143813133 378.5369426012039 382.5335770845413 394.85209584236145 261.50341033935547 316.28035455942154 298.1732442975044 494.014972448349 306.3778802752495 223.138165473938 295.119446516037 329.75845262408257 332.7732365578413 352.5821402668953 493.3671295642853 495.60214281082153 455.50419092178345 298.92574697732925 470.359069108963 334.38247591257095 486.8961751461029 410.56677401065826 434.18694138526917 285.28639674186707 285.88784635066986 479.54719066619873 365.4558550566435 276.70330107212067 250.06479918956757 240.8465564250946 371.08777314424515 241.28544628620148 235.87522506713867 262.3703896999359 273.2344537973404 504.5940697193146 282.3074012994766 416.9902175664902 213.37735652923584 240.7151997089386 479.59987819194794 224.3445873260498 239.91084098815918 387.54522651433945 330.142006278038 310.519514977932 263.64014744758606 255.38093745708466 428.4537196159363 253.83291840553284 425.6129205226898 499.8116195201874 457.6431095600128 383.50185453891754 408.95621478557587 417.2133505344391 491.8929159641266 256.59425258636475 331.51714354753494 360.74649952352047 497.4009037017822 386.1948147416115 504.42695021629333 360.55974178016186 219.57942843437195 447.5532829761505 262.04700469970703 471.5184271335602 487.0679259300232 262.444543838501 336.29133366048336 439.7876441478729 432.9399287700653 241.777104139328 450.4614233970642 )
set i = 183
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
