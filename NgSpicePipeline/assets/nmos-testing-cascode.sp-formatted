nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1431.1501216888428 926.4884275197983 1419.8080432415009 1385.1191234588623 935.6059265136719 1407.3030483722687 1020.5990728735924 1282.348586320877 844.3983700871468 1436.0048305988312 1254.876149892807 1106.406895518303 1405.0536584854126 877.8632861375809 993.0184093117714 716.0791885852814 1327.3739349842072 1367.5020170211792 751.2043081969023 1224.8587441444397 1103.8520467281342 997.4545148015022 1066.3238298892975 849.7251477837563 1398.2878756523132 1343.9355027675629 1135.661883354187 894.0156829357147 1390.3781306743622 1059.369934797287 917.2642436623573 1013.0259898304939 695.909099727869 1264.7930812835693 1181.8195712566376 1238.34676861763 1030.6088310480118 821.4340899884701 1335.3716564178467 962.9965555667877 1443.3137607574463 1074.9359112977982 844.3381097912788 1135.948611497879 833.4363830089569 1162.7053451538086 1411.26797914505 864.2235380411148 727.975372299552 1275.9572398662567 669.1980083286762 1380.2922201156616 1079.4683527946472 783.7650012969971 822.6357419788837 1412.4476146697998 863.2418271899223 1394.4788706302643 779.4607263803482 1120.2570629119873 1127.8147232532501 1051.8906843662262 989.961853325367 833.2280759513378 1412.2595024108887 1433.9605402946472 1081.5248918533325 1388.2685732841492 797.4038776755333 1428.2013010978699 1396.7524003982544 1108.258782029152 1408.9022707939148 975.7980015873909 1394.0974605083466 957.2993424534798 801.7647472023964 1428.334070444107 1428.0282986164093 1451.0880541801453 796.6850344836712 758.0930870771408 910.080863237381 1472.6383519172668 1436.7407393455505 1132.0806872844696 1003.6500599980354 1116.930319070816 994.5148360729218 1416.5027570724487 1256.4860117435455 1404.3002259731293 1430.7169449329376 849.5645281672478 936.5477618575096 1380.646539926529 841.5249195694923 1313.797129392624 1437.2972083091736 1273.3048927783966 1386.451644897461 817.3165974020958 1073.910905122757 1415.5346584320068 791.2508007884026 1409.2886877059937 820.8259102702141 926.3226446509361 1346.4682233333588 1348.264319896698 870.51159709692 1033.6871576309204 1400.4006516933441 1419.0507662296295 1404.6514165401459 940.8712369203568 1162.670476436615 1120.6415128707886 1299.4860243797302 1388.2879745960236 909.9396002292633 1432.5916302204132 803.6248256266117 1435.2051746845245 714.8798779398203 1385.3532803058624 1189.3625688552856 1435.7592296600342 710.5435226857662 711.7732372879982 812.9320015013218 1420.5512833595276 1412.6032721996307 1379.531545639038 1401.6896319389343 1370.7504403591156 821.3456106185913 1124.2016088962555 1003.5470855236053 1410.5298352241516 1310.3448581695557 1402.3668003082275 1391.7668890953064 835.045328438282 1374.389750957489 1414.5296347141266 912.9633438587189 1437.0818269252777 1138.4251844882965 986.3702636957169 1184.224350452423 809.0089802443981 1447.4429321289062 1301.1397850513458 1029.946571290493 1430.1608335971832 1437.1683728694916 1366.781575679779 1040.9724843502045 933.0165442824364 1437.6255106925964 1072.7034640312195 1398.7943661212921 1188.8862979412079 )
set w1_array = ( 1381.1066818237305 955.8254194259642 1125.8221340179443 1225.946969985962 956.8913412094115 1258.5005950927734 916.7411518096923 938.187642097473 945.3863096237181 1325.01389503479 1204.0827465057373 1220.135326385498 1148.8770198822021 1219.620008468628 930.1757764816283 1142.8870868682861 1227.4934005737305 1321.6384601593018 1142.4271774291992 1262.0600414276123 1191.686840057373 1202.0958137512207 1166.56081199646 949.9253225326537 1320.5542755126953 1221.5912532806396 1221.3498306274414 1188.810749053955 1263.7971115112305 948.5518646240233 1186.954755783081 1219.075698852539 1202.7294826507568 1268.4107494354248 1240.1983451843262 1198.7391185760498 921.8285274505614 1170.751781463623 1224.678201675415 944.2351293563842 1403.9192390441895 1148.330373764038 1212.1510219573975 1226.714153289795 1240.741891860962 967.7506637573241 1214.6669101715088 1230.4836463928223 1035.3316974639893 1266.0026264190674 927.6122045516967 1091.2746143341064 1170.7203578948975 1060.0519371032715 976.8667411804198 1312.5991535186768 1220.3151893615723 1270.332498550415 1254.4119548797607 1197.5347232818604 1200.360221862793 1162.6663398742676 1206.144781112671 952.7313423156737 1366.4777946472168 1214.9388980865479 1171.6608715057373 1308.4015560150146 1139.287109375 1307.112808227539 989.7873830795287 1212.3985004425049 1033.743782043457 1213.8874244689941 1295.2655506134033 945.2144575119017 1124.486608505249 1401.0298442840576 1189.3095684051514 1177.2309494018555 1035.6383514404297 1077.852554321289 1222.6864528656006 1282.1341228485107 1251.011724472046 1210.260362625122 1197.2284984588623 1215.8719730377197 1213.4995651245117 1163.4803009033203 1233.408613204956 1215.8278179168701 1327.4780941009521 1243.394775390625 1216.4571475982666 1093.7299919128418 1248.6486148834229 1243.5240936279297 1309.2045497894287 966.717858314514 1167.4831104278564 1219.3616580963135 1184.3962860107422 1412.383337020874 1125.979347229004 1208.4430408477783 1153.4039211273193 1201.6373348236084 1257.8535747528076 1253.5267543792725 1294.8039722442627 1163.1126594543457 1251.9419384002686 1211.4641857147217 1030.2700233459473 952.8561782836913 905.0769281387328 1220.3064632415771 1236.5209293365479 1237.6635265350342 985.6004667282103 1226.9246768951416 1147.2784233093262 1310.138053894043 1142.391939163208 1239.030475616455 1221.461124420166 1239.323492050171 1395.6545066833496 915.186686515808 1140.8733558654785 1192.9398727416992 1037.2086238861084 1090.726490020752 1260.0516033172607 1354.9445819854736 1200.0111770629883 1219.0293979644775 1207.6689910888672 1186.9780254364014 956.5020036697387 1264.9153423309326 1254.5236778259277 1249.4421672821045 1209.2980575561523 1278.9172840118408 1213.094778060913 1284.5843982696533 888.1388854980468 1223.3312320709229 1193.6910343170166 1123.777837753296 1122.2704601287842 1263.3754920959473 1187.1053886413574 1245.0760078430176 1324.6803951263428 1167.915506362915 1184.1120433807373 1198.1360149383545 1303.9646816253662 1146.6826152801514 1275.2576541900635 1251.5233707427979 )
set r_array = ( 5.941771318316459e-06 6.632038031816482e-06 5.062217985391616e-06 6.598853071331978e-06 6.632435892820358e-06 4.383451131284237e-06 6.628716339468955e-06 6.640071694850921e-06 6.668863867521285e-06 5.915544678568839e-06 6.607774992585182e-06 6.6362446296215054e-06 3.605036412477493e-06 6.620080073475837e-06 6.635540549755096e-06 6.64603826880455e-06 6.616181929707527e-06 3.807612595260143e-06 6.592228462100029e-06 6.605525960326194e-06 6.6473328816890715e-06 6.642118220329284e-06 6.652134035825729e-06 6.663649653196334e-06 6.080663030147552e-06 6.6162351268529884e-06 6.632363920211792e-06 6.620162551403045e-06 4.41734028339386e-06 6.641520981788635e-06 6.6176218289136885e-06 6.625232596993446e-06 6.6663425910472865e-06 6.5741438913345335e-06 6.630231117010116e-06 6.615609948635101e-06 6.6301457333564756e-06 6.671311830282211e-06 6.615701814293861e-06 6.634021525382995e-06 5.167045866250991e-06 6.6592235612869256e-06 6.66875121474266e-06 6.668693100214004e-06 6.5373314666748045e-06 6.644924705028534e-06 6.594378476142883e-06 6.614107688069343e-06 6.648116533756256e-06 6.583649416565895e-06 6.42016900062561e-06 2.9396552761271595e-06 6.654079978466034e-06 6.660959844589233e-06 6.685112242698669e-06 6.2492914992570874e-06 6.634355013370513e-06 4.407780443429947e-06 6.643230890035629e-06 6.644801323413849e-06 6.643541579246521e-06 6.649555091857909e-06 6.6393390047550195e-06 6.678662424087524e-06 6.4919355261325835e-06 6.659990673065185e-06 6.65453550696373e-06 5.923767884373664e-06 6.599567209482192e-06 4.3729890632629395e-06 6.553633262515068e-06 6.664815967082977e-06 6.571169992089271e-06 6.633092586994171e-06 4.4287946569919585e-06 6.632723336219787e-06 6.62199740588665e-06 5.945423145890235e-06 5.843939309120178e-06 5.1550250995159145e-06 6.6716502356529235e-06 6.656099681854248e-06 6.5961619216203685e-06 2.8677344677224753e-06 5.946039606928825e-06 6.628470917344093e-06 6.6454463946819304e-06 6.664794062376022e-06 6.661429678201675e-06 5.85515295445919e-06 6.620028664469719e-06 6.6029597568511955e-06 6.696288113594055e-06 6.6143117594718926e-06 6.613718544244766e-06 2.95862760219723e-06 6.619132359623908e-06 6.607111592888832e-06 5.887041066884994e-06 6.640677874088287e-06 2.788547890372574e-06 6.701572959423064e-06 6.650340532064438e-06 4.274769139587879e-06 6.657642846107483e-06 4.382965986728668e-06 6.6843035566806785e-06 6.614063431620597e-06 6.593651373982429e-06 6.639106993675232e-06 6.603281398415565e-06 6.657094334363937e-06 5.912629564404487e-06 4.375192721486091e-06 6.583619912266731e-06 6.6317867982387535e-06 6.642985914945602e-06 6.634599541425704e-06 6.601511587500572e-06 6.630659823417663e-06 6.640605901479721e-06 6.696522359848022e-06 6.605178614258766e-06 6.695134316682815e-06 6.644362782239914e-06 5.047982384562492e-06 6.6307760524749755e-06 5.9340537089109414e-06 6.623585720658302e-06 6.5474874275922774e-06 6.684662972688675e-06 3.6015910032391547e-06 6.553089668154716e-06 2.9001040366664525e-06 5.995903213620186e-06 3.862038415968418e-06 6.570541684627533e-06 6.633814548254012e-06 6.618163411617279e-06 6.601470013260841e-06 6.631506060361862e-06 6.027589042782783e-06 4.464467813372612e-06 6.627121319174766e-06 6.616606612801552e-06 4.695741509199142e-06 6.594905753731727e-06 3.5663801926374435e-06 6.638618384599685e-06 6.676052187681198e-06 6.638811056613922e-06 6.666268830299377e-06 5.138544713258743e-06 6.577704300284385e-06 6.650489394664764e-06 4.376398821473121e-06 5.128293310403823e-06 3.6214412498474118e-06 6.6181643056869505e-06 6.591541816592216e-06 5.124315817952156e-06 6.657388483285903e-06 4.5221522945165635e-06 6.645622079372405e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
