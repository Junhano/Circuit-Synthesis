nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1319.8063057661057 807.515515089035 1311.6506916284561 1357.8594309091568 1127.0200741291046 895.5552485585213 1001.0664221644402 1387.5750881433487 1386.5769040584564 690.6211009062827 862.2780647873878 1035.112729370594 797.687968313694 989.3672075867653 794.6746517717838 851.7929968237877 786.547167301178 1381.8279188871384 1360.7186657190323 1403.7568551301956 1295.979796051979 1292.653141617775 1384.8861289024353 679.9539570510387 716.4382162317634 1365.1213330030441 1285.2766197919846 939.1841945052147 1394.866896867752 1288.2495802640915 1377.0804983377457 963.1283190846443 801.8415589630604 1377.5992822647095 1411.5633350610733 1281.1285388469696 816.100539714098 1357.967523932457 1392.0252752304077 844.0180104970932 1396.5866845846176 885.6425639986992 1227.134062051773 844.2103584110737 856.2642280757427 1028.3648726344109 1218.3124554157257 1040.9751889109612 731.8483424186707 1044.1747066378593 1382.0226472616196 1078.7060689926147 1113.4995502233505 1390.1062440872192 931.7193832993507 850.4364360868931 1050.7556629180908 883.9600589871407 1362.2599971294403 831.5887768566608 1137.5742983818054 1186.4271146059036 1381.157500743866 1370.6475776433945 1390.0359255075455 1413.171587586403 914.7983548045158 964.3834364414215 1223.3912628889084 1388.7974154949188 1401.3826978206635 1197.6399999856949 932.2636035084724 1374.2717784643173 1040.0991347432137 1220.3740906715393 813.918227404356 805.2458856999874 1180.4568302631378 1391.6162830591202 737.165307700634 926.224051117897 1115.8429962396622 1095.9327352046967 1370.2542316913605 729.2220909893513 1307.468546628952 1397.0990759134293 1010.192437171936 1338.2478338479996 1058.6437267065048 818.4408117830753 674.3307770974934 1382.5772386789322 949.8720374703407 1145.5831509828568 1381.0375612974167 1389.6734696626663 738.5915164649487 1277.083186507225 1380.945963859558 1394.009171128273 1081.0835790634155 948.6626741290092 1007.5692367553711 1199.670387506485 1308.3436173200607 1002.0114985108376 1204.807488322258 1167.8200942277908 1080.2783352136612 1002.8877314925194 977.5557425618172 1235.160259604454 792.457280755043 1409.8244589567184 1385.5183255672455 1261.7393416166306 992.8807896375656 1345.0181317329407 992.2451284527779 1413.5771375894547 975.9728369116783 1358.5183155536652 1308.2691413164139 838.2800501585007 1069.8116850852966 692.5748862139881 1355.0779801607132 1201.8736881017685 1399.639708995819 1022.9007658362389 1322.2716581821442 1073.0716866254807 1395.297436118126 1413.1753426790237 1341.8906313180923 1044.9473616480827 1130.3818207979202 1412.4076944589615 1376.8295329809189 1400.267658829689 1406.4492565393448 803.8748522102833 705.7262026518583 1404.2640608549118 955.8733460307121 756.872436106205 1409.456906914711 1176.6162198781967 762.7911438047886 1266.1016863584518 1290.2659755945206 1139.4555550813675 1386.4985835552216 1037.8197264671326 1378.5141390562057 1085.7710522413254 888.1304022669792 1393.474383354187 1021.8077209591866 1394.1321504116058 1374.9114406108856 1287.9723292589188 )
set w1_array = ( 1196.9203186035156 1207.9283905029297 1201.936264038086 1235.8864974975586 1094.322271347046 1154.8572254180908 1194.9555587768555 1271.2550354003906 1266.2244033813477 1104.8015785217285 1162.241096496582 1204.9337100982666 1194.528408050537 1196.501178741455 1215.438003540039 1214.3021774291992 1136.2610530853271 1256.336898803711 1227.383680343628 1284.2393589019775 1183.1041049957275 1210.3977394104004 1256.097764968872 1078.119773864746 1166.589469909668 1248.0250549316406 1209.0650272369385 1144.610424041748 1283.3638381958008 1178.1053733825684 1227.5261116027832 1175.216646194458 1171.18408203125 1234.0162467956543 1283.1224155426025 1207.3028755187988 1214.041919708252 1231.1424446105957 1281.1382961273193 1213.709945678711 1252.3722839355469 1188.5843467712402 1205.245943069458 1207.9120826721191 1213.3581352233887 1166.8941688537598 1196.7707824707031 1192.5477695465088 1155.186529159546 1070.0141143798828 1246.6529083251953 1190.6639289855957 1166.0291862487793 1280.032558441162 1201.4048767089844 1165.5914974212646 1203.3370685577393 1111.1259651184082 1223.0055522918701 1214.021224975586 1201.2145709991455 1176.5143585205078 1242.2124099731445 1204.6189975738525 1276.7384243011475 1277.540225982666 1184.5696640014648 1198.5244941711426 1166.0739135742188 1269.1151809692383 1286.1016464233398 1202.8166007995605 1209.4989013671875 1217.0562934875488 1203.910322189331 1141.7337608337402 1208.1110668182373 1170.373935699463 1205.0757598876953 1255.16526222229 1194.8773097991943 1202.3185920715332 1089.0088272094727 1191.4801788330078 1203.4601879119873 1176.3218116760254 1208.2599353790283 1284.6351337432861 1205.105562210083 1214.7744846343994 1166.1400985717773 1133.316249847412 1092.481632232666 1245.9137630462646 1208.6892318725586 1192.037124633789 1252.469367980957 1272.4211406707764 1195.3569602966309 1213.2399272918701 1242.3920822143555 1282.601089477539 1191.5057373046875 1208.7019634246826 1071.7425060272217 1206.4813804626465 1215.57204246521 1128.8698387145996 1203.2769870758057 1204.3818187713623 1202.3787212371826 1195.5183696746826 1075.8084964752197 1170.7830619812012 1137.2009468078613 1279.9238395690918 1258.5190963745117 1210.0578022003174 1206.5504264831543 1234.8947715759277 1170.1996994018555 1283.407039642334 1207.000560760498 1230.9661102294922 1190.167875289917 1167.4689960479736 1072.38676071167 1071.0798931121826 1223.7013530731201 1179.7543716430664 1268.4853744506836 1071.703929901123 1231.1443519592285 1126.9448947906494 1251.1652183532715 1280.9242916107178 1222.4873733520508 1124.5233726501465 1168.0039596557617 1284.3999576568604 1242.2058296203613 1258.396167755127 1286.7685508728027 1207.9626274108887 1095.1887798309326 1273.6264419555664 1199.797649383545 1201.5689086914062 1275.2059650421143 1193.2579231262207 1202.9918384552002 1166.9972133636475 1201.6368103027344 1139.417953491211 1265.7274436950684 1072.984380722046 1232.997817993164 1190.6014156341553 1205.630464553833 1282.5182151794434 1193.5443115234375 1263.9130306243896 1219.4059562683105 1179.4799041748047 )
set r_array = ( 6.650999014377593e-06 6.633108233213424e-06 6.651277070045471e-06 6.673166577816009e-06 6.643044476509094e-06 6.632759099006653e-06 6.636012171506881e-06 4.606730056107044e-06 4.448458378314972e-06 6.627255206108093e-06 6.632524405717849e-06 6.6439144062995905e-06 6.634264265298843e-06 6.635662590265274e-06 6.632013444900512e-06 6.634535615444183e-06 6.627784495353699e-06 6.59620237827301e-06 6.669155334234237e-06 5.776152064204216e-06 6.649624829292297e-06 6.650183175802231e-06 4.193316039741039e-06 6.6255526739358896e-06 6.632328157424926e-06 6.639886622428894e-06 6.648463432788849e-06 6.633583878278732e-06 5.192645763158798e-06 6.650081251859665e-06 3.640867483913898e-06 6.634181116819381e-06 6.632659410238265e-06 6.667086009979248e-06 6.064584081172943e-06 6.648040537834167e-06 6.631685321331024e-06 6.671789710521697e-06 5.062577177882194e-06 6.632346485853195e-06 6.639022057056427e-06 6.6341364133358e-06 6.641909008026123e-06 6.633321468830108e-06 6.632759993076324e-06 6.635622804164886e-06 6.649149631261825e-06 6.638164644241333e-06 6.631030415296554e-06 6.639216517210006e-06 3.999263246655464e-06 6.640995715856551e-06 6.640851323604583e-06 5.050543670654297e-06 6.634254430532455e-06 6.632645552158355e-06 6.643816952705383e-06 6.629268427491188e-06 6.665910755395889e-06 6.631992434263229e-06 6.647901062965392e-06 6.648705725669861e-06 3.912953225076199e-06 3.138999606594443e-06 4.80499816417694e-06 6.321979587078094e-06 6.634049241542816e-06 6.634897266626358e-06 6.6503892588615414e-06 4.516483445763587e-06 5.512679343223572e-06 6.644379322528839e-06 6.636230324506759e-06 3.4422743815183636e-06 6.643159811496734e-06 6.649276142120361e-06 6.6331346082687375e-06 6.632565085887908e-06 6.634398375749588e-06 6.633287494182587e-06 6.633110915422439e-06 6.634194974899291e-06 6.642598782777786e-06 6.642859851121902e-06 3.0877062847092745e-06 6.632962052822112e-06 6.652245347499847e-06 5.341001873016357e-06 6.640867863893508e-06 6.660135959386825e-06 6.636960332393646e-06 6.628143911361694e-06 6.627336119413375e-06 6.6626769053936e-06 6.64107707619667e-06 6.647583221197128e-06 6.640018944740295e-06 4.620997396409511e-06 6.633120750188827e-06 6.646737878322601e-06 3.916656014621257e-06 5.124932949542999e-06 6.64142218708992e-06 6.641089146137237e-06 6.636879419088363e-06 6.6333205747604365e-06 6.655195330381393e-06 6.6356272745132445e-06 6.6436747956275936e-06 6.6361252713203425e-06 6.645814751386642e-06 6.636206631660461e-06 6.634729628562927e-06 6.650949393510818e-06 6.628040199279785e-06 6.171577845811843e-06 4.247572322487831e-06 6.643570636510849e-06 6.643093650341034e-06 6.670622055530548e-06 6.634612952470779e-06 6.0920317965745924e-06 6.638704662322997e-06 6.671662752628326e-06 6.649683837890624e-06 6.632633035182953e-06 6.640628700256347e-06 6.623209317326545e-06 6.667126690149307e-06 6.650011514425277e-06 6.444740717411041e-06 6.637902681827545e-06 6.6606165218353264e-06 6.638627772331237e-06 6.643220608234405e-06 6.194168751239776e-06 6.665782903432846e-06 6.6374341893196105e-06 6.642532174587249e-06 6.020350431203842e-06 6.668467794656753e-06 6.613765929937362e-06 5.703518291115761e-06 6.633055483102798e-06 6.624694143533706e-06 6.324397151470184e-06 6.634753768444061e-06 6.633089904785156e-06 6.353650217056274e-06 6.649556879997253e-06 6.633072023391723e-06 6.650911395549774e-06 6.649398182630539e-06 6.642545585632324e-06 4.434112024605274e-06 6.638817762136459e-06 3.7414701032638547e-06 6.641656433343887e-06 6.633720223903655e-06 5.346374337673187e-06 6.63699833035469e-06 6.520690594911575e-06 3.4883417683839795e-06 6.649811242818832e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
