nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1414.874119758606 1417.6052343845367 828.226203173399 968.3884438872337 1339.5842891931534 1424.2741000652313 1414.178980588913 979.0626746416092 1119.0063041448593 1275.3980886936188 1278.3987653255463 864.135382771492 863.0167227983475 1138.369573354721 1413.7965869903564 1394.3490517139435 1153.7110936641693 1311.0197466611862 1020.1934111118317 1391.2400138378143 1173.6119669675827 1329.744068980217 751.0520090162754 1355.5787932872772 1387.5919860601425 1396.4135926961899 835.6206734478474 1253.1471979618073 927.9147815704346 891.8376845121384 1411.383582353592 1191.641731262207 1424.2575597763062 984.5275861024857 1424.636287689209 1410.1215136051178 1147.9179692268372 1238.7176287174225 1412.994874715805 1421.6290843486786 934.4550800323486 745.6111312657595 1394.222093820572 838.7708385288715 1259.7430628538132 1099.670125246048 1411.4896190166473 1414.754135608673 866.5783387422562 1415.4084157943726 1425.6852102279663 1210.5582785606384 770.5801893770695 1416.9200193881989 1067.662341594696 1214.4237440824509 1103.2824349403381 940.2078819274902 824.2532481253147 1416.9493448734283 1345.5737960338593 1231.9349032640457 830.8936488628387 1087.6107794046402 1019.4613468647003 920.4975348711014 1204.9742770195007 703.5392076522112 1414.7193562984467 775.4479517042637 1419.5360672473907 1424.3314099311829 1197.3379385471344 1280.0940108299255 1154.4743609428406 990.1240822672844 1164.3386763334274 1308.228863477707 1095.9769022464752 762.4107674509287 1418.2518255710602 891.8746766448021 1222.6245087385178 1241.7166066169739 1416.6444671154022 1313.6147838830948 1417.359722852707 848.1595759093761 1144.222108721733 1228.6857199668884 748.5846449434757 738.4579536318779 897.1383106708527 1423.709852695465 979.0574890375137 1249.7027945518494 1417.2951710224152 1424.471331834793 1076.6269099712372 1390.8213210105896 1334.713978767395 1424.3592154979706 1409.1517162322998 1415.0689375400543 1390.025509595871 1044.57375228405 1427.610946893692 1399.198396205902 1199.1339457035065 1060.9257501363754 1067.5204974412918 634.2094857990742 1413.5676157474518 1201.5871834754944 1000.6427448987961 839.1824346780777 1189.7107195854187 1118.4557807445526 768.8342612981796 1165.9234595298767 1265.2058732509613 1413.2765066623688 872.8881013393402 1424.5510828495026 720.1742009073496 1278.7055653333664 1065.9393799304962 816.6268561780453 759.5582716912031 1193.1322348117828 1143.2784628868103 1292.2094595432281 1419.0266263484955 1194.9701291322708 1415.4324662685394 1085.1334017515182 912.9955527186394 815.0976394116879 958.2767394185066 1321.8996357917786 1101.5405637025833 1412.6298260688782 908.1092607975006 1424.5035183429718 1077.5866490602493 1172.1227598190308 1062.7177786827087 943.0382829904556 887.123456299305 1115.5443322658539 797.3561120033264 943.7095952033997 1415.245337486267 1425.658209323883 1422.8319656848907 1423.5965740680695 1271.6285121440887 1426.006807088852 903.1989407539368 801.368562579155 1195.321140885353 1302.4862986803055 1113.382516503334 1419.9262392520905 )
set w1_array = ( 1292.1231937408447 1294.7045040130615 1183.8952732086182 1154.9485874176025 1279.6245288848877 1264.7091579437256 1288.3342456817627 1193.6673831939697 1179.1631412506104 1263.3841705322266 1217.0288753509521 1207.1814250946045 1208.076639175415 1284.1969680786133 1292.7509021759033 1284.7868156433105 1170.2967834472656 1243.238182067871 1153.5533618927002 1237.7549839019775 1285.3690814971924 1204.9945545196533 1226.9622039794922 1207.0498180389404 1289.2342281341553 1228.8597774505615 1243.240041732788 1247.3620128631592 1159.0581607818604 1126.5536499023438 1278.5896492004395 1187.8709983825684 1280.0123882293701 1193.6084938049316 1281.0923290252686 1277.6780319213867 1244.2310047149658 1266.9038486480713 1287.6218032836914 1273.577470779419 1115.0365543365479 1194.6984481811523 1284.8695468902588 1211.002893447876 1216.4226245880127 1140.7790851593018 1229.825086593628 1289.6359157562256 1174.7183513641357 1282.9559993743896 1284.595079421997 1284.6757125854492 1214.0237998962402 1310.8655643463135 1277.5313568115234 1250.1308155059814 1262.4129486083984 1262.0860767364502 1230.7820987701416 1252.8290462493896 1206.4428043365479 1216.1769104003906 1230.9461307525635 1235.679693222046 1155.6356620788574 1117.4358081817627 1209.4459247589111 1194.3088245391846 1289.3998336791992 1237.0939445495605 1282.8829956054688 1280.2348804473877 1229.4303607940674 1203.7226867675781 1245.2838611602783 1155.1168155670166 1245.4472255706787 1244.0568161010742 1171.9168853759766 1193.274278640747 1265.8678722381592 1169.1300106048584 1197.3927211761475 1231.555814743042 1276.3303470611572 1260.6217098236084 1277.8654289245605 1244.4136333465576 1242.2934246063232 1232.0261669158936 1213.8973903656006 1213.4817790985107 1125.1013469696045 1289.7777271270752 1228.270502090454 1231.5515232086182 1287.0827388763428 1275.4574966430664 1165.2085494995117 1216.2841510772705 1278.840799331665 1313.9022541046143 1290.0950622558594 1300.9364795684814 1287.43803024292 1158.1404399871826 1304.1878414154053 1282.4322891235352 1267.5236892700195 1162.4556255340576 1200.1671981811523 1182.3256206512451 1261.289472579956 1249.5454025268555 1193.9019870758057 1248.524923324585 1226.6165447235107 1210.7083988189697 1193.197078704834 1285.1563167572021 1231.100673675537 1278.208417892456 1231.6881847381592 1278.2922458648682 1172.0034313201904 1229.7301959991455 1258.7317657470703 1151.8551540374756 1167.470998764038 1186.9548988342285 1164.5001602172852 1216.693754196167 1283.0302429199219 1268.2304573059082 1294.8510837554932 1204.0543270111084 1258.5082721710205 1153.3187580108643 1110.233850479126 1228.3314418792725 1237.8514003753662 1275.0652980804443 1230.8282089233398 1279.0298175811768 1260.675687789917 1176.6036224365234 1125.8021545410156 1111.5743350982666 1205.3190422058105 1264.5979118347168 1239.481086730957 1229.4624996185303 1301.7440032958984 1286.9076442718506 1252.735824584961 1254.7777843475342 1217.1496105194092 1301.364393234253 1230.2784156799316 1188.6503887176514 1206.5928173065186 1261.848611831665 1178.6496353149414 1247.5593280792236 )
set r_array = ( 6.587712069153786e-06 5.717126031517982e-06 6.621229847073554e-06 6.622446899414062e-06 6.677461241483688e-06 6.401076589822769e-06 5.541609426140785e-06 6.6242920356988905e-06 6.629142587184906e-06 6.618958910107612e-06 6.6080461192131035e-06 6.62154232442379e-06 6.621552159190178e-06 6.621862848401069e-06 5.312124763727188e-06 3.3727262663841245e-06 6.626883049607277e-06 6.639601414203643e-06 6.624187876582145e-06 6.6652124869823455e-06 6.6124161082506176e-06 6.642296140193939e-06 6.621891458630561e-06 6.663292919397354e-06 3.2414647686481474e-06 6.652528767585754e-06 6.621954490542411e-06 6.605693598389625e-06 6.621692528128623e-06 6.6201080131530755e-06 3.7290340411663055e-06 6.621809651255607e-06 4.240804885625839e-06 6.6245649504661555e-06 4.309785713553428e-06 3.6962267133593555e-06 6.6285692650079724e-06 6.605736066699028e-06 5.352313195466995e-06 6.03532810986042e-06 6.6204895573854446e-06 6.621319254040718e-06 3.370348432213068e-06 6.6215678054094314e-06 6.604025711417198e-06 6.62595858156681e-06 6.588498179912567e-06 5.115202118754386e-06 6.62127946794033e-06 5.005295698642731e-06 6.205477167963981e-06 6.606057708263396e-06 6.622497861385345e-06 5.433226053714752e-06 6.6342361021041866e-06 6.6093373793363565e-06 6.63320702791214e-06 6.631103281974792e-06 6.621530254483223e-06 6.553156723380088e-06 6.656295483112335e-06 6.608372231125831e-06 6.6215928393602366e-06 6.633145337104797e-06 6.624273036718368e-06 6.62034471809864e-06 6.617624287605285e-06 6.620500956773758e-06 5.1153838384151455e-06 6.619796876907348e-06 4.786492486596107e-06 4.250481625199318e-06 6.6179503995180125e-06 6.606256191730499e-06 6.627236654162407e-06 6.623123263120651e-06 6.625094686746597e-06 6.6373970854282375e-06 6.628429790139198e-06 6.621302266716957e-06 6.546907846927642e-06 6.621410672664642e-06 6.612747808098793e-06 6.605180849432945e-06 3.869026576280594e-06 6.649008368253708e-06 3.89299200206995e-06 6.622610737681388e-06 6.6293560463190074e-06 6.607808073163032e-06 6.6230220097303385e-06 6.623282631039619e-06 6.6201766330003735e-06 6.052287717461585e-06 6.626946975588798e-06 6.604510073661803e-06 5.756642122864723e-06 6.178718780279159e-06 6.627341707348823e-06 6.6587926197052e-06 6.673791532516479e-06 5.9271494793891905e-06 6.62145045876503e-06 5.371983398795127e-06 3.2891034829616544e-06 6.625511323213577e-06 6.36770834505558e-06 3.4672051790356633e-06 6.610547949671745e-06 6.6265171515941615e-06 6.629689757823944e-06 6.609508146643638e-06 6.589319829940796e-06 6.613391985297203e-06 6.6254518675804136e-06 6.6221527504920954e-06 6.620627691149711e-06 6.63124230980873e-06 6.621353675723075e-06 6.614491690993309e-06 6.606153150200843e-06 3.7765513855218885e-06 6.622372915148734e-06 4.334375088214874e-06 6.6129563498497e-06 6.6109359759092325e-06 6.634862397909164e-06 6.618514557480812e-06 6.616197128891944e-06 6.621515278816223e-06 6.627207820415497e-06 6.615234215855598e-06 4.813473050594329e-06 6.611534108519554e-06 5.568796520233154e-06 6.630672787427902e-06 6.628708069324493e-06 6.61857133090496e-06 6.620662112832069e-06 6.643874173164367e-06 6.633076940774917e-06 6.600597848296165e-06 6.623448480963706e-06 4.3908686685562135e-06 6.6347349929809565e-06 6.625208457112312e-06 6.623964582681656e-06 6.620482404828071e-06 6.621735443472862e-06 6.631663863658905e-06 6.620348517894744e-06 6.624982704520225e-06 5.396804784536362e-06 6.412739505171776e-06 6.433371056914329e-06 6.399250229001045e-06 6.605815638899803e-06 6.434066196084022e-06 6.6231923300027845e-06 6.621254433989524e-06 6.620587681531906e-06 6.639512901306152e-06 6.629129846692085e-06 6.504285086989402e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
