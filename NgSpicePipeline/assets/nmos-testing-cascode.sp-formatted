nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1407.4086380004883 1396.2200713157654 1408.875761628151 763.9248353242874 967.0687076449394 1410.3866946697235 1064.5983201265335 1095.2629429101944 944.6551632881165 1390.492571592331 1185.205055475235 1229.4566762447357 1405.2900505065918 1174.6413093805313 720.2428822219372 1418.1180727481842 1307.8186643123627 988.510465323925 1123.2302916049957 1021.5825495123863 1413.0508434772491 893.5036939382553 781.1918017268181 796.9650347530842 738.7782485038042 1285.7161891460419 1416.1242079734802 697.2370390594006 1327.14330971241 1020.8890643715858 958.8750061392784 1018.5219702124596 789.7299659252167 1121.1372745037079 739.5355422794819 987.978136241436 883.5406732559204 904.9293231964111 1083.01991045475 1287.0886307954788 870.7213681936264 699.556144028902 1183.7635469436646 1265.0326025485992 715.7592317834496 1414.2670911550522 1063.3170288801193 708.2898133248091 913.9528331160545 1265.674455165863 790.3746795654297 1217.6288497447968 1368.336809873581 765.2371843159199 1258.9605283737183 875.4008841514587 961.7790338397026 1412.7907139062881 724.2179327458143 932.108214199543 1414.6666061878204 1356.2474232912064 1098.0861914157867 1088.2255864143372 889.2042246460915 1415.991438627243 1411.1478161811829 1233.971146941185 1412.4519956111908 1411.1718666553497 1215.4085171222687 1418.4706491231918 1170.9675323963165 1406.8275821208954 1179.520336985588 1409.8161888122559 1012.6189199090004 1017.1063897013664 764.9274227023125 1410.9184873104095 760.1135895401239 989.5084482431412 775.1644086837769 791.135801076889 1369.9863684177399 881.5353867411613 1415.46679854393 1410.5064105987549 1416.9435334205627 982.1506348252296 1410.480214357376 1029.0222373604774 1086.8244004249573 1362.1607106924057 706.6093451157212 1108.3447468280792 904.6423491835594 1309.0849351882935 851.314691901207 1099.866999387741 866.077011525631 680.2503914386034 1224.4683039188385 1014.8480814695358 1379.3623876571655 1383.231161236763 801.9684609770775 1063.1140750646591 975.4250180721283 1171.1228322982788 717.6321652531624 748.2703459262848 1224.276704788208 842.6120412349701 1140.0143039226532 1411.4692342281342 1035.6260594725609 988.4839114546776 1209.4513309001923 1114.5722550153732 1412.6994740962982 839.2797541618347 958.8059839606285 1413.9751327037811 1261.4022326469421 1077.6276421546936 1415.775431394577 1044.8693093657494 1412.4924075603485 1411.0888075828552 1254.2554867267609 1018.9871323108673 979.8921254277229 826.3561335206032 1306.083409190178 1071.562675833702 1415.635285973549 1102.0671260356903 1384.9614095687866 1405.1123988628387 1061.4829343557358 1406.830621957779 847.6122376322746 768.4813272953033 1005.9829559922218 1191.8956917524338 1420.2157390117645 1012.1408608555794 1414.920164346695 1289.414061307907 1299.3468177318573 1413.7061071395874 1412.6694333553314 856.0516965389252 1406.432671546936 1306.169195175171 937.9846435785294 1369.928343296051 1160.2949333190918 1241.2340772151947 1432.0989084243774 902.9156324267387 713.7520397827029 757.0322957634926 942.440530359745 )
set w1_array = ( 1241.715497970581 1266.881914138794 1325.4547786712646 1218.1875896453857 1215.6336498260498 1304.2348098754883 1143.9271640777588 1202.9058170318604 1233.5144710540771 1270.7626056671143 1182.7753257751465 1216.0495471954346 1235.5367374420166 1225.44114112854 1172.5275230407715 1320.130558013916 1222.0737171173096 1212.3923969268799 1093.524570465088 1039.0842151641846 1316.7738628387451 1236.2262439727783 1224.6229839324951 1200.309534072876 1170.056505203247 1230.4766368865967 1274.445743560791 937.417812347412 1238.6021327972412 1032.147617340088 1218.2520580291748 1208.788080215454 1224.8869609832764 1160.4255390167236 1095.763463973999 1226.6861629486084 1236.1152362823486 1074.677391052246 1145.1574993133545 1202.3805332183838 1092.6098537445068 958.0423069000243 1229.8607540130615 1230.637378692627 1132.870454788208 1305.7011318206787 1233.148546218872 1113.1117534637451 1224.9525260925293 1228.5886001586914 1223.033685684204 1225.87477684021 1243.733139038086 1118.60200881958 1186.811990737915 1086.0712718963623 1216.492338180542 1258.8293743133545 1068.9899158477783 1056.8537425994873 1266.5651988983154 1248.806447982788 1226.8883419036865 1226.8634510040283 1228.3631992340088 1322.6540279388428 1308.0637645721436 1170.785493850708 1322.502965927124 1283.193702697754 1158.943099975586 1297.7193069458008 1208.8232707977295 1240.117425918579 1225.6594371795654 1248.7201881408691 1036.0870552062988 1037.4893856048584 1190.6915855407715 1324.3236255645752 1117.468376159668 1039.8175430297852 1221.0518550872803 1199.2838096618652 1257.7201080322266 1082.489366531372 1311.0618305206299 1326.3658237457275 1315.131492614746 1233.8086795806885 1325.6646823883057 1227.030439376831 1227.3883533477783 1253.788251876831 1157.369680404663 1080.9611511230469 1236.2592887878418 1236.5542125701904 1231.6284847259521 1149.758596420288 1191.5896606445312 890.1521396636962 1164.115924835205 1226.9973468780518 1262.9616451263428 1257.0380878448486 1124.4735431671143 1147.8193950653076 1234.0780448913574 1125.7684898376465 1137.6693439483643 1209.5177841186523 1214.4483280181885 1229.8583698272705 1164.138240814209 1323.1092166900635 1226.79292678833 1233.8068675994873 1190.1630115509033 1154.5510005950928 1258.4876251220703 1234.1770839691162 1233.7403964996338 1317.9300022125244 1228.100986480713 1228.3049297332764 1309.8244857788086 1203.1202030181885 1327.1927547454834 1308.7604236602783 1183.0971431732178 1233.7881755828857 1151.6714763641357 1232.9845142364502 1210.7297611236572 1202.2822093963623 1271.4045238494873 1226.540822982788 1264.0424919128418 1278.2613468170166 1228.4668636322021 1238.0548667907715 1229.9711418151855 1218.760747909546 1232.405252456665 1140.6448078155518 1310.4846668243408 1209.443588256836 1314.6956157684326 1225.4756164550781 1232.4486446380615 1319.1753578186035 1327.0987224578857 1103.8584423065186 1239.0005779266357 1228.864164352417 1163.219804763794 1248.6634922027588 1120.2183437347412 1229.4948291778564 1279.7065448760986 1070.4486560821533 1160.9535884857178 1185.366792678833 1046.7520904541016 )
set r_array = ( 3.4420391853153703e-06 6.635099326372146e-06 5.364901696443558e-06 6.6352365660667414e-06 6.6345906007289885e-06 6.2802363681793205e-06 6.639685456752777e-06 6.644365464448929e-06 6.633360360860824e-06 6.628109713196754e-06 6.647492473125457e-06 6.646548335552215e-06 3.1435595854371784e-06 6.6340036439895625e-06 6.627255653142928e-06 5.972247247695922e-06 6.6517889249324796e-06 6.635763173103332e-06 6.640750293731689e-06 6.6370148706436155e-06 4.909096037149429e-06 6.629637007713317e-06 6.636026476621628e-06 6.63697910785675e-06 6.632437680959701e-06 6.649684731960296e-06 4.054390129745007e-06 6.609950040578841e-06 6.66610610961914e-06 6.6369518387317655e-06 6.6340805339813225e-06 6.637790923118591e-06 6.634719346761703e-06 6.643733804225921e-06 6.627890666127204e-06 6.6375441598892205e-06 6.629970942735672e-06 6.635983561277389e-06 6.640723918676376e-06 6.646394555568695e-06 6.6355468082427976e-06 6.61133897781372e-06 6.645740096569061e-06 6.64552864909172e-06 6.625082840323448e-06 6.279596437811851e-06 6.645581846237182e-06 6.621254657506942e-06 6.63264510512352e-06 6.644564394950867e-06 6.636459653377533e-06 6.633561079502105e-06 6.668056075572967e-06 6.632057701349258e-06 6.6456193971633904e-06 6.6355356323719024e-06 6.634338026046753e-06 3.78799905359745e-06 6.623566274642944e-06 6.636269663572311e-06 3.922576879262924e-06 6.675060664415359e-06 6.6419577348232265e-06 6.645580058097839e-06 6.632395212650299e-06 5.873842810392379e-06 6.211832885742187e-06 6.646173720359802e-06 5.095224131941795e-06 6.5480696904659266e-06 6.646221106052398e-06 6.408189808130264e-06 6.648971264362335e-06 3.398656019121408e-06 6.6342490661144255e-06 3.6002963344752788e-06 6.636918311119079e-06 6.6369648027420036e-06 6.635965679883956e-06 5.206679974794387e-06 6.6315664100646965e-06 6.636769001483917e-06 6.633824383020401e-06 6.636936639547348e-06 6.669550513029098e-06 6.6356160986423485e-06 4.74614915728569e-06 5.5279779928922646e-06 6.101457749605179e-06 6.636246864795685e-06 5.310277839303016e-06 6.640832548141479e-06 6.645493780374527e-06 6.67493772983551e-06 6.6167304414510725e-06 6.6397176432609555e-06 6.6293772804737084e-06 6.662181590795516e-06 6.633359019756317e-06 6.641902749538421e-06 6.6363724815845486e-06 6.59515542268753e-06 6.646252845525741e-06 6.63988483428955e-06 6.657457773685455e-06 6.6608248400688165e-06 6.634457831382751e-06 6.639724795818328e-06 6.632379566431045e-06 6.644162063598632e-06 6.6259386885166165e-06 6.633145337104797e-06 6.647003864049911e-06 6.633829300403594e-06 6.645027523040771e-06 5.137205843925476e-06 6.6408830630779265e-06 6.636903111934662e-06 6.647460286617278e-06 6.643027936220169e-06 3.7820243771374224e-06 6.63295802950859e-06 6.6341748583316795e-06 4.928518359661102e-06 6.645271604061127e-06 6.6445170092582695e-06 4.716343556642532e-06 6.639855777025223e-06 5.502950077056885e-06 6.19702709197998e-06 6.645737414360046e-06 6.640284483432769e-06 6.636828904151916e-06 6.6340103495121e-06 6.649494295120239e-06 6.642183487415313e-06 4.004066971242428e-06 6.641141449213028e-06 6.6535761702060694e-06 6.586145882606506e-06 6.642434720993042e-06 3.025455580204725e-06 6.6335807490348815e-06 6.633102421760559e-06 6.635574971437454e-06 6.64541331410408e-06 6.211058621406555e-06 6.637321536540985e-06 4.834968720674515e-06 6.648814355134964e-06 6.6540826606750486e-06 5.9663074958324425e-06 5.540576999187469e-06 6.635440860986709e-06 3.36626571893692e-06 6.653634731769562e-06 6.636345212459564e-06 6.66957062959671e-06 6.643490170240402e-06 6.6423140215873715e-06 2.7544561616331336e-06 6.6359013068675995e-06 6.624332939386368e-06 6.635234330892562e-06 6.636349682807922e-06 )
set i = 165
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
