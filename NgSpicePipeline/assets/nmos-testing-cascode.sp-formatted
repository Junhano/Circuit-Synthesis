nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1237.32077896595 1365.7763731479645 1172.0365715026855 1067.135242819786 1117.2585767507553 1364.1418796777725 1011.3744643330574 728.1943523138762 1416.3888078927994 995.8130252361298 733.6203549802303 1317.4442183971405 1362.1891421079636 1083.5272949934006 1318.6877351999283 1165.2117800712585 1252.7805399894714 937.7372992038727 763.4844724833965 1405.3885769844055 1344.9354749917984 708.626684807241 1327.1242213249207 865.9141567349434 702.3176123201847 1151.300100684166 1081.8925780057907 985.4972046613693 1269.4964241981506 759.3306247889996 767.9898683726788 1187.9478824138641 833.2605977356434 669.2410968989134 1424.7934651374817 1027.9757511615753 1209.4123494625092 990.2087059617043 700.2816648036242 1121.0944932699203 1302.3925107717514 1245.2072781324387 911.2088438868523 1396.4840006828308 1401.0372740030289 1298.3493041992188 950.2635058760643 1152.5692772865295 1284.05411362648 926.0171410441399 1020.7898226380348 689.0888177603483 1047.6865005493164 981.0623955726624 1056.3480687141418 1089.0396815538406 1291.5959936380386 1290.103970170021 1066.0204273462296 840.3463457524776 780.1150400936604 792.4577277898788 698.7966150790453 1431.3047063350677 1253.035171031952 1357.583789229393 1009.8601561784744 1034.592581987381 1265.312848687172 723.0406720936298 990.455938577652 1277.654720544815 1267.2469002008438 1221.3515770435333 1208.6870801448822 1188.5970664024353 976.8671748042107 729.163473546505 1301.6456943750381 1423.5312175750732 823.1511060893536 1024.788325726986 1380.357129573822 1316.2869346141815 1374.774335026741 699.5352842658758 721.4121633023024 1169.0914165973663 902.4144393205643 805.993629693985 1365.5007761716843 1217.0650494098663 746.7813343554735 1188.9677476882935 1052.7495276927948 1267.589150071144 815.0444087386131 693.0494122952223 1247.4388313293457 984.692810177803 695.3004338592291 1130.0849449634552 1390.0252413749695 1058.1686180830002 1056.7322951555252 708.2833369076252 751.4840234816074 1089.8521673679352 1289.2238479852676 907.9009202122688 772.1690629422665 1328.8911265134811 724.0710091590881 842.5227236747742 804.7921565175056 1180.9630972146988 1268.428413271904 1007.4737724661827 1044.6752962470055 1194.363860487938 948.4112840890884 928.7603032588959 709.2554951831698 824.5949727296829 729.1496210545301 1250.9011608362198 1367.572961449623 1005.0498378276825 1227.774394750595 733.598221167922 913.2770282030106 1052.6329857110977 710.0553354993463 742.3072532564402 1232.9082769155502 1102.3963224887848 712.1067029237747 1355.0684583187103 1340.397937297821 1322.382344007492 967.2892299294472 765.2664092183113 1105.4968667030334 692.9250695556402 983.4959861636162 802.2012320160866 1304.4309896230698 1374.2491137981415 1074.926836490631 1331.0329151153564 1298.2993704080582 1072.5803953409195 956.1246466636658 720.1036364585161 1341.5108752250671 997.939435839653 749.7114633023739 714.263819232583 1419.2402642965317 995.7734403014183 682.1471211314201 666.5592343360186 1294.351516366005 668.7618029117584 )
set w1_array = ( 999.7834396362304 964.5272684097289 992.2779273986815 947.893042564392 1066.2193012237549 1108.235092163086 967.4215745925902 1058.9010906219482 1269.070167541504 1132.1525764465332 1124.7574043273926 961.8756008148192 1036.4300918579102 1079.2051029205322 915.5863475799559 941.7437505722045 1022.2336483001708 975.8779001235961 1131.5365028381348 1160.0973320007324 1058.7247562408447 969.4236469268798 972.7222633361815 1065.2762603759766 945.9800910949706 986.0503864288329 1015.2082157135009 1020.296926498413 1014.9819564819335 1073.1204223632812 1071.4495849609375 1019.2524623870848 1011.5472269058226 755.6747508049011 1296.851463317871 993.3422756195067 994.4738101959227 1135.0269508361816 1041.7113018035889 1039.0540313720703 1022.4223327636718 1027.015085220337 1022.0752906799315 1130.6257915496826 1145.5902767181396 994.5741367340087 999.669427871704 996.355218887329 1015.1287269592284 971.5366554260253 1078.6039543151855 1034.6076202392578 951.907033920288 1015.2795028686522 1004.1497421264647 1006.9680881500243 998.9758682250975 961.2280082702636 1044.4978427886963 1030.9190464019775 1100.342197418213 1038.2422637939453 1072.0164012908936 1161.1843299865723 967.3840951919555 1077.1517944335938 1045.0428199768066 1022.6888370513915 1014.7986602783202 1001.7216396331786 1048.391981124878 948.538680076599 1009.2550706863402 1030.6723308563232 1027.8675270080566 1019.9584197998046 993.7849235534667 1024.9808025360107 975.4052114486693 1276.602954864502 1108.8672828674316 1026.6556930541992 1020.9278297424315 960.1800632476806 1110.0646686553955 1071.7711639404297 1044.2216110229492 942.1458911895751 1050.1808834075928 1117.5426197052002 1089.1701889038086 998.6960124969481 1085.063762664795 992.2232341766356 1065.796775817871 949.23526763916 1057.8878593444824 884.0334129333495 1002.8976154327391 1018.7133502960204 1060.6664371490479 997.6757717132567 1158.0867004394531 1076.9042205810547 1089.513988494873 994.7259378433226 1088.875789642334 1079.921932220459 1006.1620903015136 1045.5921363830566 1024.0414810180664 973.8642406463622 1022.7247428894042 1102.3952674865723 1059.522409439087 1024.8662185668945 982.1786832809447 992.1847534179686 1089.4331169128418 1015.7896709442138 1077.5594902038574 1005.5017900466918 971.019525527954 1103.3720684051514 1121.9387245178223 968.052430152893 1140.780849456787 1040.9955215454102 1030.4657649993896 1057.9098415374756 1041.0805416107178 950.7350397109984 1010.682554244995 1080.6481552124023 997.5936603546141 1032.9136085510254 1066.5196132659912 1017.6857185363768 984.6576642990111 966.9961166381835 1047.23708152771 1071.5235900878906 1032.143325805664 1016.8840122222899 1053.6660861968994 1037.6552295684814 980.4186058044432 1155.645866394043 1010.5253410339354 984.3083095550536 1018.4930992126464 1086.049861907959 997.8873443603514 1113.7928199768066 985.3907060623168 1040.4729557037354 1075.747652053833 1021.0180473327636 1119.9610424041748 990.9867954254149 1018.0685710906981 643.4505787491798 927.3382139205931 816.4956760406493 )
set r_array = ( 3.5922449576854703e-06 2.861951080262661e-06 3.6386988061666488e-06 6.660846297740936e-06 2.891385753750801e-06 5.102597748041153e-06 6.6674838709831234e-06 3.658529606759548e-06 4.3809883046150205e-06 4.408927870094776e-06 6.668041323423385e-06 5.8539318788051605e-06 5.8479809510707855e-06 2.900855627954006e-06 2.9126588004827496e-06 4.380840559601784e-06 6.626216744184494e-06 2.8685132163763044e-06 6.662439976930618e-06 5.8405999588966366e-06 5.127165665030479e-06 5.893909757137298e-06 5.846571897268295e-06 4.411502678990363e-06 5.897937541007996e-06 6.643875067234039e-06 5.906251047849655e-06 2.8746631863713264e-06 6.660239671468734e-06 4.426333953738212e-06 4.417050381302834e-06 6.626919482946395e-06 5.145215814113617e-06 4.352940221428871e-06 4.383040306270122e-06 5.910213564634323e-06 3.5935763391852377e-06 4.411679593026638e-06 4.398697254359722e-06 5.127173935174942e-06 4.392993648648261e-06 6.666858022212981e-06 5.1479755836725235e-06 5.85646053135395e-06 5.848582659959793e-06 6.622539435625076e-06 5.911312376260757e-06 3.62891734868288e-06 3.5817334923148154e-06 2.888933879435062e-06 5.161215637922286e-06 6.671541159152984e-06 6.652963285446166e-06 2.875808824896812e-06 5.885285114049911e-06 3.668980722427368e-06 6.628098313808441e-06 5.1441701996326445e-06 4.3842220428586005e-06 5.878470515012741e-06 3.66659176826477e-06 5.8763757097721095e-06 6.672277872562408e-06 6.557888363599777e-06 2.891095181107521e-06 3.6231560754776e-06 2.9089923325181006e-06 3.6574322479963302e-06 6.617981021404266e-06 5.876509373188018e-06 3.6445816169679164e-06 5.849802618026733e-06 3.611871351599693e-06 6.640314434766769e-06 6.659025971889495e-06 2.8431377309560772e-06 5.920652275085449e-06 5.163802181482315e-06 5.155382727384567e-06 5.080634926557541e-06 6.652932887077331e-06 3.639138688445091e-06 6.6202099370956416e-06 5.898030971288681e-06 3.5961382399499416e-06 6.661993836164474e-06 3.6647716100513935e-06 4.352359970211982e-06 6.65547025680542e-06 6.64830518245697e-06 3.6017678055167197e-06 5.911157255172729e-06 3.669574049413204e-06 3.619900767803192e-06 4.393583399355411e-06 2.8658129024505616e-06 4.421570574045181e-06 3.6606978374719617e-06 3.5810152749717232e-06 2.8954286250472067e-06 6.672503178119659e-06 3.670007226169109e-06 3.5826628777384754e-06 2.913436082303524e-06 5.158837412595749e-06 3.649411269575357e-06 3.669797008037567e-06 2.8733230876922606e-06 4.363856923878192e-06 6.655219470262527e-06 5.140271832346916e-06 5.875731979608535e-06 5.165829931497573e-06 3.64940456405282e-06 4.425281969010829e-06 2.864779357910156e-06 4.384948809742927e-06 5.904130314588546e-06 5.149291430711746e-06 2.840942342877388e-06 3.638639685809612e-06 5.9139016020298e-06 5.885819767713546e-06 3.6727059195935723e-06 6.670011405944824e-06 4.371878516972064e-06 4.378006805777549e-06 2.893152994215488e-06 6.657292370796203e-06 2.9009612399339673e-06 6.654905204772949e-06 6.650148307085037e-06 5.165480797290801e-06 3.6691495898365974e-06 3.620360654890537e-06 5.870570962429046e-06 2.8890401619672774e-06 5.8826690661907195e-06 6.632482384443283e-06 5.850267534255981e-06 5.159356420040131e-06 4.4256048399209975e-06 5.893463169336319e-06 4.399682742655277e-06 3.645639692544937e-06 5.875993942022323e-06 5.139603291749954e-06 4.377497856616974e-06 5.910237704515457e-06 6.639112805128097e-06 4.3528652313351625e-06 5.153088991641998e-06 5.926103864908218e-06 6.6736958670616145e-06 6.644530420303344e-06 3.621028804332018e-06 4.418911052048206e-06 3.6562933708727357e-06 6.5801833319664e-06 5.928857599496841e-06 2.8780462342500687e-06 3.6873652535676956e-06 2.893487599790096e-06 6.630982135534286e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
