nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1235.6427890062332 737.1331882476807 810.4069922864437 1355.4959577322006 1387.837855219841 1047.7217715978622 1330.3420674800873 1171.2716054916382 1353.9744299650192 810.1811726391315 1361.586583852768 1401.4126938581467 779.7213365137577 1356.4200234413147 1361.7752772569656 1034.659883081913 1399.1017025709152 949.9499779939651 1072.7646631002426 811.26031473279 1186.2450820207596 698.7090605124831 918.8232553005219 1059.1727030277252 1390.5252051353455 1375.041840672493 875.0706148147583 1130.5777114629745 1037.846503853798 975.7085499167442 1111.4322823286057 1259.5051509141922 1062.672449350357 1384.7222012281418 1050.654588341713 1070.6716459989548 995.7001042366028 1172.1966099739075 1217.315165400505 879.9281176924706 1394.6388643980026 1387.0124053955078 1363.0642575025558 1199.3786525726318 1298.9496272802353 1141.5625643730164 1267.4397510290146 1384.7618979215622 934.1286551952362 1078.4164798259735 1393.3810871839523 888.8435569405556 1401.3183695077896 1384.7860378026962 1388.6163663864136 1399.6506613492966 793.0522729456425 1390.4509973526 1268.5339134931564 1400.1135659217834 957.5836342573166 1130.6926888227463 761.4450436830521 1200.297890305519 1312.670065164566 1442.3256349563599 761.6112624108791 960.0897786021233 875.6476697325706 1393.9809185266495 1387.3969000577927 1008.155522942543 801.3084252178669 834.9765409529209 1174.8957169055939 892.8588908910751 752.2239052504301 1357.2992515563965 737.2819949686527 874.0872052311897 1459.9803817272186 1396.3573557138443 775.3693741559982 1068.821860551834 1117.851613163948 961.000634431839 1130.4844152927399 1383.5833352804184 850.9614785015583 1403.2356572151184 1143.638415336609 997.1299228072166 1196.4703780412674 1061.982764005661 843.8704666495323 884.8957476019859 1090.526698231697 951.817376613617 1029.1807782649994 828.2677327096462 1107.3283237218857 1395.3608256578445 855.9160773456097 1397.1068543195724 987.5549954175949 1393.4808653593063 897.5239899754524 1392.9520231485367 1346.9929975271225 1395.483313202858 970.6044626235962 925.9182792901993 1362.1358108520508 813.7033601105213 1385.5828326940536 1400.99185526371 1336.639894247055 1200.8138579130173 920.2239495515823 865.05924731493 1313.7741965055466 1384.848667383194 1301.7818611860275 1134.8388475179672 1191.8157172203064 1403.5172444581985 957.9854291677475 795.3533959388733 1383.3933454751968 1353.9427798986435 1225.212214589119 1016.4160114526749 1386.2446230649948 1131.9421511888504 1391.5527147054672 1422.330482006073 864.5783942937851 1401.7242324352264 1041.820107102394 1389.3779796361923 964.5790141820908 1372.0676732063293 1390.03673017025 1190.107552409172 816.7925943434238 1279.7652167081833 1106.6697520017624 1404.2120707035065 1399.0480583906174 1400.5856794118881 702.3325907811522 747.5614269077778 1363.983182311058 1342.2774505615234 1236.5424019098282 1253.70840549469 1361.7716562747955 1154.371766448021 861.3705170154572 1314.0164893865585 844.7746057808399 1386.230496764183 1088.6948388814926 1173.546878695488 )
set w1_array = ( 1133.0812644958496 915.8375215530394 1220.4340648651123 1220.9311199188232 1263.8649654388428 1137.287015914917 1193.4708309173584 1117.1540927886963 1214.966745376587 1198.971290588379 1224.9784660339355 1344.569845199585 1153.353567123413 1220.2376079559326 1226.4561367034912 1156.9224548339844 1101.698751449585 1207.8785610198975 1143.811960220337 1215.0002193450928 1119.3848323822021 537.2576665878296 1234.3086910247803 1135.8002376556396 1356.0625743865967 1242.5450992584229 1257.2554779052734 1116.5363025665283 1144.3048191070557 1196.3602256774902 1121.1846542358398 1144.1251945495605 1137.2159671783447 1317.4697589874268 1139.7788715362549 1133.7588024139404 1182.140417098999 1115.5832481384277 1127.4866771697998 1243.5523223876953 1357.4071598052979 1349.0719509124756 1225.2605152130127 1121.0464191436768 1171.767921447754 1113.8687801361084 1148.2806873321533 1308.1158351898193 1210.6426429748535 1128.2884788513184 1357.63747215271 1248.5768508911133 1297.2387504577637 1321.5373706817627 1264.0776348114014 1345.528907775879 1178.8615894317627 1266.7820644378662 1149.8666954040527 1337.525577545166 1194.9850749969482 1114.2949771881104 1071.0506629943848 1127.765245437622 1179.113359451294 779.3308210372925 1083.2750034332275 1190.6418991088867 1248.5964965820312 1160.7905101776123 1347.2753715515137 1159.0899181365967 1212.4610614776611 1244.9046802520752 1118.8650798797607 1241.9752311706543 1018.542833328247 1218.0838298797607 896.9206285476683 1245.728464126587 696.6605615615845 1283.8514041900635 1125.8057308197021 1139.0051078796387 1116.484088897705 1192.4033832550049 1118.325538635254 1254.021234512329 1254.0403079986572 1321.1876583099365 1117.4738597869873 1165.9417819976807 1120.8970737457275 1130.832405090332 1251.008768081665 1245.482988357544 1121.0775089263916 1222.1472454071045 1146.9583702087402 1242.912836074829 1125.4864406585693 1355.2399826049805 1251.7419528961182 1354.1012477874756 1172.374792098999 1273.42435836792 1232.725305557251 1166.7318058013916 1209.106035232544 1277.3268413543701 1193.6742496490479 1223.6328315734863 1224.1333198547363 1219.9448776245117 1324.47998046875 1297.9454231262207 1198.3697605133057 1123.6754131317139 1233.0425930023193 1250.8288097381592 1178.329725265503 1325.9043407440186 1172.245569229126 1114.988775253296 1121.612377166748 1332.0616436004639 1197.845287322998 1203.6223602294922 1253.0170631408691 1215.5395698547363 1131.1059188842773 1162.7117824554443 1293.5937118530273 1114.0876483917236 1273.8050174713135 898.8867950439452 1243.7714290618896 1340.4741477966309 1140.1440334320068 1353.1203937530518 1187.3921585083008 1236.6446208953857 1273.4203052520752 1118.7073421478271 1235.0307178497314 1155.2943897247314 1120.0526428222656 1328.7936401367188 1292.644853591919 1298.9326667785645 557.910532951355 946.9198179244994 1225.8087348937988 1207.0967388153076 1138.6500549316406 1143.0029582977295 1228.2667827606201 1113.9133167266846 1248.7583827972412 1182.6721858978271 1251.3563823699951 1262.5398349761963 1130.7810020446777 1123.745937347412 )
set r_array = ( 6.6462304937839506e-06 6.747863416671753e-06 6.695152198076248e-06 6.538384457230567e-06 6.339398522973061e-06 6.613759894967078e-06 6.617215027213096e-06 6.616113309860229e-06 6.56911899626255e-06 6.689015750885009e-06 6.531657477021217e-06 5.459904422163963e-06 6.720412795543671e-06 6.5451297658681864e-06 6.5230574208498e-06 6.6286340850591655e-06 3.6306629079580303e-06 6.660447095632552e-06 6.619327266812324e-06 6.6928758966922755e-06 6.621914480924606e-06 6.711572234630584e-06 6.672985081672668e-06 6.6122346121072765e-06 4.841293593049049e-06 6.457745854854583e-06 6.6772614169120785e-06 6.605611343979835e-06 6.618841339945793e-06 6.655740712881088e-06 6.604600151181221e-06 6.654392902851105e-06 6.613185678720474e-06 4.306884680986404e-06 6.615029250383377e-06 6.610781748890876e-06 6.6467414546012876e-06 6.6179698455333705e-06 6.63577300786972e-06 6.6751804697513574e-06 5.028231491446494e-06 4.6467819187045095e-06 6.534732629656791e-06 6.629996200203895e-06 6.637959455251693e-06 6.608448674082755e-06 6.655993287563324e-06 4.246259604692459e-06 6.660083209276199e-06 6.607715089917183e-06 4.953088064789772e-06 6.6769771027564995e-06 6.08507101714611e-06 4.3362488347291946e-06 6.340575118660927e-06 5.4278196144104e-06 6.707445656061172e-06 6.3250455754995346e-06 6.65299278974533e-06 5.570277323126792e-06 6.652074580192565e-06 6.606169243454933e-06 6.737412636280059e-06 6.62356672167778e-06 6.638309036493301e-06 3.2001953787356615e-06 6.738021944761276e-06 6.649074082374573e-06 6.677505497932433e-06 3.746471864283085e-06 4.6055921289324755e-06 6.629098107218742e-06 6.7015416669845575e-06 6.683987503051757e-06 6.6164758551120754e-06 6.674698566198349e-06 6.743795846700668e-06 6.5607648092508315e-06 6.743270580768585e-06 6.676435296535491e-06 3.113370973728597e-06 6.196162303090095e-06 6.724240307807922e-06 6.614951242804527e-06 6.60403085231781e-06 6.6503745067119595e-06 6.605580722093582e-06 6.402509336471557e-06 6.677828257083892e-06 5.820369620919227e-06 6.60768111526966e-06 6.633691166639328e-06 6.62766357243061e-06 6.609341402649879e-06 6.681949471235275e-06 6.676141594648361e-06 6.604368810653686e-06 6.6701718914508815e-06 6.620725144743919e-06 6.687274997234344e-06 6.606629465818405e-06 5.142650951743125e-06 6.680572603940964e-06 5.205070649385452e-06 6.638173584938049e-06 6.279675115942955e-06 6.670115118026733e-06 3.761366729736328e-06 6.58185412466526e-06 6.25292231619358e-06 6.65282828092575e-06 6.6675978648662566e-06 6.538797070384025e-06 6.6916067647933954e-06 4.354687345325947e-06 6.07624587893486e-06 6.609823976755142e-06 6.626884390711784e-06 6.672289495468139e-06 6.678940032720565e-06 6.644628767967224e-06 4.370662023425102e-06 6.641751651763916e-06 6.606588115096091e-06 6.6230229038000105e-06 5.6751557189226145e-06 6.654147033691406e-06 6.7058394598960875e-06 6.409596403241157e-06 6.565595914721489e-06 6.637522702217101e-06 6.632263784408569e-06 4.161366348266601e-06 6.606131692528724e-06 6.268715609908103e-06 3.3377656555920837e-06 6.675869797468185e-06 5.533519883751869e-06 6.615704496502876e-06 4.720303502976894e-06 6.646985535621642e-06 6.488992472290992e-06 6.266203274130821e-06 6.625505958795547e-06 6.691554908752441e-06 6.656978105306625e-06 6.604098354578018e-06 5.725311686396598e-06 6.12187584221363e-06 6.0640322166681284e-06 6.7100362229347225e-06 6.7377653467655174e-06 6.534119297862052e-06 6.579856325984001e-06 6.636734579801559e-06 6.647755329608917e-06 6.51168753683567e-06 6.611606528162956e-06 6.678781782388687e-06 6.626898025274276e-06 6.6817961382865905e-06 6.344302048087119e-06 6.609005455970764e-06 6.61470738530159e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
