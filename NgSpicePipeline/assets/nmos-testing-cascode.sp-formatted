nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1057.6072764396667 1410.7998889684677 1412.736890912056 830.1179763674736 1417.2576200962067 890.456101000309 919.1859570145607 1398.7322729825974 924.2987838387489 1388.8868671655655 1380.3516310453415 1426.036937236786 1411.602584719658 1427.4191689491272 955.5557054281235 1415.1185137033463 1428.778691291809 1259.5571410655975 1415.1965659856796 1398.9546728134155 670.6092246621847 1106.4439100027084 1055.9439045190811 1210.910318493843 1416.0375279188156 1285.883782505989 1091.059474349022 990.2459439635277 1404.0112626552582 1385.0503247976303 1239.4416463375092 1415.2064901590347 1423.1581223011017 947.1833017468452 960.4305756092072 1344.9507635831833 1416.943399310112 874.0108740329742 801.4336955547333 758.4159691631794 1390.3452289104462 869.7878700494766 1409.325299859047 1391.1445719003677 1004.3053236603737 688.80759652704 1335.5042916536331 1042.6627454161644 746.7530035227537 860.4385164380074 1106.195895075798 947.1217450499535 1388.878909945488 841.8364134430885 1416.5344071388245 1256.0864520072937 935.0297209620476 1389.0509289503098 1394.109709262848 1055.4147493839264 1411.4065599441528 1265.2453911304474 881.0196426510811 1276.2641739845276 1410.3101176023483 1024.6962812542915 1254.9223732948303 1066.3494002819061 838.469749391079 1245.0121027231216 1359.1819834709167 1019.394716322422 1404.4951778650284 964.2072600126266 1168.389258980751 1382.2436165809631 859.9479404091835 1389.2291170358658 1422.9557943344116 1050.731388926506 1157.630382180214 895.9613126516342 1209.606049656868 669.8826030641794 1125.0405591726303 1022.3529469966888 1331.6917997598648 1216.7595010995865 716.2674908339977 952.1137383580208 1239.7524696588516 1428.1408619880676 1217.2609847784042 752.2377968579531 1415.580568909645 1157.2204512357712 955.5769619345665 1270.968822836876 1406.0104471445084 1303.7122470140457 1209.1550809144974 882.6258835196495 731.8912074714899 1264.2510515451431 1047.2083520889282 1137.7055031061172 721.4096766710281 1277.0056706666946 1302.3392242193222 1305.0852698087692 809.4860222935677 1380.7590585947037 1000.8156803250313 847.9749840497971 708.4081741794944 1032.5105395913124 1144.4356572628021 969.9162524938583 1416.6403990983963 1028.2866862416267 1418.9897459745407 1407.8984540700912 798.3128336071968 1010.8297523856163 836.6862815618515 1400.0276011228561 1418.9935904741287 1100.3407669067383 1357.8038197755814 1411.55493080616 1187.1643197536469 1390.710501074791 1409.2042875289917 1418.524248600006 1427.1234107017517 766.6351181268692 1332.5623553991318 1427.2624385356903 1306.0007971525192 1411.4309680461884 1427.0792436599731 1392.3408818244934 828.6947962641716 788.003137409687 691.1260505020618 1389.7373509407043 1367.2870379686356 1413.8577860593796 961.656993329525 1010.0722965598106 1057.0118260383606 822.7972668409348 1176.1785727739334 880.1126313209534 1392.6341366767883 1288.3541864156723 1401.615111231804 1415.4629987478256 1015.8836376667023 1153.3253920078278 1123.11039686203 921.5657916665077 671.0345056653023 1026.2375903129578 )
set w1_array = ( 1234.5369052886963 1263.1981086730957 1293.1822967529297 1218.073434829712 1300.4155349731445 1216.7424869537354 1201.8204879760742 1238.6512470245361 1201.241798400879 1248.7678241729736 1259.8450374603271 1305.2121829986572 1274.6770572662354 1304.8933696746826 1223.5328388214111 1276.2406063079834 1306.8388652801514 1237.9151058197021 1294.666166305542 1240.2500343322754 816.874701976776 1226.604528427124 1140.9593772888184 1235.4831409454346 1290.3630924224854 1241.3974475860596 1238.046474456787 1224.353666305542 1244.6295928955078 1256.987066268921 1235.6200885772705 1277.321548461914 1291.0813999176025 1223.045415878296 1154.6802234649658 1246.4720916748047 1300.3424835205078 1222.6901721954346 1200.0285816192627 1182.163257598877 1262.1677112579346 1222.3332118988037 1256.1677646636963 1264.3233966827393 1149.8054218292236 1058.461446762085 1247.18825340271 1200.345106124878 1174.990530014038 1197.4288654327393 1236.2405490875244 1228.573293685913 1248.4664630889893 1218.0820178985596 1296.766061782837 1237.3033714294434 1201.4251899719238 1242.8580474853516 1266.8260288238525 1236.1662578582764 1283.2441520690918 1224.3091297149658 1166.3611125946045 1202.6934337615967 1256.298131942749 1233.0042552947998 1223.2213687896729 1236.8575286865234 1208.8770580291748 1226.3848972320557 1252.7245235443115 1234.0267848968506 1245.7072925567627 1229.925889968872 1240.3809261322021 1260.5241012573242 1196.9248008728027 1242.0211505889893 1293.0251789093018 1227.15012550354 1240.2372550964355 1217.1508026123047 1240.541524887085 791.016252040863 1230.134220123291 1225.6498050689697 1246.3000965118408 1240.5118656158447 1085.0471687316895 1228.5134029388428 1236.6324138641357 1291.1178302764893 1236.2047863006592 1199.414987564087 1296.475429534912 1205.875654220581 1155.3864192962646 1240.8237648010254 1247.9960632324219 1232.7198696136475 1225.2474975585938 1199.5196533203125 1109.3800735473633 1237.8922176361084 1146.002836227417 1202.9145908355713 1093.8731384277344 1226.2103748321533 1238.8727378845215 1214.881010055542 1202.5289249420166 1259.380407333374 1199.962968826294 1166.2894439697266 1107.7670764923096 1225.8038711547852 1203.8801860809326 1153.3717823028564 1298.649377822876 1225.9557437896729 1282.1655941009521 1274.2757511138916 1208.5887622833252 1199.9158573150635 1216.2499618530273 1239.8389530181885 1296.8263339996338 1143.6250400543213 1249.9738883972168 1284.9485111236572 1211.1902904510498 1264.506025314331 1253.7062358856201 1303.1026554107666 1295.5648612976074 1198.167486190796 1228.4705352783203 1292.7007389068604 1216.6533184051514 1268.1273174285889 1301.6261291503906 1262.0947551727295 1162.983865737915 1210.8023357391357 1016.8983888626097 1256.4402770996094 1253.4356784820557 1292.3915100097656 1229.7804546356201 1198.6743640899658 1199.0329456329346 1213.8935279846191 1164.7980403900146 1215.6640720367432 1236.6958332061768 1208.3202075958252 1242.4475383758545 1296.249361038208 1199.9217224121094 1231.3811492919922 1239.3514347076416 1226.3040256500244 1026.024408340454 1200.0029277801514 )
set r_array = ( 6.660544549226761e-06 4.313562375605106e-06 5.239360232949256e-06 6.639004175662994e-06 5.374791448116302e-06 6.646624331474304e-06 6.645071779489517e-06 3.6114204052090643e-06 6.645111565589905e-06 3.0808452918380496e-06 6.68530759692192e-06 5.877983023524284e-06 4.597712804675102e-06 5.952643652558326e-06 6.65263605594635e-06 4.536527370214462e-06 6.005981837511062e-06 6.655336146354675e-06 5.0839226442575456e-06 3.588895828574896e-06 6.5408154326677315e-06 6.651649003028869e-06 6.636691217422485e-06 6.661979084014892e-06 4.875337083935737e-06 6.65687394618988e-06 6.662089054584503e-06 6.650176023244857e-06 3.8298240798711776e-06 6.680065219402313e-06 6.6504151868820185e-06 4.561708507239818e-06 6.193394263386726e-06 6.651994113922118e-06 6.6351949918270105e-06 6.678619508743286e-06 5.256046702265739e-06 6.642815594673156e-06 6.636829351186752e-06 6.624321092963218e-06 6.6686917591094964e-06 6.642480318546295e-06 4.139759590029716e-06 6.678031210899352e-06 6.636434619426727e-06 6.5774557489156715e-06 6.673598413467407e-06 6.64876026391983e-06 6.619552572369575e-06 6.640362267494201e-06 6.664385025501251e-06 6.647236322164535e-06 3.0847071419656276e-06 6.639706914424896e-06 5.595845704078674e-06 6.655657564401626e-06 6.645536248683929e-06 3.157806585654616e-06 6.678787593841552e-06 6.657424246072769e-06 4.842803676724433e-06 6.650984262228011e-06 6.630229775905608e-06 6.6464839625358575e-06 4.09232483536005e-06 6.656696026325225e-06 6.652341907024383e-06 6.6589884209632866e-06 6.64271367073059e-06 6.630292360782623e-06 6.684064393043518e-06 6.653151934146881e-06 3.8018759089708326e-06 6.6482251632213586e-06 6.666856234073638e-06 6.6844738769531245e-06 6.6401137161254875e-06 3.1750180415064094e-06 6.108854164481162e-06 6.654441629648208e-06 6.6670126962661735e-06 6.646854554414749e-06 6.6630407917499535e-06 6.533923943638801e-06 6.661794905662536e-06 6.652062063217163e-06 6.667151277065277e-06 6.661969249248504e-06 6.584252913594246e-06 6.648885880708694e-06 6.657951300144195e-06 6.416107242107391e-06 6.654303495883941e-06 6.62177299439907e-06 5.517659311294556e-06 6.657398318052292e-06 6.635024224519729e-06 6.6559450078010556e-06 3.9286729815602305e-06 6.651532773971557e-06 6.6296318668127054e-06 6.642574642896652e-06 6.590923120379448e-06 6.65480998635292e-06 6.637426589727401e-06 6.655799721479416e-06 6.586417456269264e-06 6.649946694374084e-06 6.658890073299407e-06 6.646975700855255e-06 6.638492320775986e-06 6.683547620773315e-06 6.647040073871612e-06 6.625406046509742e-06 6.590700497031211e-06 6.656485919952392e-06 6.656398748159408e-06 6.6354967403411864e-06 5.437789608836173e-06 6.652505521774292e-06 6.427111004590988e-06 6.652398233413696e-06 6.637317066192626e-06 6.6473476338386534e-06 6.642111067771911e-06 3.660721418559551e-06 5.764963899850845e-06 6.6399545717239375e-06 6.682971839904785e-06 4.893007476925849e-06 6.658536468744277e-06 6.6815489280223845e-06 4.029592325091362e-06 5.416243647336959e-06 6.1744057881832115e-06 6.629761953949928e-06 6.6556606936454765e-06 6.284126241803169e-06 6.647304718494415e-06 4.4311512011289594e-06 5.995090280771255e-06 6.643302862644195e-06 6.621061314940452e-06 6.6324394690990446e-06 6.572734614014625e-06 3.015368965566158e-06 6.68012646317482e-06 5.0760407495498655e-06 6.648081665039062e-06 6.647063319683074e-06 6.6492582607269286e-06 6.6407681751251215e-06 6.649504576921463e-06 6.64612365245819e-06 3.3670063997805118e-06 6.645973895788192e-06 3.6881318624317645e-06 5.1500627893209455e-06 6.6475242125988e-06 6.663648312091827e-06 6.665519152879715e-06 6.646080290079116e-06 6.562290539145469e-06 6.6479381668567654e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
