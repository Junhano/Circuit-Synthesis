nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1105.5226159095764 736.7777005583048 982.1321275830269 1019.117822945118 755.0892253220081 870.7650882005692 1163.1557774543762 862.3468187451363 706.3636184483767 1422.1775960922241 951.8577885627747 1404.00317132473 1123.1975239515305 1423.3349692821503 1433.5512351989746 1430.3046894073486 1267.050741314888 1423.1827092170715 744.9655179679394 814.2033797502518 1228.732122182846 1418.7610876560211 1054.81505215168 1421.3104379177094 1027.386514544487 1385.236783027649 1423.8959085941315 1230.6295615434647 1426.5326988697052 931.2877488136292 934.3243670463562 1420.8912086486816 1018.9416241645813 1370.9239792823792 1431.3433301448822 1041.987409889698 938.7147185206413 1421.1935830116272 1424.9987435340881 1422.383142709732 1187.3733979463577 1421.8408000469208 890.250241458416 1003.7052464485168 1434.8179531097412 1435.566647052765 1175.0296485424042 888.1506305932999 876.5469697117805 1421.4059245586395 1435.1408910751343 861.1503076553345 1276.835037469864 1314.1012024879456 1278.3932220935822 699.6575035899878 1124.6347856521606 1288.15744638443 1421.4154016971588 1434.1854882240295 1145.9291112422943 1201.1107337474823 1261.4266854524612 1392.516342997551 1397.9011011123657 1026.4084470272064 1037.1914637088776 833.03501278162 711.6436530649662 1059.4453048706055 1421.3148188591003 858.370019197464 1300.2957832813263 1206.0502004623413 972.9300719499588 1423.1639337539673 999.8330754041672 1375.825313925743 1261.6714370250702 1095.7756918668747 1421.1087357997894 758.655848056078 906.2714558839798 1420.8893311023712 1315.5553621053696 957.6400500535965 1420.0901222229004 1094.3372678756714 1390.093458890915 1143.3334928750992 1419.2081224918365 1255.5095088481903 833.2943041622639 1424.567265510559 1352.876244187355 1421.9032061100006 752.6892964541912 1091.3235825300217 1426.318747997284 1422.5811791419983 1083.5175049304962 1065.3339159488678 1241.7653334140778 1422.4447441101074 1421.6204118728638 1131.992397904396 1128.2851827144623 1429.0366303920746 1433.427048921585 1315.1026499271393 1251.7819982767105 1423.2469034194946 1031.4397570490837 812.700482159853 1159.8785650730133 1428.0014765262604 1205.3946685791016 1225.3716719150543 1330.3547185659409 1294.514639377594 868.6229419708252 1367.9041695594788 1448.4141600131989 911.1819100379944 1093.6385077238083 897.9338091611862 1289.9838519096375 976.1050251126289 1424.3542087078094 773.8823351264 826.9565907120705 1420.6957650184631 1431.8599236011505 693.4660934656858 741.5830847620964 739.6421097964048 764.9286185204983 990.8752125501633 1433.5862827301025 898.2447889447212 1006.5857154130936 889.3503826856613 992.6323500275612 974.6408519148827 1290.4307973384857 1186.9559121131897 1430.0125074386597 1422.4011135101318 1420.9284913539886 739.8244217783213 1370.872078537941 734.0890598297119 1169.0515410900116 1415.700865983963 1429.2428922653198 1422.4520754814148 1432.1064186096191 787.3072047531605 1428.9696645736694 696.536026969552 892.7016463875771 1357.452495098114 1424.9980282783508 787.0365028083324 )
set w1_array = ( 1219.1212844848633 1110.503740310669 1240.6178665161133 1239.5165634155273 1133.466453552246 1158.1988525390625 1241.2355136871338 1230.2154731750488 1019.3964672088622 1314.169044494629 1194.4622230529785 1277.2078704833984 1093.7028121948242 1316.6275691986084 1312.482614517212 1314.7750091552734 1228.6247444152832 1312.0926094055176 1192.6782321929932 1163.756103515625 1149.539394378662 1247.3097515106201 1241.1600303649902 1314.4256782531738 1077.887077331543 1283.3533954620361 1311.5293216705322 1196.1075019836426 1317.3079681396484 1200.1864624023438 1201.4750671386719 1314.8304653167725 1243.0565071105957 1263.9850807189941 1284.6337509155273 1084.112663269043 1124.0207862854004 1313.1498527526855 1317.3731517791748 1312.4979209899902 1240.544195175171 1314.109058380127 1243.277187347412 1096.778793334961 1311.0083770751953 1308.303279876709 1241.3187217712402 1207.2893810272217 1243.04048538208 1316.3283061981201 1309.3645763397217 1238.6585903167725 1242.9972839355469 1258.086986541748 1175.8144569396973 977.4818372726439 1217.7304935455322 1211.6625022888184 1311.3385391235352 1292.8667736053467 1218.1414794921875 1219.2934226989746 1202.5898170471191 1268.2618808746338 1271.429843902588 1181.7973327636719 1084.0765190124512 1163.7755584716797 1114.8129177093506 1221.7532348632812 1316.966314315796 1229.641981124878 1219.090576171875 1220.655174255371 1242.7385520935059 1315.485496520996 1239.9450492858887 1256.1528873443604 1246.914405822754 1241.864891052246 1316.1865425109863 1215.1092720031738 1243.3860492706299 1314.9551582336426 1198.1537532806396 1228.8612079620361 1315.3977584838867 1173.688144683838 1281.692190170288 1098.770923614502 1309.5757675170898 1240.2735900878906 1165.183277130127 1310.7808303833008 1268.9505290985107 1312.8453922271729 1211.6985511779785 1241.9281196594238 1305.9432697296143 1312.793846130371 1237.5888538360596 1221.52587890625 1224.0954113006592 1314.2618370056152 1258.1536483764648 1217.812795639038 1096.7234325408936 1277.8124523162842 1291.8011379241943 1200.4534435272217 1158.4222984313965 1311.9718742370605 1223.1763076782227 1164.6731567382812 1239.897985458374 1317.0864295959473 1241.9388008117676 1237.463779449463 1231.6020202636719 1251.9738388061523 1239.2303657531738 1270.4081726074219 1275.2600383758545 1203.5057258605957 1237.738437652588 1243.3491897583008 1213.3200359344482 1192.0122814178467 1265.266580581665 1189.9896812438965 1226.1721324920654 1316.0161209106445 1314.0009117126465 908.0335569381713 1204.1206550598145 1187.963981628418 1143.5952377319336 1240.3071117401123 1313.2062149047852 1231.3335609436035 1239.8010444641113 1243.0899810791016 1240.0889587402344 1240.5387115478516 1186.2763595581055 1236.3193702697754 1255.6884479522705 1315.4440593719482 1256.2406253814697 1162.6464557647705 1253.5424900054932 1155.063362121582 1110.2938842773438 1305.5112552642822 1316.116018295288 1316.508264541626 1287.1488285064697 1226.8578720092773 1316.8233108520508 1115.699119567871 1206.9153022766113 1229.196949005127 1310.0530815124512 1195.9377002716064 )
set r_array = ( 6.643908594846725e-06 6.622860630154609e-06 6.6289367276430125e-06 6.633226697444915e-06 6.6257225471735e-06 6.634418939352035e-06 6.644127194881438e-06 6.622499649524688e-06 6.613011558651924e-06 5.803238798975944e-06 6.633191381692886e-06 6.598321099877357e-06 6.663243298530578e-06 4.931326856017112e-06 4.324424539804458e-06 4.516983007192611e-06 6.643106614351272e-06 5.7348174351453775e-06 6.625255395770072e-06 6.629960213899612e-06 6.654774223566055e-06 2.892673877645284e-06 6.641010468006133e-06 5.4996359843015665e-06 6.655989264249801e-06 6.613701333403587e-06 5.820287813544273e-06 6.646236752271651e-06 4.711702440977096e-06 6.630723302364349e-06 6.630700503587722e-06 5.300502975583076e-06 6.636082355976104e-06 6.657025490999222e-06 3.605414268672466e-06 6.656765316724777e-06 6.643881325721741e-06 5.440411915183067e-06 4.800135766267776e-06 5.632982452511787e-06 6.6399925696849816e-06 5.0541282194852825e-06 6.624549974799156e-06 6.652171586751937e-06 4.217490454316139e-06 4.1200815635919565e-06 6.643698041439056e-06 6.627261241078376e-06 6.623298277258873e-06 5.121604551672935e-06 4.138336454629898e-06 6.620905746817588e-06 6.6472930955886836e-06 6.658549432754516e-06 6.646761571168899e-06 6.609562684893608e-06 6.645318542718887e-06 6.64482143998146e-06 5.483981047868728e-06 3.758031067550182e-06 6.645895664691925e-06 6.6444763290882105e-06 6.643921111822128e-06 6.635452930927276e-06 6.6225693869590755e-06 6.642410581111908e-06 6.656329010725021e-06 6.631251250505447e-06 6.618896772265434e-06 6.639219646453857e-06 5.074741889834403e-06 6.62254547059536e-06 6.646863942146301e-06 6.643905018568038e-06 6.633713518381118e-06 4.941954438686371e-06 6.630863224267959e-06 6.657929842472076e-06 6.64697614789009e-06 6.643213902711868e-06 5.171264757514e-06 6.624540140032768e-06 6.626178969740867e-06 5.28770123898983e-06 6.649223392009735e-06 6.6272420185804365e-06 5.598330100178719e-06 6.6506901133060454e-06 6.61685784637928e-06 6.6640202450752255e-06 6.152561654448509e-06 6.6440328705310815e-06 6.631088976860046e-06 5.9072068083286285e-06 6.657588307857513e-06 5.570192833542824e-06 6.624636923074722e-06 6.642976974248886e-06 6.09262814104557e-06 5.963317503333091e-06 6.640519623756408e-06 6.639882152080535e-06 6.642237578630447e-06 4.989700217843055e-06 3.1677742890268562e-06 6.645608221292495e-06 6.663320635557175e-06 3.493045636564493e-06 3.730992780178785e-06 6.649083470106125e-06 6.651089762449264e-06 5.738495190739632e-06 6.635855709314346e-06 6.629756589531898e-06 6.640471791028976e-06 4.631486398279667e-06 6.643358294963837e-06 6.642500882148742e-06 6.6558922576904295e-06 6.654529248476028e-06 6.621003647446632e-06 6.653830533027648e-06 2.528918816819787e-06 6.6289561736583705e-06 6.641390894651412e-06 6.625312169194221e-06 6.645006065368652e-06 6.635662143230438e-06 3.2903948548436165e-06 6.626258541941642e-06 6.623163719773292e-06 5.27262007176876e-06 4.430715565681457e-06 6.606425841450691e-06 6.624537010788917e-06 6.624981363415717e-06 6.626736422181129e-06 6.629870136380195e-06 4.320509632229805e-06 6.623142932653427e-06 6.631683533191681e-06 6.622510825395583e-06 6.6300022351741786e-06 6.628010471463203e-06 6.645860795974731e-06 6.643262629508971e-06 2.640033767670393e-06 5.0110242265462875e-06 3.132111190930009e-06 6.624564279913902e-06 6.6603934514522545e-06 6.623844553828239e-06 6.663587962388992e-06 6.302696068882942e-06 4.577603277862072e-06 5.00554357945919e-06 3.648111851066351e-06 6.623297606706619e-06 4.579688918888568e-06 6.615569491982459e-06 6.627504651546478e-06 6.6619106876850125e-06 5.965745349526405e-06 6.626293634176254e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
