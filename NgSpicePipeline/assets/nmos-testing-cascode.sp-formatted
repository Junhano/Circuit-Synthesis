nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 700.2154924720526 1365.7469582557678 1041.4961856603622 1220.1964390277863 819.9582156538963 714.4250926375389 894.9945998191833 1062.2441005706787 960.7706797122955 695.0975303351879 1298.56987118721 942.2988426685333 1161.5757328271866 1396.5478372573853 1363.3754831552505 792.6273328065872 1220.9002953767776 721.8889036029577 1085.873870253563 782.8454059362411 1297.058357000351 763.4252180159092 756.1186347901821 716.103099361062 1073.3751338720322 1178.9554190635681 1010.6869471073151 864.8655694723129 663.7588907778263 1054.3292146921158 945.4081934690475 1265.9572046995163 1027.6158434152603 1253.0713361501694 1334.9433970451355 1248.0754089355469 1387.5910025835037 1159.8763298988342 1029.8559349775314 1384.7745490074158 1174.418820142746 705.9140131622553 807.7225816249847 1037.5753772258759 705.3727098554373 1395.7581949234009 747.318849042058 702.9241491854191 939.4251239299774 724.7599010169506 1328.28338265419 1000.88119328022 1330.3393852710724 1268.8456755876541 656.4963628351688 1197.8682112693787 1200.8521687984467 1353.3717823028564 1385.4118418693542 862.4276426434517 1225.0993382930756 692.5349813699722 973.6535084247589 892.9068130254745 1379.833025932312 787.75092035532 735.0625955313444 1272.6320159435272 891.2835401296616 657.4964021146297 1413.8817918300629 1408.6967241764069 881.9726985692978 1152.6932847499847 1149.472666978836 1293.366117477417 1301.8958103656769 783.9824390411377 671.6158800572157 1224.8971891403198 1255.9716087579727 712.8055692464113 1066.7190980911255 1383.679313659668 1101.0872703790665 1389.699889421463 1398.4531891345978 859.9934709072113 757.4713342636824 928.1854164600372 1339.4202274084091 772.6660986244678 1077.6394438743591 1026.7918241024017 1188.5819566249847 1404.1303080320358 1117.9668587446213 795.1592040061951 1093.0623692274094 786.1998212337494 1057.6516669988632 1076.8679958581924 1027.8069508075714 1346.2890964746475 920.0175312161446 850.7616762816906 1195.733932852745 1295.1184046268463 964.6303337812424 1376.4162492752075 982.80118227005 1417.1802830696106 764.7714187204838 1176.8080872297287 697.8516113758087 1121.0571211576462 1157.8387451171875 1052.1505457162857 756.8445802479982 1280.9769940376282 743.340367525816 915.6482797861099 1388.1543558835983 1236.3203597068787 1169.7495412826538 865.6508308649063 780.7745170593262 1317.4933922290802 777.8034900128841 1196.0111391544342 1009.9626612663269 797.0849518477917 1073.9238691329956 970.3343194723129 1339.5199608802795 1121.6549408435822 712.9409118369222 798.1286105513573 1420.020831823349 672.9126442968845 798.8520805537701 750.4074909538031 1367.3079591989517 870.4083096981049 1331.577895283699 1176.6662430763245 1197.3659229278564 1187.9203003644943 712.4214908853173 976.4538687467575 746.6054764389992 1237.776307463646 1202.2730243206024 718.6774165183306 1304.6957236528397 1047.6855170726776 664.8307182639837 851.2759228050709 701.818425282836 1212.6278710365295 699.252216219902 750.8943286538124 822.0719863474369 911.1933988332748 )
set w1_array = ( 1035.519142150879 962.4015522003173 908.0845069885253 891.8968868255614 994.2362499237059 1008.7120246887206 954.3472957611083 931.9812488555907 975.2919387817382 1015.4803466796874 904.3334674835204 967.9166984558104 897.3982048034667 1083.6849403381348 979.824514389038 1035.0336742401123 868.9550352096556 1048.5020351409912 866.7894077301024 1037.8216457366943 940.485496520996 1003.7737083435057 1042.8713989257812 1047.475929260254 975.9844017028807 843.5167026519774 946.9060611724852 1012.9677009582518 629.1989755630493 935.6415462493895 967.9989051818847 789.4476962089539 949.2680263519286 859.6626234054564 827.9570293426513 877.2256565093993 1001.6858768463134 839.3345546722411 924.8948764801024 977.7273368835448 947.3122310638427 1023.9470672607421 1030.8575344085693 925.9422969818114 1025.2999019622803 1092.63503074646 1006.8964195251464 1021.1854171752929 970.1007556915282 1033.7192249298096 900.678367614746 900.5445194244384 818.9370346069335 824.5866012573241 793.4808921813965 785.2199029922485 814.5910692214965 996.0441303253173 1000.7222366333007 979.5416069030761 828.7844133377074 1030.623836517334 922.4227619171141 1008.0289077758788 1003.9517593383788 1036.4249897003174 1033.4685516357422 921.2077569961547 978.543825149536 845.3544092178344 1240.2081203460693 1152.2157859802246 983.5975837707518 838.8477993011473 878.3829879760741 954.7563266754149 882.2624397277831 1004.6253871917723 954.5335960388182 889.670534133911 956.4070892333983 1036.504192352295 892.4730968475341 971.9653320312499 863.7448978424071 1064.4395542144775 1088.0259227752686 964.2452430725097 1011.6582107543944 924.0645599365233 837.6116943359374 1040.6361770629883 904.9547147750853 902.6353073120116 894.1995096206664 1176.8487644195557 835.6477451324462 1012.856454849243 915.2003955841063 1039.6115970611572 965.4406738281249 903.4127902984618 862.9284572601317 954.4479084014891 960.0578498840331 1022.2613048553466 883.4887695312499 890.3766345977782 929.9574327468871 992.7357864379882 998.1187534332274 1277.3917865753174 1015.2811241149901 816.3057994842528 1039.217586517334 889.0717697143554 846.980972290039 962.0443534851073 1030.3278160095215 867.5606441497802 1040.664882659912 926.3690662384032 1055.9813690185547 829.0755701065062 862.6523208618163 1004.6733570098876 1040.420217514038 945.3470420837401 1003.2181930541991 957.2742176055907 974.4660568237304 1002.5931549072264 868.3919620513915 890.2820301055907 959.8222923278807 863.068504333496 1004.8611831665038 1016.563148498535 1321.5771389007568 972.7265548706054 1011.5786266326903 1047.7728080749512 993.9037036895751 976.1393260955809 934.2205238342284 857.1276855468749 861.0990238189696 789.4399833679199 1027.0738315582275 953.701467514038 1015.7600116729735 897.1016597747802 846.9180297851561 1000.1848411560057 919.9944686889647 871.4824390411376 973.0459880828856 1015.0957298278807 1041.8902111053467 869.9477386474608 983.8912200927733 1046.7618656158447 1027.7916622161865 992.8317260742186 )
set r_array = ( 5.138880883455276e-06 5.083694432973861e-06 5.091014628410339e-06 5.0780474889278405e-06 2.8900297853350636e-06 3.639177133440971e-06 4.3785177665948864e-06 5.831781526207924e-06 6.558040355443954e-06 6.584281523823738e-06 4.389514935314655e-06 2.864873458743095e-06 4.351435949206352e-06 5.061091457605361e-06 4.383041200339794e-06 5.860280444025993e-06 5.820521612763404e-06 5.86875443637371e-06 5.859318425059318e-06 5.864527274966239e-06 2.9127352993190285e-06 2.8981510671973228e-06 6.575547804236411e-06 5.869940196275711e-06 2.8501602570712566e-06 5.846789379715919e-06 6.563042451739311e-06 6.560195286870002e-06 3.6755376058816907e-06 2.875928294956684e-06 5.839892079234123e-06 6.5443653362989425e-06 2.8671313758194447e-06 5.1037819433212275e-06 6.504923229217529e-06 5.08805324614048e-06 6.472402338981628e-06 5.854509224295615e-06 6.570401315689086e-06 6.468289618492126e-06 2.870834780037403e-06 4.405304540991783e-06 5.85330692410469e-06 5.8394817012548444e-06 4.398165618181229e-06 4.359102820158005e-06 2.894202129095793e-06 6.582545017004013e-06 5.8406194049119946e-06 6.581041415333747e-06 5.099312041997909e-06 5.102679108381271e-06 6.509725724458694e-06 5.8294515806436535e-06 3.6673336784541604e-06 6.576204498410225e-06 6.56287481367588e-06 2.8980267076939343e-06 5.781631817221641e-06 5.108982970118522e-06 5.839843799471855e-06 5.143013496994972e-06 4.367191803753376e-06 2.8540468338131902e-06 5.090808768868446e-06 5.862436046004295e-06 5.1367992657423014e-06 3.6030930402874944e-06 2.8729862469434737e-06 2.9106907296180724e-06 5.067289148569107e-06 2.884389714449644e-06 3.6077655601501463e-06 5.856777479052543e-06 5.0920338678359985e-06 2.891392459273338e-06 5.097676118016243e-06 4.3981777998805044e-06 3.654882026016712e-06 3.6270399141311642e-06 2.8740429255366323e-06 5.141356115341186e-06 5.850381304621696e-06 6.478826006054878e-06 5.8572826284170145e-06 4.388057713508606e-06 5.750984226465225e-06 4.3891127157211305e-06 3.6326819966733453e-06 3.624618996977806e-06 6.500055466890335e-06 5.8685550588369366e-06 6.567690496444702e-06 5.096226607561111e-06 3.6127377051115034e-06 6.438695241808891e-06 5.119781320095062e-06 5.120404710173607e-06 3.5943174111843108e-06 6.57605116546154e-06 2.8569348464906215e-06 3.603228435963392e-06 4.385437307059764e-06 4.3690157058835025e-06 2.875007738471031e-06 5.8338604617118835e-06 4.3641986820101735e-06 5.0842992711067196e-06 3.6079373332858084e-06 5.0773791718482965e-06 2.8420383605360985e-06 4.36334227502346e-06 4.3962915363907816e-06 6.572103400826454e-06 5.876210977435112e-06 3.6125377129018306e-06 5.110093404650688e-06 2.8590805019438265e-06 5.121375222802162e-06 5.800628562569618e-06 6.58344378054142e-06 3.6287010955810544e-06 4.366384123563766e-06 6.541426529288292e-06 6.556429241895676e-06 5.846529205441474e-06 5.85750860452652e-06 2.9246879770606756e-06 3.636365843117237e-06 2.8635124611854553e-06 2.852944278270006e-06 3.6288510757684704e-06 3.6279111850261685e-06 4.385345553159714e-06 2.933443433716893e-06 6.57300864636898e-06 3.6473387601971624e-06 2.8748155134916305e-06 5.060464714765548e-06 6.594092820882797e-06 4.380511430203915e-06 5.861532588601112e-06 3.642140806764364e-06 2.882594422549009e-06 3.656756331324577e-06 5.102635746002197e-06 4.386694816052913e-06 6.578639720678329e-06 4.396137309372425e-06 2.867478330731392e-06 3.6276246915757652e-06 3.6217003624141214e-06 5.109359149932861e-06 2.892286975979805e-06 4.3649453419446945e-06 5.108381037712097e-06 5.166709919571876e-06 5.843415160775184e-06 5.874194403290748e-06 4.3817390996217725e-06 2.903574773222208e-06 5.869272996783256e-06 6.569870685338974e-06 5.835031469464302e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
