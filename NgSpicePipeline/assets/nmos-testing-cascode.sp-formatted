nmos: cs amp

.include NgSpicePipeline/assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1051.8787932395935 1043.4752088785172 786.1849573254585 1115.3487992286682 1138.6505794525146 1396.2359857559204 946.9717201590538 1352.1028292179108 1321.727706193924 732.8731921315193 777.1181297302246 774.8412695527077 1433.4696066379547 698.1545333564281 1219.224853515625 1036.350769996643 1102.3181807994843 1126.1412930488586 1221.2914955615997 1259.1005396842957 836.3016192615032 1326.382143497467 910.5717521905899 851.1534240841866 1289.5690035820007 1386.418743133545 769.1955325007439 1010.297132730484 1127.1077823638916 899.4946312904358 1088.4584021568298 906.4790812134743 942.8673592209816 1047.4169385433197 688.3711424469948 683.6610716581345 1316.1924314498901 1285.2040660381317 906.933559179306 1253.6373269557953 1056.8021219968796 802.2596035897732 786.1742955446243 1321.996374130249 982.4351054430008 1178.3856284618378 958.4400635957718 1042.4691793322563 1449.5322835445404 743.2918977737427 939.0841034054756 808.6552527546883 743.0224587023258 678.2287937402725 757.2289463877678 1064.177883863449 1084.2011106014252 1398.7215888500214 954.8667800426483 697.2123739123344 874.9377784132957 1138.916654586792 1028.4293350577354 1204.8727107048035 1395.7282435894012 904.5989868044853 1365.1990723609924 1027.808917760849 783.5154999792576 1225.1646947860718 909.2933219671249 1183.4968012571335 1050.02547621727 996.2307792901993 675.4846927523613 1279.989583492279 1212.093887925148 798.4261792898178 907.6631200313568 1030.4408130049706 1309.9860680103302 963.422132730484 1110.1989579200745 1383.6006355285645 1002.305982708931 794.632965773344 1385.2091562747955 901.356754899025 1112.5180852413177 812.1496346592903 1322.0843505859375 1012.6870703697205 1176.4322650432587 1314.766390323639 699.945008456707 883.6987447738647 963.4034466743469 942.0340639352798 1007.6253396272659 1018.162978887558 830.6990098953247 1235.7024681568146 935.8888772130013 894.4311347603798 1214.645607471466 759.5779468119144 765.8799868822098 864.2836195230484 1372.5316059589386 881.2518101930618 990.1191872358322 944.0845903754234 1403.7741553783417 1073.6426842212677 1125.616295337677 1136.8533205986023 881.0184133052826 1350.7774603366852 1037.603562772274 1320.1106917858124 738.2165212929249 925.2298903465271 1160.7101392745972 695.5898497998714 994.1625726222992 998.7132531404495 1062.6077634096146 1315.1119482517242 949.65547144413 1045.2969205379486 673.248043358326 1151.4216494560242 1127.3352336883545 1299.2734146118164 1263.8880145549774 1419.4460344314575 1037.5685822963715 827.1200825273991 1141.1323380470276 671.6973689198494 1164.3262934684753 1439.4899141788483 1002.0699483156204 1157.0510697364807 793.3830451965332 1146.786881685257 943.8479524850845 872.1771818399429 692.2508013248444 904.6453219652176 1138.6358720064163 1084.74649310112 1266.1709320545197 1315.157814025879 727.0916905999184 1262.194825410843 780.1572625339031 768.2424765825272 989.5839524269104 1338.9784228801727 725.2288740873337 953.8041335344315 748.4476958215237 1231.9186758995056 )
set w1_array = ( 1005.7981204986571 999.1056394577025 1058.2184028625488 989.57950592041 988.3499813079833 1130.0485801696777 1025.0757884979248 1069.0647792816162 1031.6509914398193 1059.5292282104492 1065.747995376587 1064.8203563690186 1238.8724994659424 1014.8253870010375 982.079882621765 1009.0043735504149 990.7177639007567 973.6829948425292 993.8877534866332 1010.6110048294066 1054.604024887085 1050.4609775543213 1032.4691486358643 1025.9054374694824 1027.413625717163 1123.13138961792 1065.0419902801514 1014.4243192672728 981.6531372070311 1028.130693435669 997.6148557662963 995.3744363784789 1005.0936889648436 974.2261362075805 985.2993202209472 980.2092027664183 1042.1384525299072 990.6254243850707 1037.000675201416 1008.0713939666747 985.6272172927855 1061.425371170044 1022.5660514831542 1031.6062641143799 997.2186517715453 982.9487752914428 1015.3165769577025 974.5818328857421 1215.9344387054443 1058.7864589691162 1029.5417022705078 1049.0895462036133 1058.7287139892578 945.2898693084716 1045.1593112945557 995.8739471435546 983.1841897964476 1159.829969406128 1026.0323238372803 1010.4449462890624 1020.2446651458739 988.2048082351683 1008.8033628463744 989.4730520248412 1140.8892345428467 1027.1519374847412 1087.0628547668457 975.8367013931273 1041.4608192443848 982.9141330718993 1033.1101608276367 982.5283479690551 1006.1534357070922 979.4632625579833 874.3909072875975 1021.5938758850097 993.2093811035155 1063.537425994873 1032.9032135009766 975.3975820541381 1029.7803115844727 1019.515128135681 982.0449781417846 1127.6592445373535 978.9191675186156 1051.8461894989014 1115.5957412719727 1038.3342456817627 987.3641443252562 1054.007215499878 1025.6496143341064 1011.9808626174926 981.0046386718749 1045.0099658966064 1005.3287935256957 1031.8412971496582 1000.7688951492308 1018.7363576889037 1005.6731891632079 1010.7952785491942 1056.1950397491455 999.8484086990355 1020.0419139862059 1015.7555532455443 969.6182680130004 1060.0958061218262 1026.3822269439697 1045.7591724395752 1105.6300830841064 1000.6407690048217 980.2955102920531 1028.4396839141846 1141.3095664978027 983.987374305725 981.7743730545043 982.0872020721434 1039.1757678985596 1077.0905685424805 974.7594785690306 1037.9125785827637 1061.400671005249 991.470808982849 984.7462368011473 1008.9158010482787 1017.7994680404662 1012.2303438186644 985.0147438049315 1033.7799739837646 1027.1571826934814 998.595209121704 882.9958152770995 982.8047466278075 988.8078880310057 1022.1672725677489 1013.0067777633666 1162.0582294464111 974.9686908721923 1013.3818101882933 975.2947998046874 809.5586252212523 978.5245370864867 1193.1029987335205 1006.4917993545531 977.5031995773314 1057.2564792633057 989.8332786560057 988.067955970764 1002.8475713729857 999.6963214874266 1026.9805145263672 990.5991268157958 998.8679838180541 979.8049402236937 1041.5015888214111 1054.0938568115234 1012.1201944351195 1058.9248371124268 1059.916467666626 995.7063627243041 1048.6198616027832 1055.9588623046875 1021.3070106506347 1063.75319480896 998.6772489547728 )
set r_array = ( 3.6179767298698424e-06 5.125006039738655e-06 4.39879359036684e-06 5.137128283381462e-06 5.128659208416938e-06 6.570817281603813e-06 4.392625962495804e-06 2.8427654207870364e-06 3.6220160248875617e-06 3.622707699537277e-06 2.879336041510105e-06 3.627195705771446e-06 2.8626542381197213e-06 5.861735095381737e-06 3.592264627218246e-06 3.642137621641159e-06 5.140670587420464e-06 6.641065006256103e-06 6.634373788833617e-06 5.908191849589348e-06 2.8850726439803836e-06 5.097520326375961e-06 2.8799650474637746e-06 5.893608679175377e-06 5.898732592463493e-06 3.6025218415260313e-06 3.6271021637320515e-06 3.635099169909954e-06 5.901278008818626e-06 5.140038703680038e-06 4.39175357401371e-06 6.6334779310226435e-06 5.878385354876518e-06 6.618864585757255e-06 5.872924600839614e-06 4.390357372462749e-06 5.105263640284538e-06 2.853850669339299e-06 3.6196647334098815e-06 5.87910306930542e-06 5.888692637085914e-06 3.6348821344971655e-06 6.649018203020095e-06 3.5815537843108177e-06 5.879077811837196e-06 3.633395743668079e-06 5.135540862679481e-06 6.620350976586342e-06 5.8008920896053315e-06 4.381494012773036e-06 3.6240752908587454e-06 5.130441759824752e-06 4.388538499474525e-06 3.6120353016257286e-06 5.879564185738563e-06 5.1170139509439465e-06 5.882312108874321e-06 2.848370497226715e-06 3.635286030471325e-06 2.866306680366397e-06 5.888581772446632e-06 3.6180412146449086e-06 4.381285471022129e-06 4.37929940700531e-06 3.598187503516674e-06 5.127830629348754e-06 3.585760158598423e-06 6.624569197297096e-06 5.889044453501701e-06 3.613068063855171e-06 4.3797642114758486e-06 6.6434441256523124e-06 3.6383497837185857e-06 6.632313405275344e-06 2.863260445296764e-06 5.8871610957384104e-06 5.8763169246912e-06 2.884409523680806e-06 2.867163171172142e-06 6.634350990056991e-06 4.3469411256909365e-06 2.882753594890237e-06 5.873752732872963e-06 2.8529791190475226e-06 6.618895878195762e-06 5.130684052705765e-06 4.354192924797535e-06 3.621431638598442e-06 2.8884192026406527e-06 4.397464108765125e-06 2.8334169305115936e-06 4.369053927361965e-06 6.632171248197555e-06 5.865017672181129e-06 6.6385218250751495e-06 5.134304364323616e-06 5.8843277889490125e-06 5.139253486990929e-06 5.1200361299514765e-06 4.3850848200917245e-06 2.8861118882149457e-06 5.144636904001236e-06 5.140468080639839e-06 5.882949133515358e-06 2.8852599515765904e-06 4.382976827323436e-06 6.640782033205032e-06 2.8677428077161313e-06 2.8561283677071333e-06 6.6435442614555355e-06 6.633622323274612e-06 3.6223938810825344e-06 5.85755979001522e-06 5.8851275342702864e-06 5.888446544408798e-06 5.8850488561391825e-06 4.399687213003635e-06 5.86227421939373e-06 6.633367960453033e-06 4.340256054997444e-06 3.6237073811888694e-06 6.635763173103332e-06 3.6046795669198034e-06 5.869770993590354e-06 3.622232948541641e-06 2.890210610926151e-06 5.887591813802719e-06 4.343611610233783e-06 3.636539516150951e-06 5.140168120265007e-06 3.6166038858890532e-06 5.897624840140343e-06 5.133118380904198e-06 4.353506726324558e-06 6.633888756036758e-06 6.56273489177227e-06 6.621794899106025e-06 6.643607293367386e-06 6.625247349143028e-06 4.395066437423229e-06 6.645847831964492e-06 6.532860447764396e-06 5.137084921002388e-06 6.6198905307054515e-06 4.390861404240131e-06 4.386403349339962e-06 6.628405650258064e-06 6.638121281862259e-06 5.864055206179618e-06 5.138806005120277e-06 4.389081870317459e-06 3.62427030980587e-06 2.8633546578884123e-06 5.129280139803886e-06 4.386549529731273e-06 6.615321387648582e-06 4.398525145947933e-06 4.383512598574161e-06 5.8888781565427775e-06 2.864551900997758e-06 3.6069026711583136e-06 2.869025741815567e-06 3.6253412935137746e-06 5.130005677342415e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata NgSpicePipeline/out/r-test.csv $r_array[$&index]
    wrdata NgSpicePipeline/out/w0-test.csv $w0_array[$&index]
    wrdata NgSpicePipeline/out/w1-test.csv $w1_array[$&index]
    wrdata NgSpicePipeline/out/bw-test.csv bw
    wrdata NgSpicePipeline/out/pw-test.csv pw
    wrdata NgSpicePipeline/out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
