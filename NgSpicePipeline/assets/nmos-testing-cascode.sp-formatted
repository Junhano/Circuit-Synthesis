nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 794.0785866975784 1006.8956670165062 1005.2369889616966 904.5573902130127 831.375418305397 1300.5168867111206 923.3142566680908 1078.1578254699707 1426.3645243644714 960.8774092793465 1086.6968166828156 1126.889048218727 1219.4554340839386 1417.826024889946 1423.275603055954 841.7258393764496 1116.194902062416 955.5300903320312 1426.7307353019714 960.8235862851143 1424.0747225284576 1255.8726799488068 739.6846060454845 1425.6845843791962 1159.3555343151093 1086.134536266327 1110.8324509859085 864.4379359483719 1426.3125789165497 1043.0784878134727 1425.6124329566956 764.9295237660408 870.1065835356712 1279.6316426992416 1320.4987180233002 841.0876077413559 931.1645013093948 1408.6150509119034 1363.3361440896988 1422.1491646766663 1367.29383289814 806.130690574646 680.3973038494587 1417.0809072256088 1407.3317927122116 1425.5904388427734 1413.416741490364 1348.1882792711258 1413.6357885599136 1425.6561529636383 1175.3665786981583 1309.0530169010162 928.445993065834 1421.8571615219116 948.9264023303986 991.3691636919975 874.7427371144295 1008.5093957185745 880.9431996941566 1425.5714845657349 857.3170733451843 1192.991105914116 1292.6361095905304 788.0339492857456 917.9804828763008 950.2364826202393 788.5595169663429 1423.9626955986023 1422.5421977043152 734.2428789287806 1042.3184168338776 869.3803977966309 1274.0792018175125 1028.5743308067322 1264.779133796692 894.2246717214584 1425.8128833770752 1056.6099417209625 1151.1191409826279 759.219693094492 1425.3729116916656 1367.6542323827744 1070.7571190595627 1157.5187128782272 875.347552895546 1121.4978975057602 1275.2080541849136 864.5305839180946 831.7984026670456 1415.4562485218048 1003.3256244659424 804.2785581946373 747.280392870307 914.8791563510895 1222.0047396421432 1305.6695890426636 989.3603456020355 1175.5679231882095 749.9916870892048 1397.8196960687637 1420.8326470851898 1071.7316102981567 1421.7260015010834 1281.6664558649063 1423.265142440796 1014.370111823082 949.9178808927536 1078.6531847715378 1417.3235577344894 1364.8409527540207 1422.6521682739258 1001.716388463974 1420.6875395774841 792.9581832885742 886.5386229753494 775.6397408246994 1410.878477692604 1424.8279762268066 741.2622087448835 1191.5364545583725 1305.630562901497 1422.5819838047028 1099.715096950531 1032.377479672432 924.3764114379883 1249.653486609459 1417.184932231903 988.6310082674026 1416.4445978403091 1425.794197320938 785.8881485462189 1041.5799823403358 1280.1747006177902 723.3064231276512 945.0017493963242 1375.9757858514786 1085.8646166324615 954.1315865516663 696.1548515409231 1379.7754031419754 1424.5489370822906 1416.0436969995499 1417.0209151506424 955.5542078614235 1438.8375115394592 1420.6997883319855 858.8030618429184 1230.6474429368973 1423.3843219280243 1424.6854615211487 1419.2350786924362 1286.0609871149063 1198.3094346523285 1334.6496504545212 1403.5749119520187 885.2283191680908 1107.4239891767502 1413.8273876905441 1419.124437570572 1426.0701072216034 1005.0948765873909 1237.7375048398972 1423.2456517219543 699.3018370866776 1247.8582841157913 )
set w1_array = ( 1200.5264472961426 1199.9995422363281 1243.0195045471191 1243.8911628723145 1244.1787910461426 1240.3011512756348 1243.5969066619873 1146.6252994537354 1315.7696437835693 1243.6032485961914 1252.7919483184814 1191.251392364502 1168.7672805786133 1317.499942779541 1327.3639392852783 1242.5042343139648 1223.0677318572998 1167.1245765686035 1313.6383247375488 1249.652976989746 1301.556797027588 1259.5573616027832 1184.6005630493164 1318.2143878936768 1242.8249073028564 1077.133674621582 1190.5674171447754 1246.3445854187012 1323.7354469299316 1242.4645614624023 1319.8692512512207 1155.7811450958252 1190.8064079284668 1190.7820892333984 1187.8746700286865 1236.1770820617676 1232.3312950134277 1309.5465850830078 1219.4019985198975 1271.164197921753 1286.0982608795166 1223.5219192504883 1022.3021697998046 1328.2988262176514 1308.5652542114258 1313.9915657043457 1296.5323638916016 1268.3185768127441 1324.4280052185059 1308.3108615875244 1254.919786453247 1242.6713180541992 1211.3411617279053 1286.5323734283447 1208.0645751953125 1227.6889514923096 1219.9965190887451 1153.5333824157715 1219.3098735809326 1320.6399154663086 1243.081398010254 1160.1058197021484 1196.772928237915 1221.8964767456055 1243.7881660461426 1168.4780311584473 1232.6377582550049 1327.1589469909668 1327.951021194458 1221.581859588623 1079.2896461486816 1138.9990043640137 1234.1934394836426 1148.2055854797363 1232.448501586914 1217.6983070373535 1325.068588256836 1224.4915199279785 1242.6025581359863 1153.8217735290527 1325.8502197265625 1264.0058708190918 1224.16898727417 1097.0833015441895 1189.6160316467285 1148.1120300292969 1235.3144836425781 1221.4858722686768 1199.1483402252197 1329.3051433563232 1081.444091796875 1200.201530456543 1222.021598815918 1214.1378593444824 1202.1491241455078 1203.1172943115234 1088.302583694458 1108.5098934173584 1190.2015399932861 1271.9862174987793 1305.8679294586182 1193.756217956543 1272.518081665039 1163.092966079712 1327.7568054199219 1076.548547744751 1208.9370441436768 1242.0468997955322 1319.3531703948975 1234.59321975708 1288.6758041381836 1250.6323528289795 1292.0820426940918 1199.8957824707031 1218.0345726013184 1198.787612915039 1293.0454444885254 1302.5812339782715 1219.4416236877441 1158.2136344909668 1201.7687034606934 1328.1902027130127 1242.7398872375488 1079.0482234954834 1232.7760887145996 1180.034465789795 1316.9570636749268 1250.4133415222168 1323.3439636230469 1306.0871315002441 1158.3594989776611 1195.1572608947754 1163.7797546386719 1128.3349227905273 1168.241901397705 1289.7942733764648 1223.9846420288086 1249.4654846191406 1132.7253532409668 1232.3645782470703 1304.7142219543457 1327.348346710205 1317.7185249328613 1098.1055450439453 1273.7955284118652 1303.421230316162 1235.9451484680176 1228.2464218139648 1269.2005348205566 1326.196117401123 1312.7653789520264 1167.5773811340332 1226.027603149414 1274.6019554138184 1296.5087127685547 1243.5952377319336 1222.0353317260742 1328.1207275390625 1307.9390716552734 1307.9925727844238 1198.806734085083 1175.4248809814453 1327.7372074127197 1139.4231986999512 1145.953483581543 )
set r_array = ( 6.606559281349182e-06 6.6215103614330285e-06 6.6298846650123595e-06 6.617995997071266e-06 6.612297867536545e-06 6.654210959672927e-06 6.619724680781364e-06 6.6269232827425e-06 4.2789722728729244e-06 6.624014874100685e-06 6.639086430072784e-06 6.637071644067764e-06 6.636163269281387e-06 5.763748412132263e-06 4.895588656067848e-06 6.613271509408951e-06 6.640181665420532e-06 6.616295029520988e-06 4.214828808903694e-06 6.6256554919481275e-06 3.937769805192947e-06 6.647184913158417e-06 6.597817962169647e-06 4.357349884808063e-06 6.643390034437179e-06 6.625911419391632e-06 6.634918277263641e-06 6.614972700476646e-06 4.562981662452221e-06 6.635136877298355e-06 4.411332358717918e-06 6.5963452059030526e-06 6.612769936323166e-06 6.631894086599349e-06 6.640813772678375e-06 6.613255416154861e-06 6.618368153572082e-06 6.423045669794082e-06 6.673284147977829e-06 3.271392214223742e-06 6.674697672128677e-06 6.610421662330627e-06 6.589325417876243e-06 5.265463267564773e-06 6.44602169573307e-06 4.234374401271343e-06 6.490227853059769e-06 6.686772530078888e-06 5.831482012867927e-06 4.084555481672287e-06 6.637021129131316e-06 6.659122084379196e-06 6.616359849572181e-06 3.627898109257221e-06 6.617290576100349e-06 6.623726983666419e-06 6.614425082802772e-06 6.6194092977046965e-06 6.614666928648948e-06 4.4380217912793155e-06 6.614312430024146e-06 6.638022040128708e-06 6.634766285419463e-06 6.608617206215858e-06 6.619234060049056e-06 6.616059889197349e-06 6.609507252573967e-06 4.843762566447258e-06 4.802119483351707e-06 6.602911030054092e-06 6.6214752691984175e-06 6.609234561324119e-06 6.64335248351097e-06 6.621072937846183e-06 6.6412791359424585e-06 6.615164031386375e-06 4.633658428788185e-06 6.632382695674896e-06 6.643575106859207e-06 6.5954417484998695e-06 4.68230587720871e-06 6.684304897785186e-06 6.634439502954482e-06 6.633972351551056e-06 6.61303547501564e-06 6.632904832363128e-06 6.643896524906158e-06 6.614028786420822e-06 6.610410039424896e-06 5.300362159609794e-06 6.618381117582321e-06 6.607686703205108e-06 6.604381998181343e-06 6.615880628228187e-06 6.63825360417366e-06 6.64014232635498e-06 6.617506493926048e-06 6.635168616771698e-06 6.5997542935609815e-06 6.642304633855819e-06 6.0770051676034926e-06 6.629495521187782e-06 3.3119671075791118e-06 6.626330961585044e-06 4.817600523233413e-06 6.619122971892356e-06 6.617434521317481e-06 6.639590685367583e-06 5.6720622378587716e-06 6.678006176948547e-06 3.6657309468090534e-06 6.63114306807518e-06 6.372868691682815e-06 6.606337552070618e-06 6.614840378165245e-06 6.604102601408958e-06 6.532056455612182e-06 3.95399795204401e-06 6.603390027880668e-06 6.638030980825423e-06 6.639726583957672e-06 4.870739777684212e-06 6.6416170942783355e-06 6.620604668855667e-06 6.617897425889968e-06 6.63237688422203e-06 6.078975473642349e-06 6.6293551522493355e-06 5.571215649247169e-06 4.027646829485893e-06 6.599415217638015e-06 6.625276629924773e-06 6.626415898203849e-06 6.590345104336738e-06 6.6157854098081585e-06 6.659916018247604e-06 6.636575435400009e-06 6.6247797507047646e-06 6.5892261761426925e-06 6.675926123857498e-06 4.007286180853843e-06 5.387138773798942e-06 6.050201405882835e-06 6.615348880290985e-06 2.920338059188798e-06 6.2523543584346764e-06 6.6142062592506405e-06 6.6396595287323e-06 3.1973831943422554e-06 4.6926419931650155e-06 6.098281790614128e-06 6.627014924883842e-06 6.641752992868423e-06 6.6862195479869834e-06 6.565072436928748e-06 6.61634397983551e-06 6.639074360132217e-06 5.494204064011573e-06 6.257089574933052e-06 4.07210846722126e-06 6.621175308823585e-06 6.633853440284728e-06 4.86533333837986e-06 6.5898591774702065e-06 6.6291432577371595e-06 )
set i = 165
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
