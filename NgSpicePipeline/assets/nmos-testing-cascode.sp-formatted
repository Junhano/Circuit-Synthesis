nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1170.3231763839722 959.5305156707764 1349.9788773059845 1306.0746920108795 701.5755931660533 1390.4882353544235 760.300377458334 1310.040472149849 1193.6372500658035 1246.8061876296997 1114.057136774063 1389.6907699108124 1418.1009513139725 1079.4528406858444 929.0087205171585 1153.8871359825134 1222.3065328598022 1240.0777769088745 1275.7925522327423 1324.370665550232 1407.026333808899 811.2885338068008 947.7465879917145 1254.0578973293304 906.5455105900764 687.66596455127 1371.1444568634033 1408.2475435733795 766.3391028344631 998.2356858253479 728.1382382661104 1362.5239264965057 1288.9922839403152 670.912755727768 833.5145582258701 1355.0424855947495 1312.3102021217346 729.0802524238825 1378.9896500110626 1398.0244827270508 1076.9568663835526 1160.7957017421722 1416.8022257089615 1376.6032886505127 1357.994658946991 1102.8603446483612 810.1465609669685 1415.5122619867325 800.3605437278748 1404.223335981369 1401.8097949028015 1390.1256453990936 1324.5128226280212 855.5166405439377 1407.1921837329865 791.5804219245911 1420.2194046974182 1402.9505383968353 1199.6910852193832 1373.2760083675385 1268.3784794807434 1055.141298174858 948.1781554222107 1162.436945438385 1390.1986014842987 1163.4381693601608 1419.4050860404968 828.913854509592 1334.6456271409988 832.9694551229477 1002.9232484102249 772.3027263581753 1397.0247787237167 1408.0535304546356 1408.021656870842 1423.4376084804535 756.7043398320675 806.6268545389175 678.3564892411232 949.0723145008087 852.884443551302 1405.5460226535797 1402.198804616928 919.3853121995926 1067.8345394134521 1043.4892457723618 1042.680425643921 1120.40163397789 836.3967818021774 1409.2623126506805 918.3058571815491 1308.1176859140396 1133.379368185997 999.4606953859329 1349.8509359359741 1318.2369005680084 1158.1578385829926 1149.8732995986938 1404.8346561193466 1388.0496156215668 1408.222911953926 1388.5415774583817 1028.515590429306 1257.6837074756622 733.0845613777637 1406.9634807109833 1326.9869816303253 959.2990410327911 1287.1698570251465 1072.0912945270538 1272.7527153491974 907.2643202543259 981.4868998527527 1040.9514737129211 1408.8607859611511 1163.1759387254715 1131.4011943340302 1403.6983382701874 881.5233391523361 1044.1608709096909 694.8641110956669 1198.5999178886414 965.6430912017822 914.7335571050644 1405.319823026657 955.9856188297272 817.8319391608238 1234.1938149929047 1361.599279642105 1406.1867129802704 1165.9939569234848 730.7405342161655 1089.9661612510681 1273.571057319641 738.4557519853115 1245.5226612091064 1414.7327226400375 1316.4038789272308 946.0312706232071 924.0503889322281 1049.114106297493 1418.4436929225922 1408.1164729595184 1164.1429197788239 1406.9122505187988 852.5713738799095 976.3607066869736 1417.6400136947632 978.6124658584595 675.4977629333735 1144.06604886055 772.4150773882866 1409.8239225149155 955.5630815029144 1083.1934940814972 839.6246080100536 1408.0320727825165 1097.1602481603622 1130.0329101085663 1214.7582602500916 1394.9001115560532 1407.0563298463821 1415.387226343155 1403.0622971057892 )
set w1_array = ( 1079.2089653015137 1195.1377582550049 1182.355661392212 1155.7716083526611 1106.3745212554932 1248.1135082244873 1175.5370330810547 1212.5394535064697 1199.8841953277588 1121.2672901153564 1111.9817447662354 1236.4019107818604 1291.576976776123 1198.1233310699463 1194.3125438690186 1120.476312637329 1206.834192276001 1171.003885269165 1197.7508735656738 1165.6978797912598 1297.3890018463135 1190.491647720337 1178.441972732544 1205.6109619140625 1101.4583778381348 1021.7402172088622 1226.20436668396 1295.625467300415 1165.3607559204102 1167.5358486175537 1147.8339862823486 1227.7495098114014 1200.2271366119385 641.7745155096054 1172.648115158081 1185.2210235595703 1159.7046089172363 1139.1883563995361 1234.0904903411865 1241.494436264038 1111.813611984253 1198.3804416656494 1292.4290370941162 1196.5434741973877 1186.0115242004395 1197.3692607879639 1173.532886505127 1295.4811763763428 1183.6507034301758 1253.2213878631592 1247.4138927459717 1236.2219047546387 1195.3414154052734 1196.4780521392822 1289.3934917449951 1171.9008159637451 1278.1892490386963 1249.905080795288 1200.6036472320557 1219.8279571533203 1180.070276260376 1157.6899242401123 1196.6506671905518 1184.2408847808838 1236.19234085083 1118.563528060913 1240.2467918395996 1196.3113498687744 1171.9216537475586 1188.9624309539795 1191.2234020233154 1167.920322418213 1216.7830181121826 1273.7128448486328 1301.1893463134766 1275.2593231201172 1172.0054340362549 1189.4818496704102 962.422842979431 1080.8917236328125 1190.9103107452393 1257.7973556518555 1242.5062847137451 1198.4161567687988 1051.4396381378174 1187.7790641784668 1050.3676128387451 1154.0569972991943 1197.189588546753 1296.2825012207031 1185.2348041534424 1158.4788036346436 1065.4125881195068 1123.5476684570312 1224.2924880981445 1163.4086322784424 1185.0304317474365 1158.0858898162842 1255.081672668457 1238.7684535980225 1293.4415531158447 1239.220209121704 1115.361852645874 1205.6518745422363 1117.8979587554932 1292.3865985870361 1219.3120670318604 1137.0555591583252 1145.1061916351318 1156.1614227294922 1180.155439376831 1186.297960281372 1195.5460262298584 1160.6657695770264 1278.0871105194092 1073.5895347595215 1115.062780380249 1250.5115699768066 1190.0944423675537 1197.9785633087158 1085.0060176849365 1094.6696949005127 1071.5369892120361 1198.7628650665283 1256.9606971740723 1177.7954769134521 1191.7315673828125 1111.4474964141846 1187.4670696258545 1261.194725036621 1156.9051456451416 1151.0983180999756 1052.0391654968262 1196.6490459442139 1122.4535655975342 1191.895980834961 1293.3994007110596 1161.3570404052734 1199.400110244751 1194.2663860321045 1053.981466293335 1290.8536624908447 1274.0348529815674 1076.1107158660889 1268.1638431549072 1170.0629425048828 1068.0618476867676 1237.6069736480713 1064.5854663848877 985.7063245773314 1069.9580383300781 1167.6289749145508 1300.7293891906738 1199.3607711791992 1198.1730651855469 1171.9797801971436 1275.8069229125977 1053.6254596710205 1184.04390335083 1201.7841529846191 1238.2239532470703 1292.3793983459473 1250.2031993865967 1250.0859928131104 )
set r_array = ( 6.645188008546828e-06 6.656656240224838e-06 6.6514384496212e-06 6.654227499961853e-06 6.647095059156418e-06 2.664368947148323e-06 6.658970539569854e-06 6.642631863355636e-06 6.652797435522079e-06 6.651089762449264e-06 6.647746835947037e-06 3.073978082388639e-06 6.0623448836803435e-06 6.654299472570419e-06 6.657063935995101e-06 6.649546598196029e-06 6.64174047589302e-06 6.655350898504257e-06 6.6508595395088195e-06 6.6533142077922815e-06 5.276228089928627e-06 6.659657185077667e-06 6.653119300603866e-06 6.646573369503021e-06 6.6482649493217465e-06 6.638355528116226e-06 6.667094503641128e-06 5.202868555784225e-06 6.658157383203506e-06 6.65192661166191e-06 6.655129169225692e-06 6.6641664254665374e-06 6.649181817770004e-06 6.58082639157772e-06 6.656833266019821e-06 6.6517482447624206e-06 6.65406433224678e-06 6.654905651807785e-06 6.6641914594173426e-06 3.5859569656848906e-06 6.647071366310119e-06 6.6544121253490445e-06 6.0866807895898816e-06 6.6569566476345055e-06 6.652016018629074e-06 6.655780498981476e-06 6.6578221070766445e-06 6.009151090979576e-06 6.65950295805931e-06 3.990254600644111e-06 3.808776394575834e-06 3.111357319280505e-06 6.6500088322162625e-06 6.658128772974014e-06 4.971517299413681e-06 6.658278082609176e-06 6.321921025514602e-06 3.8900327432155605e-06 6.652159963846206e-06 6.665249143838882e-06 6.654772435426712e-06 6.6516905772686e-06 6.654533718824386e-06 6.656134997606277e-06 3.117901769578457e-06 6.649494295120239e-06 6.587686141133308e-06 6.658550326824188e-06 6.652323131561279e-06 6.659139518737793e-06 6.654313777685165e-06 6.6583227860927574e-06 6.6613054025173186e-06 4.529797707796096e-06 5.525904198288917e-06 6.290360589623451e-06 6.658340667486191e-06 6.658744339942932e-06 6.628187497258186e-06 6.645356987714767e-06 6.658677284717559e-06 4.119619329571724e-06 6.639213835000991e-06 6.655076419115066e-06 6.64163899898529e-06 6.654776011705398e-06 6.64162514090538e-06 6.652843033075332e-06 6.6582266736030575e-06 5.247467656731605e-06 6.654227052927017e-06 6.654210065603256e-06 6.643288557529449e-06 6.647762035131454e-06 6.6581627476215355e-06 6.653743361234664e-06 6.6561439383029935e-06 6.653928433656692e-06 4.043589879870414e-06 6.655538206100463e-06 5.113744338154792e-06 2.8884772054105994e-06 6.64695692539215e-06 6.646520172357559e-06 6.654363398551941e-06 5.0726546841859814e-06 6.645521943569183e-06 6.649462555646896e-06 6.653896694183349e-06 6.651900236606598e-06 6.654666041135788e-06 6.6545998799800864e-06 6.656435852050781e-06 6.651745562553406e-06 4.6407287317514415e-06 6.644484375715255e-06 6.648451362848282e-06 3.898124520778655e-06 6.655714784860611e-06 6.655717467069626e-06 6.643996213674545e-06 6.64732662320137e-06 6.644249235391616e-06 6.655215893983841e-06 4.096809153556823e-06 6.652971332073211e-06 6.6594890999794e-06 6.649774585962295e-06 6.652523403167724e-06 4.212016736268997e-06 6.654052709341049e-06 6.655298595428466e-06 6.6417243826389305e-06 6.65141386270523e-06 6.654985671043395e-06 6.653906081914901e-06 6.0967951762676235e-06 6.653872107267379e-06 6.655535076856613e-06 6.657122497558594e-06 6.641883527040481e-06 6.074250091910362e-06 4.537856851816177e-06 6.64476913690567e-06 4.394579057693481e-06 6.6558180499076835e-06 6.6437709081172935e-06 6.602875937819481e-06 6.643461560010909e-06 6.625221421122551e-06 6.643869255781174e-06 6.658299540281295e-06 5.537399699091911e-06 6.655444775819778e-06 6.6540437686443326e-06 6.656523917913436e-06 4.584676821827888e-06 6.641892467737197e-06 6.656055425405502e-06 6.650935535430908e-06 3.3959039609134195e-06 5.072480564117431e-06 6.580660094618797e-06 3.894936491847038e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
