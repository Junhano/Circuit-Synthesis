nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1407.2289970517159 1331.4466235041618 1407.5356629490852 1324.2657688260078 972.0800352096558 1307.7529725432396 783.7946397066116 1407.983725965023 866.4943632483482 825.514657497406 767.3617509007454 1391.8441143631935 1410.0805428624153 1409.6275624632835 827.2556123137474 1081.916734650731 1408.0236238241196 1131.16042137146 1406.632227897644 1298.9915814995766 787.8228929638863 1338.8374057412148 1361.7199566960335 704.5525294542313 1268.5472798347473 1158.4978532791138 1386.3047268986702 1202.0648401975632 1404.8719611763954 950.488308519125 837.424313724041 981.4302884787321 1041.908372733742 1095.5226254463196 1408.9471754431725 1227.516410946846 1197.6198610663414 1033.0562364123762 939.2138776183128 1095.2566285431385 1409.8059964179993 932.3410634696484 1178.1054270267487 1369.8008266091347 1451.599998474121 1415.2916726469994 969.554031342268 1422.8306692838669 1171.1542029678822 1012.9703507572412 998.0724454671144 1189.2838907241821 958.192680105567 1321.7057791352272 763.5985222458839 739.2477747797966 1110.6714290380478 1410.6366989016533 926.2718614935875 1410.0989830493927 1393.7505838274956 826.1281010508537 1369.8208984732628 1409.7275194525719 1284.7901564836502 1424.5007914304733 840.3550741076469 1407.4648079276085 942.5006006658077 1156.1168339848518 963.9850389957428 980.9985142946243 795.2304837107658 1363.8362419605255 1025.1819412969053 1065.690969657153 1403.8644787669182 1409.1496375203133 1395.2999171614647 1407.4668195843697 1398.1245067715645 1398.8976535201073 1408.2126972079277 1413.481270968914 681.337585747242 1399.8480495810509 977.2277698665857 1104.2550095170736 1410.2349933981895 1254.2159911990166 1408.2570430636406 993.3745899051428 1398.9962694048882 1129.0840619057417 1226.8223670125008 1235.7517090439796 747.7713432908058 1410.7343983650208 1169.6370673179626 1410.822710096836 1359.1247406601906 1139.488501548767 917.678030282259 1375.2922025322914 997.2279687225819 1007.9146326333284 1300.2122101187706 835.0268658995628 1242.2876489162445 1005.3363983333111 1077.4554052203894 1398.6103442311287 1232.0989426970482 768.8782718777657 965.4330686479807 704.647636115551 723.1719550490379 880.4132398962975 1278.1171333789825 976.9879859685898 866.9742216169834 1104.6527643501759 1299.5499727129936 1237.570023238659 1281.076682806015 1404.966866672039 792.5882172584534 1320.0464528799057 763.1941568851471 1409.7821247577667 1139.3400524556637 912.2323077917099 1411.512954235077 855.4521334171295 1387.8109660744667 1070.9877890348434 1222.0943701267242 1129.0608552098274 1186.7014598846436 1023.347104974091 1200.8647751808167 1409.1111478209496 1420.9586215019226 701.9092348217964 1407.6986518502235 1044.1001230664551 1326.9119021296501 746.6960009932518 1383.470570743084 1126.971475854516 1290.5785423517227 1346.8627986311913 1374.791098833084 1159.3861450254917 1410.26720225811 897.16423869133 1416.4689835906029 1320.3956094384193 1361.8080896139145 886.353639960289 855.7152357697487 818.3691856265068 790.6921190023422 783.6906370520592 979.7846694290638 )
set w1_array = ( 1275.7565212249756 1232.3661279678345 1230.0955963134766 1102.6889753341675 1225.0279378890991 1097.4881064891815 1215.234775543213 1291.168828010559 1020.6467103958129 1008.952201604843 1217.9982137680054 1235.801453590393 1276.5818548202515 1287.2688722610474 1220.5504369735718 1201.200885772705 1293.1894731521606 1216.0405111312866 1290.864748954773 1229.097409248352 1220.140619277954 1093.482358455658 1104.5234215259552 1121.682686805725 1227.3485136032104 1205.435128211975 1303.484387397766 1224.5331954956055 1277.8322410583496 1230.1913213729858 1229.35959815979 1213.7543630599976 1200.7016134262085 1039.7503805160522 1270.5522727966309 1218.3524322509766 1217.9295253753662 1194.5372533798218 1218.082184791565 1199.6653270721436 1295.626277923584 1028.0534219741821 1081.65069937706 1218.2174396514893 1292.41632938385 1260.074872970581 1226.3230276107788 1290.8625555038452 1219.2547273635864 1191.9992876052856 1187.2336101531982 1216.4444637298584 1213.8652515411377 1224.1582822799683 1226.0173749923706 1245.7411241531372 1202.962417602539 1313.6824560165405 1242.1945524215698 1300.6808471679688 1296.1632919311523 1214.0779447555542 1239.7264194488525 1244.9525547027588 1228.3709478378296 1280.0553035736084 1230.2066278457642 1210.337610244751 1228.3954572677612 1216.3929176330566 1229.363079071045 1196.0771751403809 1213.8163995742798 1233.7172222137451 1189.7481393814087 1032.499499320984 1228.809757232666 1270.2235651016235 1286.3028001785278 1291.148419380188 1305.7957601547241 1281.9391679763794 1278.280611038208 1223.86221408844 759.0938282012938 1259.6164417266846 1210.1155471801758 1192.3461866378784 1301.8153619766235 1226.0577154159546 1277.6634645462036 1189.7293043136597 1322.1303176879883 1067.0032036304474 1224.918646812439 1091.5397953987122 1047.7593910694122 1269.9891519546509 1212.5253629684448 1269.7161149978638 1205.9668493270874 1200.9434652328491 1225.3342819213867 1225.7492971420288 1030.8915090560913 1205.7803583145142 1224.523205757141 1012.3811733722686 1229.6036434173584 1195.3876447677612 1195.962209701538 1312.6754236221313 1232.3355150222778 1017.0669001340865 1210.1866674423218 1128.5178852081299 1244.8413801193237 1230.0858449935913 1227.8724145889282 1032.709778547287 1238.5844898223877 1197.6934623718262 1236.2583112716675 1226.3291311264038 1223.6998748779297 1278.222222328186 1214.1712379455566 1229.9718570709229 1235.8176898956299 1269.966835975647 1072.728271484375 1232.5664234161377 1307.89484500885 1218.858404159546 1242.2132205963135 1204.7487449645996 1224.3496131896973 1198.3641576766968 1215.9362506866455 1184.9072170257568 1092.8686034679413 1292.0320463180542 1326.0743570327759 1260.8807754516602 1280.2157354354858 1190.5591917037964 1234.338207244873 1242.6045370101929 1157.0489358901978 1202.851481437683 1235.9538507461548 1222.7833223342896 1224.1460990905762 1080.5272471904755 1277.5961589813232 1238.3552026748657 1247.4814367294312 1231.940884590149 1208.7664794921875 1022.0083427429198 1225.690574645996 1224.9935340881348 1222.885913848877 1220.8520364761353 1202.7192306518555 )
set r_array = ( 4.9516346008703106e-06 6.6506205993890755e-06 6.6601044434309e-06 6.630658258795738e-06 6.6564975428581235e-06 6.633137961030006e-06 6.6413660842180244e-06 5.701892537176609e-06 6.620307837724685e-06 6.6199951368570325e-06 6.640204017162323e-06 6.661517967581748e-06 5.3732171590626234e-06 5.6192973750829695e-06 6.654258568882942e-06 6.659359012842178e-06 5.757035290002822e-06 6.6598523157835e-06 5.681488023251294e-06 6.652147893905639e-06 6.64982107758522e-06 6.634057735204696e-06 6.636627961993217e-06 6.608694655001163e-06 6.651978691220283e-06 6.649271448254585e-06 4.133479924052954e-06 6.648886551260948e-06 4.865467211343347e-06 6.6612765687704084e-06 6.641057630181312e-06 6.660208155512809e-06 6.66053180873394e-06 6.638037015795707e-06 5.1250276091694826e-06 6.646466528177261e-06 6.651480247378349e-06 6.65711646258831e-06 6.644940351247787e-06 6.659627457261085e-06 5.842447442114353e-06 6.628659342527389e-06 6.63833585858345e-06 3.6421485739946362e-06 2.9113107669353483e-06 6.6628380614519114e-06 6.652161081433296e-06 6.658801560401916e-06 6.651602287888527e-06 6.656815384626388e-06 6.6485825675725936e-06 6.652296532988548e-06 6.650081922411918e-06 6.652873878479004e-06 6.642184381484985e-06 6.617167194485664e-06 6.656637911796569e-06 6.194454294741153e-06 6.653285374045371e-06 5.938321774005889e-06 4.424832307845354e-06 6.644185085892677e-06 6.654455487728118e-06 6.663407807350158e-06 6.651311938762664e-06 6.645570223331451e-06 6.642231990694999e-06 2.959478435218334e-06 6.654765953421592e-06 6.654072155356406e-06 6.65458781003952e-06 6.647166137695312e-06 6.643759285211563e-06 6.648411576747894e-06 6.65624362707138e-06 6.634443079233169e-06 6.658434097766876e-06 5.183519938141107e-06 4.482367758750916e-06 5.7062037411332125e-06 4.3844115297496315e-06 4.626525499038398e-06 5.406847478002309e-06 2.9592763754725454e-06 6.587136735320091e-06 3.609657858610153e-06 6.657360096573829e-06 6.64945786178112e-06 6.000879381895065e-06 6.6495367634296415e-06 5.358624489158392e-06 6.646698762774467e-06 4.269627289026975e-06 6.636855726242065e-06 6.645708580613136e-06 6.634600659012794e-06 6.5996977436542504e-06 5.155024205446243e-06 6.652713840007782e-06 5.175943256467581e-06 3.66527458012104e-06 6.6490758705139156e-06 6.641695995926857e-06 3.6349400255084035e-06 6.635852803587913e-06 6.659189139604568e-06 6.651160617470741e-06 6.619510215818881e-06 6.645899464488029e-06 6.657368813753128e-06 6.657047842741012e-06 4.350056120306253e-06 6.649493848085403e-06 6.604645525217056e-06 6.650393729209899e-06 6.610465807020664e-06 6.633615617752075e-06 6.648094852566719e-06 6.648598660826683e-06 6.632700537443161e-06 6.633905519843101e-06 6.656919320225715e-06 6.649197687506675e-06 6.648490925431251e-06 6.650738393068314e-06 4.836251263618469e-06 6.642565702199935e-06 6.652303685545921e-06 6.631866593956947e-06 5.038649582415819e-06 6.6381431865692135e-06 6.645637502074241e-06 6.105745484232902e-06 6.646044974327087e-06 3.6193300160765644e-06 6.660589923262596e-06 6.648419846892357e-06 6.650117685198783e-06 6.650698830485344e-06 6.651047070622444e-06 6.635896165966987e-06 5.729947884678841e-06 6.4667276787757866e-06 6.633209039568901e-06 5.418440488278865e-06 6.656011168956756e-06 6.64837894320488e-06 6.624171783328056e-06 2.9624468582868576e-06 6.655564804673195e-06 6.6488378244638435e-06 6.6540779668092725e-06 3.633987841308117e-06 6.6386706876754755e-06 5.421054803878068e-06 6.6532022255659095e-06 6.66665842115879e-06 6.6508669155836104e-06 3.6568422737717624e-06 6.625658621191978e-06 6.650347908139229e-06 6.638789375424385e-06 6.63841274857521e-06 6.65014696598053e-06 6.650113661885261e-06 )
set i = 165
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
