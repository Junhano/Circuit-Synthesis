nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1401.5333485603333 1397.7999371290207 1124.4304013252258 1191.665021777153 1199.3881744146347 1313.4521973133087 1024.6504378318787 756.2916428595781 1402.6314002275467 1378.20152759552 1209.9620234966278 1366.137398481369 1425.0269961357117 1003.6696177721024 1400.0289422273636 1083.734495639801 1337.0528650283813 1058.257935643196 1371.766550540924 775.1364913582802 892.1449092030525 1165.223492383957 877.219310104847 1185.0542259216309 1282.1066510677338 1400.2971184253693 988.5812085866928 929.177140891552 997.2033482789993 1409.8835122585297 1352.363897562027 1425.8705508708954 1053.6786448955536 1264.1237807273865 1327.2130471467972 1374.7737538814545 1426.86913728714 1425.3992867469788 1393.7609773874283 973.4215867519379 1013.5745015740395 1104.5483481884003 945.2142027020454 1188.8575983047485 1130.2993428707123 1401.6013425588608 1347.7169704437256 1054.4394087791443 745.5607951432467 914.2434728145599 777.606302946806 911.5200471878052 1140.5677777528763 1367.6245045661926 1415.8890676498413 1001.0485631227493 982.1255114674568 1137.9313004016876 1422.4731755256653 1420.8065402507782 1347.3650646209717 930.5479061603546 838.2081110775471 843.553004860878 788.2411834597588 1422.985030412674 1400.9660613536835 799.7599412500858 710.235904045403 1388.1779146194458 1400.1030158996582 857.5988841056824 1369.2336064577103 1170.7024854421616 1384.2411470413208 1087.7100658416748 1022.2279560565948 1201.8914353847504 717.3918952047825 736.243002191186 1426.2942504882812 1146.9259095191956 1417.8436827659607 840.9190756082535 1350.1784336566925 880.5652093887329 1323.2190144062042 889.3420678377151 732.7152156084776 1251.7532986402512 1406.3661080598831 965.4367399215698 1116.2267309427261 1072.1151214838028 1108.318371772766 775.8131456375122 954.549742937088 1404.080284833908 686.9285498559475 1050.7475715875626 1122.3224532604218 1265.8196967840195 761.1328233778477 973.4467995166779 723.4850638359785 1005.3234231472015 986.3912296295166 1256.481273174286 1401.7387163639069 1400.5162996053696 1423.4505724906921 1171.549392938614 899.9834191799164 1389.691887497902 1064.4993019104004 1274.214072227478 1416.509239077568 883.8839289546013 1045.9026527404785 854.5516264438629 1137.1487659215927 1158.1797432899475 1406.1786216497421 1161.8853044509888 1372.163428068161 1189.3944871425629 746.5628963708878 1119.517846107483 1361.3414299488068 1426.455898284912 1336.0065799951553 840.4367585480213 1417.4001348018646 924.3655931949615 1142.729504108429 1408.1382435560226 1035.0290444493294 1042.9200139641762 678.5892644710839 761.6548762470484 1308.909250497818 917.1844255924225 1425.2331686019897 1401.826514005661 1419.1874694824219 1007.8137201070786 809.4236385822296 1024.735128581524 1424.8125088214874 1190.712748169899 936.6576206684113 1416.5876042842865 1184.2950266599655 897.830320596695 943.088239133358 1071.986375451088 985.8404380083084 901.6137105226517 1299.6484768390656 1133.8959169387817 1098.1935691833496 1157.9348576068878 1427.3041021823883 995.3616765141487 )
set w1_array = ( 1299.2717933654785 1275.0283908843994 1223.0892372131348 1231.151647567749 1231.9625568389893 1249.688310623169 1210.7979011535645 1139.244623184204 1296.3866901397705 1266.8540668487549 1233.3561611175537 1262.9008960723877 1312.750358581543 1207.7902507781982 1307.4001026153564 1218.337697982788 1254.6368789672852 1215.2518463134766 1264.7091579437256 1148.0848026275635 1186.6852951049805 1227.872724533081 1182.814474105835 1230.1972579956055 1243.9488124847412 1306.1385345458984 1205.4977130889893 1194.891185760498 1206.8399143218994 1281.7920398712158 1258.7418746948242 1298.43918800354 1214.653844833374 1241.0902690887451 1252.6812744140625 1265.6940174102783 1308.671064376831 1297.6182174682617 1273.134298324585 1203.0243587493896 1209.3684387207031 1220.8508205413818 1198.023624420166 1230.589838027954 1223.742265701294 1317.1688270568848 1257.6604080200195 1214.747018814087 1134.3670558929443 1191.7584133148193 1149.3139934539795 1191.1781024932861 1224.906988143921 1263.3303356170654 1320.5623817443848 1207.3888492584229 1204.468936920166 1224.665994644165 1315.4023838043213 1289.607400894165 1257.2212886810303 1195.176763534546 1171.2400150299072 1173.395414352417 1153.7429523468018 1293.96240234375 1315.434045791626 1158.0156993865967 1115.6189632415771 1270.657606124878 1309.6781921386719 1177.2909355163574 1263.8047409057617 1228.631944656372 1269.1137981414795 1218.8251209259033 1210.4689311981201 1232.3290538787842 1119.6136665344238 1128.628225326538 1301.189203262329 1225.7777881622314 1287.8738117218018 1172.532434463501 1258.0746841430664 1183.757085800171 1251.8445682525635 1185.994119644165 1128.1374645233154 1239.2121028900146 1321.2200832366943 1201.7591190338135 1222.1217823028564 1216.994161605835 1221.2307167053223 1148.385353088379 1199.8241138458252 1320.0000476837158 1102.2440147399902 1214.3593978881836 1222.9795169830322 1241.3438510894775 1141.0273265838623 1203.1173419952393 1121.7667770385742 1208.047456741333 1205.1368427276611 1239.6374893188477 1317.2073554992676 1304.4951152801514 1294.035406112671 1228.4577083587646 1188.4954643249512 1271.3267517089844 1216.061086654663 1242.4972248077393 1319.8876094818115 1184.563512802124 1213.6688899993896 1176.385087966919 1224.6504974365234 1227.1050643920898 1321.1478424072266 1227.3297500610352 1264.7136878967285 1230.8936786651611 1135.1118755340576 1222.4940967559814 1261.4401054382324 1300.3507804870605 1254.6364498138428 1172.3053169250488 1287.5659656524658 1193.9014148712158 1225.331039428711 1287.798137664795 1212.2490119934082 1213.2487487792969 1096.6278743743896 1142.2612857818604 1248.8893222808838 1192.4103450775146 1297.2753238677979 1298.7721157073975 1289.1951274871826 1208.3915424346924 1161.0095691680908 1210.8226013183594 1297.0782470703125 1231.0077381134033 1196.387643814087 1286.8464183807373 1230.2221965789795 1188.0284976959229 1197.6577949523926 1216.9447612762451 1205.0712299346924 1188.8874244689941 1247.1080493927002 1224.32767868042 1220.0674724578857 1226.8892002105713 1304.9695205688477 1206.5424633026123 )
set r_array = ( 3.3222397445887327e-06 6.554564883112907e-06 6.726702575683594e-06 6.752203230857848e-06 6.754797821044921e-06 6.758436237573623e-06 6.696787004470825e-06 6.646803592443466e-06 3.2118595234304663e-06 6.6481585550308225e-06 6.758363370895385e-06 6.685990666151046e-06 5.6101271259784695e-06 6.692590688467025e-06 3.636593942642212e-06 6.7134703445434565e-06 6.735419754981994e-06 6.704957013130187e-06 6.670440559387207e-06 6.6594336676597594e-06 6.682779614925384e-06 6.742106502056121e-06 6.682477419376373e-06 6.749664967060089e-06 6.769456093311309e-06 3.581573733240366e-06 6.690667991638183e-06 6.68482256412506e-06 6.691727464199066e-06 6.45243463397026e-06 6.714067583084106e-06 6.10368174791336e-06 6.703615908622741e-06 6.770281319618225e-06 6.748517875671387e-06 6.660588805675506e-06 5.783506010770798e-06 6.1223982024192805e-06 6.579042946100234e-06 6.688314800262451e-06 6.697911744117736e-06 6.719337229728699e-06 6.685656731128692e-06 6.751061503887176e-06 6.729253803491592e-06 4.135340538918972e-06 6.723614012002944e-06 6.704136704206466e-06 6.642625604867935e-06 6.683738951683044e-06 6.66192901611328e-06 6.684790377616882e-06 6.732959722280502e-06 6.681567256450652e-06 5.0733379769325256e-06 6.692710046768188e-06 6.689513747692108e-06 6.731855993270873e-06 5.461195011734962e-06 2.4881757824867964e-06 6.720697556734084e-06 6.685000036954879e-06 6.675697689056396e-06 6.678692822456359e-06 6.666109685897827e-06 6.203560282588004e-06 4.018921156525612e-06 6.667840604782104e-06 6.6137017804384225e-06 6.605930973887443e-06 3.730181076675653e-06 6.679670040607452e-06 6.676548843383789e-06 6.744413648843765e-06 6.624704648852348e-06 6.714225833415985e-06 6.696706091165542e-06 6.7556673038005826e-06 6.620308508276939e-06 6.626911659836769e-06 6.016228993535042e-06 6.735049163103103e-06 6.343450446724891e-06 6.678175603151321e-06 6.717116360664367e-06 6.682543580532073e-06 6.752257322072983e-06 6.6828891384601585e-06 6.635978643894195e-06 6.769034092426299e-06 4.524910275936126e-06 6.689891939163208e-06 6.724159841537475e-06 6.708742951154708e-06 6.722355608940124e-06 6.659791295528412e-06 6.688750212192535e-06 4.378495191335678e-06 6.5929647284746165e-06 6.705707137584686e-06 6.725843374729156e-06 6.770287578105926e-06 6.645799552202224e-06 6.690745775699615e-06 6.615226616263389e-06 6.6929657506942746e-06 6.6902388381958005e-06 6.768692557811736e-06 4.1313910979032515e-06 3.5166045400500295e-06 6.214290906786918e-06 6.745006417036056e-06 6.685517703294753e-06 6.599672709703445e-06 6.706596289873123e-06 6.769515101909637e-06 5.125863452553749e-06 6.683202509880066e-06 6.703176473379135e-06 6.679141645431518e-06 6.7313481616973876e-06 6.739489560127258e-06 4.512081717252731e-06 6.74142611503601e-06 6.6671423363685605e-06 6.751503621339797e-06 6.645570223331451e-06 6.726063762903213e-06 6.697516565322876e-06 6.049148415327072e-06 6.7388078320026396e-06 6.677805905342102e-06 6.344208170771599e-06 6.6842414188385e-06 6.733459954261779e-06 2.8377751744072883e-06 6.699029331207275e-06 6.701612298488617e-06 6.57869939982891e-06 6.654366080760956e-06 6.76162761926651e-06 6.685081844329833e-06 6.131121416687965e-06 3.300677354559302e-06 6.314886261820793e-06 6.693851773738861e-06 6.666526322364807e-06 6.696621601581573e-06 6.1277029412984844e-06 6.751891200542449e-06 6.685116713047027e-06 6.358031158447265e-06 6.749516998529434e-06 6.684547190666199e-06 6.686866407394409e-06 6.709084038734436e-06 6.691142742633819e-06 6.685742114782333e-06 6.76556957244873e-06 6.730219845771789e-06 6.717238401174545e-06 6.740072493553161e-06 5.91290270268917e-06 6.691313509941101e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
