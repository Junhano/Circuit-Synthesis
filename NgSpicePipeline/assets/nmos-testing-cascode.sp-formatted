nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 5.732973935082554e-06 5.221993699669838e-06 5.756360696628689e-06 6.952086418867111e-06 6.727182030677796e-06 4.412515848875046e-06 4.16987258195877e-06 5.2236855477094645e-06 5.187831342220307e-06 4.428665965795517e-06 4.166696310043335e-06 6.706886649131775e-06 7.230835527181625e-06 6.998757213354111e-06 7.231240004301071e-06 6.995329797267914e-06 6.253870174288749e-06 5.989510111510753e-06 5.711871962994337e-06 6.004504263401032e-06 5.471593119204044e-06 5.468709900975227e-06 4.1457563042640685e-06 6.992574542760849e-06 5.74218469671905e-06 4.411561340093613e-06 4.119825780391693e-06 4.428574055433273e-06 5.723610578104853e-06 4.433444589376449e-06 5.7390573918819425e-06 4.428128451108933e-06 5.443472035229206e-06 5.7285670824348925e-06 6.482961937785149e-06 6.508684277534485e-06 4.18587464094162e-06 4.175946354866028e-06 6.960800737142563e-06 7.217479467391968e-06 4.960569113492965e-06 5.9785252138972284e-06 4.674610048532486e-06 4.9573136270046235e-06 6.99161770939827e-06 6.764381051063538e-06 6.477608069777489e-06 4.944215953350067e-06 4.944911897182465e-06 6.260786920785904e-06 )
set w1_array = ( 1.001839977502823e-05 7.855391323566437e-06 8.523217363283037e-06 7.118849396705627e-06 8.159636281430721e-06 9.424414843320846e-06 8.506595596671105e-06 7.275649011135101e-06 9.656822264194488e-06 7.470391422510147e-06 8.65397335961461e-06 9.640988022089005e-06 9.666497081518173e-06 8.155491106212138e-06 1.0017784655094147e-05 7.3868899643421166e-06 9.710306853055954e-06 7.138749510049819e-06 7.148364514112472e-06 9.4009091258049e-06 9.7070674598217e-06 7.520097404718399e-06 9.746548146009446e-06 8.17414801567793e-06 8.452594984322786e-06 9.843035966157914e-06 9.959898740053178e-06 7.109587460756302e-06 8.706501215696335e-06 7.441173404455184e-06 9.567931801080704e-06 7.125638872385024e-06 9.984752804040909e-06 9.92323312163353e-06 9.529405981302261e-06 9.542556494474411e-06 7.707264274358749e-06 7.503680855035782e-06 8.387812249362469e-06 9.358635187149048e-06 8.278634004294872e-06 8.168893434107303e-06 9.864775806665421e-06 8.357813596725464e-06 7.730987519025802e-06 9.954186886548996e-06 8.624622952193022e-06 9.944741398096085e-06 9.830532044172286e-06 8.681234873831271e-06 )
set r_array = ( 273.90522062778473 345.861298404634 386.99957579374313 208.0165147781372 457.580703496933 214.5317256450653 315.55776074528694 344.6034708991647 235.14074683189392 457.8708291053772 295.8457440137863 461.23857498168945 371.9464913010597 289.6737888455391 461.54881715774536 382.46141225099564 271.85307145118713 435.7650011777878 396.6456398367882 386.6590201854706 479.66791689395905 419.30394023656845 481.9277137517929 268.16876232624054 289.3840119242668 369.7003312408924 315.78683480620384 349.1266677156091 213.9324128627777 332.644572108984 441.7100191116333 385.3094130754471 195.78558802604675 363.2924623787403 192.72039532661438 271.0474878549576 232.81279504299164 311.92983388900757 208.55676531791687 460.9600007534027 385.6392979621887 456.77897334098816 253.8395255804062 440.5950605869293 345.9344455972314 270.0978696346283 423.5026881098747 386.35158985853195 368.230402469635 309.20878648757935 )
set i = 50
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
