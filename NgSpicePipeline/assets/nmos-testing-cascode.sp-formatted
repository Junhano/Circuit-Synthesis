nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 1418.3609467744827 799.7921277582645 1391.354365348816 872.4439498782158 916.6864064335823 1261.709703207016 765.361303538084 1325.6051522493362 1404.8961681127548 1383.8877213001251 1100.6036233901978 1298.2809972763062 1309.9660855531693 1312.447754740715 838.6654724180698 1058.5466307401657 951.661294400692 885.4799327254295 848.150400519371 1359.4595474004745 950.474416911602 1287.1184927225113 1219.844577908516 1306.2497955560684 1281.5123182535172 1186.7488008737564 942.1677273511887 812.8220421075821 1071.8693417310715 1417.7510571479797 1098.636446595192 1065.4411149024963 1093.125445842743 1087.7737683057785 1275.9270203113556 1376.9083005189896 940.0175121426582 1417.6282566785812 1161.0829216241837 1181.5300714969635 1358.2946193218231 1385.8849835395813 1266.0950702428818 1417.2506910562515 1273.8816571235657 687.5555413588881 1209.3439084291458 982.4853521585464 819.644285440445 900.9782281517982 1403.495071530342 1377.1428149938583 1320.0086337327957 1379.6977978944778 1401.1745584011078 896.645790040493 1404.782174229622 707.7036053687334 1379.9433094263077 1044.864213168621 741.2503008544445 911.6567280888557 1374.3761163949966 1078.2740098237991 1419.290108680725 823.9333052933216 1379.0185731649399 1386.7442291975021 899.0244847536087 755.1443558931351 1354.0124279260635 1277.4544042348862 1332.5905632972717 1385.3021842241287 968.9836484193802 740.6722009927034 1364.0957009792328 1283.687053322792 1371.6695886850357 1368.6805349588394 1251.2341123819351 1349.146721959114 1354.0101033449173 1411.398200392723 804.6606723964214 766.0246250033379 991.6817304491997 1174.8031359910965 1062.9319083690643 832.4471955001354 763.1432954967022 1362.1257078647614 1387.2603756189346 681.0195260494947 1147.033331990242 989.1853538155556 781.0771261155605 1418.3297437429428 1048.4810155630112 985.8296197652817 849.9926646053791 827.2506502270699 842.722090035677 1268.4745025634766 1142.1972197294235 737.5299428403378 931.4468932151794 1412.6890134811401 755.4741055518389 681.4820087328553 1417.8623241186142 1352.6054751873016 1392.6702570915222 1122.9847353696823 1115.4704821109772 920.9763985872269 1166.1509555578232 1085.3308123350143 1336.0690754652023 1342.5146025419235 1413.8559979200363 1383.1724208593369 1379.2749029397964 999.1191831231117 1367.1363425254822 827.650712877512 813.1344971060753 1399.9901396036148 867.4827796220779 1164.337022304535 1417.22158908844 1418.7205415964127 966.3269650936127 796.9314512610435 1080.658672451973 1212.4022525548935 1397.232202887535 834.6696850657463 1311.3265019655228 1347.0938038825989 1389.9631929397583 1097.2952526807785 906.7977052927017 1310.2486115694046 946.559017598629 1326.1293005943298 1388.1372791528702 1383.1570875644684 1043.0467930436134 1130.8154445886612 1319.890348315239 1287.7935153245926 1376.9032937288284 955.0027903914452 1246.999843120575 1192.64004945755 1390.7723259925842 1380.855484008789 1273.3356040716171 936.6410580277443 1232.4151527881622 735.9973341971636 1114.7694420814514 1336.6244715452194 )
set w1_array = ( 1305.9976768493652 1204.7075939178467 1269.249267578125 1217.2139358520508 1216.7936992645264 1184.2231464385986 1187.467975616455 1215.105266571045 1283.3189678192139 1262.8308486938477 1184.9287223815918 1199.243803024292 1205.8872890472412 1205.5347633361816 1214.1414833068848 1193.0709075927734 1213.1119918823242 1217.4182605743408 1214.7259902954102 1237.7656173706055 1212.6117897033691 1193.4591484069824 1176.7557334899902 1203.1901550292969 1190.971441268921 1174.7239303588867 1213.9700603485107 1208.9273643493652 1189.7175025939941 1302.7892303466797 1185.178108215332 1191.6474533081055 1186.0808086395264 1186.1030769348145 1189.36354637146 1253.3956718444824 1214.4303512573242 1306.1329078674316 1175.9709548950195 1174.887866973877 1254.3348026275635 1268.743200302124 1187.6594734191895 1305.9247207641602 1188.9457893371582 1083.0910873413086 1175.495548248291 1207.2419357299805 1207.6084327697754 1217.5790977478027 1292.891616821289 1253.5405826568604 1210.4454231262207 1257.848949432373 1290.1024532318115 1216.6375350952148 1283.224744796753 1125.8481216430664 1258.1176948547363 1195.2324104309082 1168.1815814971924 1217.1426963806152 1251.4266204833984 1188.7786102294922 1305.9299182891846 1211.8025016784668 1256.4792823791504 1269.9160289764404 1215.4119205474854 1180.1147651672363 1261.1128044128418 1189.872760772705 1217.813606262207 1267.7790832519531 1210.2406692504883 1166.273136138916 1251.1911582946777 1192.739839553833 1248.6046504974365 1249.819679260254 1182.563705444336 1230.244369506836 1265.5879211425781 1291.2791442871094 1206.071491241455 1187.367935180664 1206.4068984985352 1175.113697052002 1191.9025611877441 1213.095302581787 1184.959192276001 1241.1222648620605 1270.4889011383057 1069.5746612548828 1177.4341773986816 1207.2146606445312 1196.3551712036133 1303.1819534301758 1195.1676082611084 1207.8110885620117 1215.9581851959229 1212.078685760498 1215.2034950256348 1186.3084506988525 1177.784366607666 1164.3433284759521 1215.4997539520264 1295.6717681884766 1179.636402130127 1068.0809211730957 1306.2374305725098 1232.2632503509521 1269.1172313690186 1180.1312637329102 1182.1383666992188 1216.3329792022705 1175.6058406829834 1187.376708984375 1221.9596099853516 1224.9269676208496 1303.4259986877441 1264.1012382507324 1256.8414878845215 1204.7420692443848 1246.104736328125 1209.542579650879 1208.6698246002197 1289.0899848937988 1217.5062847137451 1175.7377815246582 1300.4263591766357 1302.8320503234863 1210.8588409423828 1200.1305294036865 1188.3062076568604 1175.9836864471436 1285.53373336792 1212.7367210388184 1205.5154991149902 1229.858798980713 1275.2261352539062 1185.5521392822266 1217.4263191223145 1205.9947681427002 1213.7735557556152 1213.6293125152588 1271.9906997680664 1264.1001415252686 1196.5027523040771 1179.4364166259766 1209.7888660430908 1193.719882965088 1253.109474182129 1210.6046867370605 1182.150764465332 1174.7012329101562 1275.9021472930908 1259.7509574890137 1188.1416511535645 1214.9501991271973 1179.164047241211 1161.340732574463 1181.3873958587646 1221.6656875610352 )
set r_array = ( 6.089384679794311e-06 6.618175928592681e-06 6.606034015417099e-06 6.641862516403198e-06 6.654744719266891e-06 6.682683055400848e-06 6.607671504020691e-06 6.691855316162109e-06 6.533397113084793e-06 6.626383041143417e-06 6.675461654663085e-06 6.6898481297492975e-06 6.690630440711975e-06 6.695166503190994e-06 6.631434534788131e-06 6.674242590665817e-06 6.663696144819259e-06 6.645673488378525e-06 6.635102455615997e-06 6.683668767213821e-06 6.661929463148117e-06 6.688919191360473e-06 6.6685317206382745e-06 6.691697512865066e-06 6.6880023229122154e-06 6.670794163942337e-06 6.660731856822967e-06 6.622119669914245e-06 6.669313584566116e-06 6.266299610137939e-06 6.674467449188232e-06 6.6741576540470115e-06 6.673255984783172e-06 6.663874958753586e-06 6.684981261491775e-06 6.657582496404648e-06 6.660654072761535e-06 6.00737837433815e-06 6.667568360567093e-06 6.667537515163421e-06 3.2187031238526104e-06 4.733948906064033e-06 6.676454071998595e-06 6.0324755805730815e-06 6.683330361843109e-06 6.579882924556732e-06 6.66945305943489e-06 6.66589779138565e-06 6.627989237308502e-06 6.650156800746917e-06 5.383868490457534e-06 4.209213157296181e-06 6.694684152603149e-06 4.395133827924728e-06 5.302878295183181e-06 6.648875151872635e-06 6.533967082500457e-06 6.588289861679077e-06 4.4032193470001216e-06 6.66977045416832e-06 6.60033342719078e-06 6.653339688777923e-06 6.661067579984665e-06 6.671943490505218e-06 6.12906438589096e-06 6.625712488889694e-06 4.340843905806541e-06 4.763528307080269e-06 6.649573420286178e-06 6.604851608276366e-06 2.932425060421228e-06 6.685502951145171e-06 6.695862536430358e-06 4.707098205685615e-06 6.666247819662094e-06 6.599767928123473e-06 3.4624936553835868e-06 6.6860317933559415e-06 6.6672487306594844e-06 3.6650109972059726e-06 6.675190304517746e-06 6.6892307746410365e-06 2.8078076738119122e-06 6.4664786803722375e-06 6.620641325712204e-06 6.607481961250305e-06 6.66984734416008e-06 6.667437379360198e-06 6.672364597320556e-06 6.629466910958289e-06 6.608180229663848e-06 6.677348141670226e-06 4.7761027264595025e-06 6.576048259735107e-06 6.670000230073928e-06 6.670947943925857e-06 6.613123093843459e-06 6.2590245652198785e-06 6.674141113758087e-06 6.670422230958938e-06 6.634615187644958e-06 6.627835904359817e-06 6.6320107626914974e-06 6.6844591248035425e-06 6.665403370857239e-06 6.598908727169036e-06 6.658762221336364e-06 6.4035384106636045e-06 6.604274933338165e-06 6.576625828742981e-06 5.995223050117492e-06 6.68898579955101e-06 6.609929700493812e-06 6.6617394733428955e-06 6.673429434299469e-06 6.65579391002655e-06 6.669434283971786e-06 6.67164308309555e-06 6.690782432556152e-06 6.6931396472454065e-06 5.758067269921302e-06 4.600552816987038e-06 4.354251821637153e-06 6.669533525705337e-06 6.668515627384185e-06 6.630418871641159e-06 6.623319064378738e-06 5.281806637644768e-06 6.639959489107132e-06 6.667414580583572e-06 6.332648967504501e-06 6.27596226811409e-06 6.666378800868988e-06 6.620846067667007e-06 6.671791945695877e-06 6.667437379360198e-06 5.183443104028702e-06 6.631005828380585e-06 6.693598752021789e-06 6.6869656491279595e-06 4.909153704643249e-06 6.675656561851501e-06 6.651935552358627e-06 6.690765892267227e-06 6.66250703215599e-06 6.6962331283092494e-06 4.817908753752708e-06 4.600727831125259e-06 6.6752443957328794e-06 6.668960427045822e-06 6.696045373678207e-06 6.689138238430023e-06 4.185440962314606e-06 6.660168145895004e-06 6.671169673204421e-06 6.671001141071319e-06 4.920254473686218e-06 4.460480262637138e-06 6.685143982172012e-06 6.660096620321274e-06 6.6674181568622585e-06 6.598322664499283e-06 6.662268315553665e-06 6.692459707260132e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
