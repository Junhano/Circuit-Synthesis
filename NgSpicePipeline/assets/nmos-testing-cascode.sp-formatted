nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V1 in 0 dc 800m ac 1
Vdd net3 0 dc 1.2
R0 net3 out 500
V2 net2 0 dc 1.2
mn0 net1 in 0 0 NMOS W=5u L=45n
mn1 out net2 net1 0 NMOS W=3u L=45n

.control
set w0_array = ( 987.0991539955139 1243.3064413070679 905.1390272378922 1431.1567378044128 1073.4889489412308 1407.4792248010635 1428.076399564743 817.4706456065178 944.8944386839867 966.3433712720871 1431.088252067566 1236.1904066801071 1243.821559548378 1431.7513835430145 1433.158917427063 716.4071724563837 810.521802008152 1175.1837861537933 1428.9742243289948 1036.040639579296 1303.5057616233826 1424.3727159500122 882.8475457429886 1437.9818868637085 909.1922473907471 1438.655925989151 1357.3358190059662 839.9031889438629 959.9429053068161 1176.2566250562668 1092.5839972496033 1430.3543102741241 1445.3766477108002 1440.1926529407501 768.2985459268093 1325.1868617534637 1090.6330478191376 1394.0363955497742 1435.9387588500977 1431.9521915912628 685.3869837522507 870.4387080669403 1323.4519642591476 992.5882947444916 984.7718906402588 1307.7299278974533 768.4459780156612 1403.4009259939194 1046.804456114769 1440.1710164546967 1435.8560574054718 1440.022600889206 741.3457092642784 1021.821780204773 1431.114627122879 1110.5707567930222 936.7908817529678 1436.2397027015686 745.8360680192709 1162.3694431781769 1266.9393849372864 1168.547911643982 767.2129665315151 1350.74469268322 1019.3463695049286 1194.8357951641083 816.7355862259865 1428.2811415195465 1436.5318846702576 898.1894013285637 1440.3326642513275 766.0603542625904 874.519510269165 1234.1570687294006 1409.6653592586517 1440.4874277114868 1037.3414885997772 1067.562026977539 1438.4016525745392 856.0436499118805 1309.7249549627304 698.3568752929568 892.5396633148193 816.1397334933281 1348.2273948192596 791.1121417582035 1105.383677482605 843.805333673954 1272.4169921875 799.8741921782494 1435.0520205497742 1232.2852444648743 1447.476191520691 770.7187478244305 1061.224056482315 873.5578936338425 801.0850866138935 863.5930401086807 894.8372435569763 1437.418086528778 1072.6275128126144 709.3555443733931 1437.877995967865 684.6457441151142 1431.8243396282196 1434.1011774539948 947.8113633394241 1437.0060098171234 773.3411994576454 750.8204002678394 1273.0905842781067 938.2641297578812 1435.8887803554535 780.9965704381466 935.5677497386932 1052.2477757930756 1340.857533812523 1080.7818752527237 1059.1348838806152 1398.8969159126282 1343.7654507160187 661.5536588523537 1018.9697650074959 1016.2369740009308 794.8134225606918 791.8044310808182 1195.8277654647827 721.8969725817442 833.7237593531609 1374.4186294078827 1467.533392906189 827.6108038425446 973.0180037021637 1112.391574382782 1287.4307018518448 1113.1517571210861 969.5387762784958 1216.8459129333496 929.8774656653404 1433.322800397873 771.4552265405655 986.2496089935303 1298.3584237098694 1061.0500705242157 1415.177298784256 1295.7600337266922 1195.25994181633 1223.051382303238 967.4935919046402 775.0689667463303 991.0660740733147 1429.4046294689178 1015.7771763205528 1439.3694829940796 1431.2070739269257 995.9662240743637 1383.2748365402222 1395.224032998085 1157.630382180214 872.1757513284683 1104.2012703418732 1143.1395244598389 1434.4611299037933 1006.5627825260162 )
set w1_array = ( 1172.3788928985596 1184.2934799194336 1170.4848957061768 1290.0872421264648 1171.4959812164307 1235.828275680542 1276.006669998169 1151.0900688171387 1172.71897315979 1173.2530307769775 1252.1000576019287 1183.2136821746826 1184.3930912017822 1258.0401134490967 1292.8432655334473 1068.472499847412 1148.1388759613037 1176.2880039215088 1283.6475086212158 1172.5017261505127 1195.8875370025635 1249.7457695007324 1168.2079982757568 1270.371789932251 1169.7331619262695 1272.4218559265137 1211.6786670684814 1157.4138355255127 1173.3679485321045 1176.2815189361572 1172.5023937225342 1288.2546138763428 1233.9070987701416 1277.0137977600098 1123.5949230194092 1201.4980506896973 1172.2852420806885 1227.7114582061768 1242.5244045257568 1258.3018970489502 1011.4813518524169 1164.6290493011475 1201.0097694396973 1173.3295631408691 1171.5072345733643 1196.9792556762695 1123.8626194000244 1233.1882667541504 1171.3546466827393 1277.663631439209 1293.6960411071777 1275.6466579437256 1099.6172142028809 1172.771520614624 1290.200777053833 1172.8438091278076 1172.5035381317139 1293.592758178711 1104.1548442840576 1175.056619644165 1188.3053493499756 1175.7385921478271 1122.991008758545 1209.380693435669 1172.842664718628 1178.0790996551514 1151.2498092651367 1265.2699661254883 1241.7315196990967 1168.6870288848877 1281.3525390625 1121.5289306640625 1165.3931331634521 1182.9356861114502 1237.2779083251953 1284.800214767456 1172.5834560394287 1171.4173984527588 1270.9607791900635 1162.4829959869385 1197.4415016174316 1038.7183856964111 1169.2059230804443 1150.8290004730225 1208.5467529296875 1138.0145263671875 1172.0389080047607 1159.404535293579 1189.1870212554932 1143.5721111297607 1263.3949947357178 1182.6177310943604 1232.7824306488037 1124.999589920044 1172.1299362182617 1163.7053680419922 1142.4331855773926 1164.8848724365234 1166.924638748169 1267.8299617767334 1171.8649578094482 1057.6254558563232 1268.9534378051758 1009.714479446411 1291.1719036102295 1293.4545230865479 1173.025770187378 1293.2903957366943 1126.8488121032715 1109.0336990356445 1189.4262027740479 1172.518081665039 1293.6055850982666 1131.1027240753174 1171.450777053833 1172.3366451263428 1206.1517906188965 1172.4384498596191 1171.3880252838135 1230.7086181640625 1207.0653629302979 941.9897270202636 1172.918815612793 1172.7065753936768 1140.9160327911377 1138.8665866851807 1177.8822612762451 1076.187391281128 1155.5504989624023 1218.4824657440186 1228.6113452911377 1154.3798637390137 1171.4209747314453 1172.8290748596191 1192.3419666290283 1172.2712230682373 1173.2985210418701 1180.6177806854248 1171.2277126312256 1246.813554763794 1125.8903217315674 1173.2369136810303 1194.6699810028076 1172.3566722869873 1241.7265129089355 1194.1760730743408 1178.064603805542 1181.3712787628174 1172.2802352905273 1127.1886539459229 1172.7862071990967 1285.5349254608154 1172.4902820587158 1290.3585147857666 1290.0825214385986 1171.559591293335 1222.320909500122 1228.4592819213867 1174.92262840271 1166.5214729309082 1172.3511409759521 1174.0735721588135 1293.6101150512695 1173.031873703003 )
set r_array = ( 6.5761886286735535e-06 6.657751922607422e-06 6.602121343016624e-06 4.4657667848467825e-06 6.573256750702857e-06 6.44772668659687e-06 3.995866117179394e-06 6.620370646119117e-06 6.5895458060503e-06 6.58389774441719e-06 3.5403281758725643e-06 6.653737996816634e-06 6.657997344732284e-06 6.141239603161812e-06 4.6644183370471e-06 6.5632380294799804e-06 6.62012142419815e-06 6.615292330384254e-06 4.207306665480137e-06 6.571832944750785e-06 6.676235471963882e-06 6.269516249299049e-06 6.610302527546882e-06 5.898596693873405e-06 6.596153427958488e-06 5.851883341670036e-06 6.637810145616531e-06 6.610636909604072e-06 6.586272169947624e-06 6.616360073089599e-06 6.578146417737007e-06 4.377385539114475e-06 3.2642252958565947e-06 5.7419735687971114e-06 6.612079714536666e-06 6.669853155612945e-06 6.577676584124565e-06 6.528833557963371e-06 3.394138843864202e-06 6.136884589791298e-06 6.5090542781352996e-06 6.605950643420219e-06 6.67071369767189e-06 6.5778788673877715e-06 6.573808391690254e-06 6.676706199645996e-06 6.6146320599317545e-06 6.475787733793258e-06 6.569804747700691e-06 5.723466773629188e-06 4.914736946225166e-06 5.778205518722533e-06 6.599195500016212e-06 6.572812845110893e-06 4.473895219266414e-06 6.583600242733955e-06 6.5922548371553415e-06 4.94969104707241e-06 6.599547763466834e-06 6.608293552994728e-06 6.669401203393936e-06 6.611440678238869e-06 6.615798150300979e-06 6.647645806074142e-06 6.573185672163963e-06 6.627667595744132e-06 6.623693456053733e-06 3.7675968307256695e-06 3.382323433756828e-06 6.599352856278419e-06 5.615343351960182e-06 6.606816549897193e-06 6.605264221429824e-06 6.652461265325546e-06 6.432105501294136e-06 5.50311078608036e-06 6.571905811429024e-06 6.572140057682991e-06 5.887223010063171e-06 6.612960149645805e-06 6.675850574970245e-06 6.5445837128162376e-06 6.606178854703903e-06 6.622366209626197e-06 6.649913166761398e-06 6.614564557671547e-06 6.58172806084156e-06 6.615039755702018e-06 6.671360110044479e-06 6.623334040045738e-06 6.043921684026718e-06 6.651512657403945e-06 3.245960234776139e-06 6.608798255324363e-06 6.572444041371345e-06 6.598147203326225e-06 6.610195239186286e-06 6.615374808311462e-06 6.594046105742454e-06 5.956962232589721e-06 6.573592473864555e-06 6.565794845223427e-06 5.933105548024177e-06 6.5164824324846265e-06 4.528207493126392e-06 4.744716857671737e-06 6.589480985999107e-06 5.012986485958099e-06 6.609656338691711e-06 6.6076082485914225e-06 6.671745007038116e-06 6.591628541350364e-06 4.931741927862167e-06 6.605147768855094e-06 6.588759471774101e-06 6.571969290375709e-06 6.659418021440506e-06 6.57542934000492e-06 6.570984919667244e-06 6.4970681565999985e-06 6.656584267616271e-06 6.433587421774864e-06 6.5733144181966775e-06 6.573119958043098e-06 6.622817267775535e-06 6.618560155034065e-06 6.628956397175789e-06 6.5825930732488626e-06 6.611299862265587e-06 6.596658577322959e-06 3.1468824791908263e-06 6.61677134513855e-06 6.575987239480018e-06 6.5843257802724834e-06 6.675722275972366e-06 6.584547733068466e-06 6.583143373131752e-06 6.641679679155349e-06 6.590580021142959e-06 3.4584492194652554e-06 6.613067885041237e-06 6.578867037892341e-06 6.676354830265045e-06 6.572591115832328e-06 6.375731726288795e-06 6.676986043453216e-06 6.628221471905708e-06 6.645757977962493e-06 6.580363934040069e-06 6.602937628626823e-06 6.576680590510368e-06 4.271459070146083e-06 6.572662194371223e-06 5.258925383090972e-06 4.4646930071711535e-06 6.5721934783458704e-06 6.572687004804611e-06 6.520628680586815e-06 6.605323230028152e-06 6.6133119660615914e-06 6.581563999056816e-06 6.597676028609275e-06 4.778362040519714e-06 6.57494117796421e-06 )
set i = 164
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w0_array[$&index]
    alter @mn1[w] = $w1_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn1[cgd]
    let cdb = abs(@mn1[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    print bw cgd cdb
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w0-test.csv $w0_array[$&index]
    wrdata ../out/w1-test.csv $w1_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
	let index = index + 1
end

.endc

.end
