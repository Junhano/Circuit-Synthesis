nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1153.5310029983518 940.3617757558821 1068.7887823581693 1382.1644890308378 1429.6411937475202 865.1992604136466 1270.012683868408 1355.0924015045164 1378.5029780864713 1436.2501883506773 823.5369209945202 1437.6028478145597 760.5785928666592 924.8403275012969 858.4474900364875 729.6100525557995 1441.3235270977018 785.8094368875027 1431.389578580856 793.6201275885105 795.846855789423 751.3969133794308 901.0230675339698 969.9212834239005 824.3598605692387 1431.1127340793607 1215.635001659393 1120.7681679725645 1105.1990288496015 1022.6882857084273 951.7348852753638 1260.6666588783262 728.2512833178043 1056.1637628078458 941.6719883680342 1097.1016240119932 1434.8378658294675 1380.9835958480833 932.1317616105079 876.6040813922881 1265.5352830886839 1432.026479244232 924.4433405995368 1058.023211956024 1349.009836912155 1431.8826645612714 1431.7209410667417 1442.3516511917112 977.254323363304 660.2573727443814 993.2152301073073 1135.32644867897 1361.7395389080045 878.2502079010009 914.9975061416625 1240.8507072925565 1202.528620958328 1422.7168655395506 1429.1234707832334 1364.6055424213407 1395.9530371427534 1370.6619364023206 1191.9677650928495 1187.529249191284 1348.775736093521 1415.3209221363065 1358.7962603569028 650.3493072837591 903.0328369140624 1434.6783685684202 1272.8955078124998 1429.323238134384 1429.3270969390867 1164.8228549957273 1251.6983020305631 1017.9107391834258 1091.7641055583952 1329.1683578491209 1093.5848677158353 789.8888365924358 1071.1452752351759 1128.3541327714918 847.1162089705466 1415.375192761421 831.1925545334815 1439.7051048278806 1059.7697663307188 1431.8605506420133 1440.2594369649885 1350.0888180732725 1286.5540933609007 1440.424128770828 1325.7192295789716 1040.4595160484312 783.3595411479473 1436.5444964170454 1404.1867864131925 897.6607871055602 978.6673879623412 1430.5408394336698 667.982613183558 1430.0271236896513 1067.1619004011152 738.187185972929 733.9505152404308 858.6634099483489 1436.6536808013914 759.3531255424023 1290.7758730649946 1277.4486994743345 1093.1121641397474 1432.1895879507063 1431.9319880008695 1004.1218942403792 1439.0116083621976 1233.7912714481351 699.0094220638275 871.7348140478133 820.2834539115429 1434.7331833839414 1430.323707461357 856.3972032070159 1356.549743413925 770.8309917151928 1168.9489066600797 1431.5749001502988 1432.244848012924 792.1481296420097 688.3190179616213 705.4702175408602 1414.2590582370756 1068.7035423517225 1431.1560219526289 1103.3263707160947 1282.5569653511045 1333.6638653278349 1043.3778113126752 1431.8123155832288 690.2848748862743 1422.1366596221922 1361.1198544502256 1172.7212345600126 843.1379544734954 858.784121274948 1183.1957620382307 1194.8655295372007 1431.8463027477262 1431.7436486482618 936.1022984981536 1429.8219144344328 1112.541888952255 969.7376686334609 1146.7761653661726 1242.726284265518 1279.642182588577 1145.389617681503 1407.054076194763 1178.736319541931 1159.9873769283292 728.276142925024 1345.7015550136564 748.1564821302891 1431.7354857921598 1128.8917434215543 997.9614114761351 1431.36355638504 1440.5657172203062 1293.434490561485 1432.041320800781 909.9080890417098 1256.9770479202268 992.3962730169295 1431.760666966438 1280.8735370635984 843.0374771356582 1096.836355924606 1377.918270230293 974.5692136883735 1183.429021835327 1430.4508996009824 1430.9775769710538 1412.01323390007 1051.5961253643034 984.3029248714446 936.373107433319 1388.0267059803007 1429.6077507734296 691.9000443816185 1165.7075601816175 933.5431194305419 937.2836863994597 1298.163158893585 627.534732054919 1431.8786573410032 1317.6393377780912 1191.4016091823576 1087.6113390922544 815.8115321397781 1065.2422934770582 984.2906805872916 1432.0226204395292 1122.5985771417616 779.5367148518562 1330.9305948019025 1429.3494582176206 823.1499026715755 1429.9149215221403 902.838560938835 770.4060161113739 1206.0900998115537 840.9625780582427 853.9625200629233 969.8940491676329 896.281140744686 1124.8508822917936 1165.9465092420576 1435.3612780570982 1162.3759275674818 983.0425798892974 1431.1268830299375 787.896468937397 869.451885819435 916.6246849298476 1380.9276431798933 927.8101229667662 1430.2942222356794 993.1146043539046 690.3048615157604 1366.536132097244 1440.1669740676878 1443.986003398895 1116.152740716934 1302.1461379528043 1286.0343420505521 1438.2455861568449 1442.3771786689756 928.6124822497367 1220.3075689077375 701.4926370978355 1431.5221136808393 1017.733283638954 955.6815767288207 1435.7638800144193 943.6691671609877 1001.1761915683745 1406.2350201606748 1429.7897577285764 883.7267917394637 1432.3288512229917 1003.0400931835173 638.2231031730771 1441.439736485481 731.5024004876614 944.7390949726104 1333.8900506496427 1143.8341730833051 1431.8878591060636 654.4003998115659 1366.9768273830412 1123.3937382698057 1320.6734466552732 1013.168515563011 1367.7118307352064 821.8582667410374 942.6860624551772 1431.0775101184843 1279.4961416721342 1432.002930641174 1436.9318610429762 1228.590443730354 1109.618745446205 1431.87920153141 732.6218248903751 1175.5206984281538 1250.592556595802 1432.0629894733427 1429.5765340328214 1129.4729882478712 1432.664666175842 1431.5729707479475 677.7578900009394 1431.4824867248533 1203.7294512987135 739.8419576883316 1317.7092415094373 777.3641954362392 1425.025815963745 1324.5369017124174 732.898285984993 1194.3259894847868 716.4410157501698 1054.7198772430418 1159.1608011722562 977.6039162278174 1406.806420087814 1149.6304935216901 916.3470736145972 1005.4164984822272 1076.6277956962583 981.4800113439559 716.5451911091805 876.9401931762694 1431.7622005939481 743.3731350302696 1432.3008501529691 1430.3540337085722 1406.2020224332807 1205.0859200954435 1429.4471651315687 1316.081666946411 1391.475290060043 741.4202953875065 1438.2372748851774 1432.0690250396726 1115.2144575119016 1437.7960848808286 1340.2927970886228 950.1198023557662 1320.3034466505048 889.5308792591094 )
set r_array = ( 6.466749243736267e-06 6.468333892822265e-06 6.463667278289794e-06 6.476134614944457e-06 5.285961227416992e-06 6.437162547111511e-06 6.468599109649658e-06 6.470142130851745e-06 6.476659898757934e-06 5.8203143405914305e-06 6.394570140838622e-06 6.352194671630859e-06 6.275445084571838e-06 6.471172313690185e-06 6.428666596412658e-06 6.327982263565063e-06 6.229281692504882e-06 6.351135950088501e-06 4.747510986328125e-06 6.351061706542968e-06 6.348287014961242e-06 6.328226022720337e-06 6.456694393157959e-06 6.472194128036498e-06 6.3978583145141595e-06 5.435427646636962e-06 6.470047073364257e-06 6.465165452957153e-06 6.457824139595031e-06 6.473921470642089e-06 6.4760067272186275e-06 6.471810894012451e-06 6.3366987991333e-06 6.468009023666381e-06 6.46924241065979e-06 6.474021248817443e-06 3.4363177227973936e-06 6.479393606185913e-06 6.4759153175354e-06 6.4464114475250236e-06 6.471840505599975e-06 4.513920514583588e-06 6.470694236755371e-06 6.4768658924102775e-06 6.469937210083007e-06 3.8644326138496395e-06 3.889114301204681e-06 6.221732239723205e-06 6.475145416259765e-06 6.2525435256958e-06 6.4735712814331045e-06 6.467404346466064e-06 6.48497817993164e-06 6.444788389205932e-06 6.463955240249633e-06 6.4468736457824705e-06 6.441636686325072e-06 6.452713994979858e-06 5.164550285339355e-06 6.4738328504562375e-06 6.483540515899658e-06 6.4884616184234615e-06 6.4699178981781e-06 6.469369440078735e-06 6.47029426574707e-06 6.458604340553283e-06 6.4792348194122305e-06 6.232456140518188e-06 6.465007739067077e-06 6.209003763198852e-06 6.471728496551513e-06 5.212871031761169e-06 5.068555312156677e-06 6.468190340995788e-06 6.46166742324829e-06 6.475532083511352e-06 6.470831995010375e-06 6.46472363948822e-06 6.463289623260497e-06 6.3524980831146236e-06 6.467456703186034e-06 6.47087426662445e-06 6.4320978927612295e-06 6.4657143402099605e-06 6.4079994249343865e-06 6.325059299468993e-06 6.467532448768615e-06 4.2504887509346e-06 5.894307689666748e-06 6.4697947311401364e-06 6.471971826553344e-06 5.9527867126464836e-06 6.462920122146606e-06 6.469699029922485e-06 6.325246839523315e-06 5.749989395141601e-06 6.475139837265014e-06 6.463148646354674e-06 6.47248080253601e-06 4.8983524131774894e-06 6.221934585571288e-06 5.341064314842224e-06 6.466707186698913e-06 6.236218099594116e-06 6.2830971050262445e-06 6.457492189407348e-06 5.888602309226989e-06 6.3314680624008175e-06 6.446608428955078e-06 6.4718611049652095e-06 6.466037492752074e-06 3.7537384378910064e-06 4.388857262134552e-06 6.479987125396728e-06 6.273263483047485e-06 6.470284395217895e-06 6.201613955497741e-06 6.460762124061584e-06 6.3868732738494865e-06 6.399008445739745e-06 6.382158594131469e-06 6.435784749984741e-06 6.472230176925659e-06 6.3000834274291985e-06 6.4639700460433954e-06 4.704332571029663e-06 6.374379973411559e-06 6.340920166969299e-06 6.212156324386596e-06 6.23737338066101e-06 6.4663220214843745e-06 6.467086343765258e-06 6.420150904655456e-06 6.47172806739807e-06 6.467633943557739e-06 6.46771162033081e-06 6.469771127700805e-06 4.208388154506683e-06 6.173105506896972e-06 6.40636113166809e-06 6.4775782871246334e-06 6.470184187889098e-06 6.448432331085204e-06 6.430712585449218e-06 6.469624786376952e-06 6.442695407867431e-06 4.217593710422516e-06 3.964671270847321e-06 6.474524860382079e-06 5.414968614578246e-06 6.456578307151794e-06 6.4724971103668205e-06 6.469686584472656e-06 6.4586642074584955e-06 6.459400205612182e-06 6.469397335052489e-06 6.476084833145141e-06 6.46262186050415e-06 6.462606410980224e-06 6.2738548564910884e-06 6.470940785408019e-06 6.297703771591186e-06 4.640902082920074e-06 6.4716405200958244e-06 6.4751063632965085e-06 4.710838751792907e-06 5.9820781517028806e-06 6.456531100273131e-06 5.510189394950866e-06 6.476367645263671e-06 6.471617345809936e-06 6.475953512191772e-06 4.536332194805145e-06 6.472152500152588e-06 6.440504150390624e-06 6.473252205848694e-06 6.4737931537628165e-06 6.480611114501952e-06 6.468209438323974e-06 5.484636096954345e-06 4.83412745475769e-06 6.4706796455383296e-06 6.469627790451049e-06 6.472618131637573e-06 6.4722413349151605e-06 6.483191614151e-06 5.273260431289673e-06 6.287421684265136e-06 6.466361074447631e-06 6.478076105117798e-06 6.476543169021606e-06 6.467704110145568e-06 6.302833442687988e-06 5.494454269409179e-06 6.4597538280487054e-06 6.465263299942016e-06 6.465038423538207e-06 6.394865612983703e-06 6.467445330619811e-06 6.479864816665649e-06 4.413197879791259e-06 6.464203720092773e-06 6.3163672256469725e-06 6.466391544342041e-06 5.239053468704223e-06 6.391306858062743e-06 4.992054634094238e-06 6.472226743698119e-06 6.347427206039428e-06 6.468126826286315e-06 6.4134919452667235e-06 6.425263195037841e-06 6.477336244583129e-06 6.4602967071533196e-06 6.466205291748046e-06 6.467422370910644e-06 6.3344588327407835e-06 6.464079694747924e-06 6.47732551574707e-06 5.59345567703247e-06 6.396467857360839e-06 6.456481103897094e-06 6.463754611015319e-06 6.482168083190918e-06 6.466741304397582e-06 5.3654960203170776e-06 6.473713116645813e-06 6.243575720787048e-06 6.47771819114685e-06 6.109319143295287e-06 6.134161763191223e-06 6.464886503219604e-06 6.471233253479003e-06 6.456106238365173e-06 6.040953283309936e-06 6.14374111175537e-06 6.465530018806457e-06 6.466999225616455e-06 6.257388668060302e-06 4.645935623645782e-06 6.476688652038574e-06 6.471367578506469e-06 5.691031007766723e-06 6.47898076057434e-06 6.472530584335326e-06 6.474481945037841e-06 5.316448502540588e-06 6.450574235916137e-06 3.72205709695816e-06 6.47465103149414e-06 6.274010639190674e-06 5.95373514175415e-06 6.2891408729553215e-06 6.4693016338348386e-06 6.466596250534057e-06 6.460724573135375e-06 4.255788581371307e-06 6.175781278610229e-06 6.47626293182373e-06 6.472183828353881e-06 6.466421155929565e-06 6.473600678443908e-06 6.472779493331908e-06 6.423873596191406e-06 6.473698740005493e-06 4.758655242919922e-06 6.466395621299743e-06 4.341103212833404e-06 6.2418655443191525e-06 6.469412355422973e-06 6.472554187774658e-06 4.3748215842247004e-06 6.230095796585082e-06 6.46170518875122e-06 6.471531944274902e-06 4.514442901611327e-06 5.040087847709655e-06 6.467366151809692e-06 3.6604355442523954e-06 3.983058564662933e-06 6.245989065170287e-06 4.698182158470153e-06 6.466578655242919e-06 6.2750204372406e-06 6.470206718444824e-06 6.384975986480712e-06 6.434989528656005e-06 6.469617490768432e-06 6.311601047515868e-06 6.469013242721557e-06 6.2893726158142085e-06 6.468769054412841e-06 6.4697509574890135e-06 6.473963527679443e-06 6.475093917846679e-06 6.462130694389343e-06 6.462572078704833e-06 6.472333602905273e-06 6.46705608844757e-06 6.473239545822143e-06 6.232847099304199e-06 6.463109807968139e-06 4.141707365512848e-06 6.273461751937865e-06 6.4173547554016106e-06 4.878207950592041e-06 6.4762723731994625e-06 6.458259086608886e-06 5.23108151435852e-06 6.460396699905395e-06 6.4760135936737054e-06 6.262332515716552e-06 5.883681421279907e-06 3.7860051441192625e-06 6.465244417190551e-06 3.2713129985332486e-06 6.469209794998169e-06 6.4707320022583006e-06 6.47038610458374e-06 6.4707727718353265e-06 )
set i = 320
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

