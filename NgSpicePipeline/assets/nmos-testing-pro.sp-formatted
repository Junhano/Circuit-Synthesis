nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1365.8511769771576 1081.11870855093 1260.0770351290703 1411.7591780424118 781.7717403918505 1345.6020814180374 1193.7704500555992 1080.5753868818283 1406.062291264534 1436.2671208381653 950.1849722862244 704.4173196703196 1432.122356891632 999.0262416005135 1075.5998802185059 928.2520663738251 970.1026853919029 857.5789925456047 1286.053406894207 973.9871722459793 1183.1692111492157 1044.7092232108116 1267.789016366005 1417.7360606193542 730.5108480900526 771.3410609215498 1414.8994189500809 1082.690156698227 1132.6944363117218 1030.2308243513107 1409.284062385559 1419.6894419193268 1394.7134625911713 1415.3662753105164 959.2572492361069 1428.1856966018677 1436.1242216825485 1422.542507648468 1015.5251440405846 1278.1841677427292 1020.3280997276306 1428.222085237503 856.5134939551353 1221.945236325264 1414.0639555454254 808.0037669092417 1435.3586834669113 1406.5746825933456 1418.7912327051163 1009.8591876029968 707.156892195344 932.0370745658875 1254.1207563877106 765.0305830687284 682.8569792956114 1243.5240414738655 1406.449584364891 1436.194048523903 1085.83531498909 1121.2154936790466 1271.2035980820656 1268.9290624856949 1435.017220377922 1181.2173050642014 783.7804176658392 680.6684733182192 1194.914774298668 1061.3820534944534 1416.218752861023 916.6434523463249 961.5093123912811 899.7625675797462 1432.8802239894867 1066.8260392546654 953.9026615023613 893.2866689562798 979.9495977163315 953.5295796394348 1432.168088555336 787.1501282602549 1153.42464864254 1343.9098131656647 777.0278916507959 1436.3796305656433 )
set r_array = ( 6.563417737483978e-06 6.520168905258178e-06 6.670499567985534e-06 3.2098860043287276e-06 6.3736431795358655e-06 6.6190047311782835e-06 6.633756433725356e-06 6.518545945286751e-06 3.4696723642945287e-06 5.448476647138595e-06 6.368927632570266e-06 6.415002842545509e-06 5.872810830473899e-06 6.421145995259285e-06 6.5181364613771435e-06 6.391904776096343e-06 6.391868342757225e-06 6.298747633695602e-06 6.673831765651702e-06 6.427745570540428e-06 6.625302334427833e-06 6.488661890029907e-06 6.671344910860062e-06 4.280690004229545e-06 6.3810203719139094e-06 6.335107659101486e-06 6.240577225685119e-06 6.523127158284187e-06 6.576689754724502e-06 6.459825684428215e-06 3.8888988393545145e-06 4.375791971683502e-06 6.4252564805746075e-06 4.177253966331482e-06 6.401405830979347e-06 4.751945187449455e-06 5.372920607328415e-06 4.472185422778129e-06 6.457117323875427e-06 6.672341351509094e-06 6.4719584333896635e-06 5.998705451488494e-06 6.31542605638504e-06 6.654310648441314e-06 4.101432611346244e-06 6.297259231209755e-06 5.25620785832405e-06 3.410659183859825e-06 6.18410175025463e-06 6.447401692271232e-06 6.440139387845993e-06 6.348671813607215e-06 6.675838505029678e-06 6.296623324155807e-06 6.49684150993824e-06 6.664987181425094e-06 3.4406334283947943e-06 2.863017485355958e-06 6.536932488083839e-06 6.5651417273283e-06 6.6786128032207485e-06 6.675746862888335e-06 5.717543115019798e-06 6.623148073554039e-06 6.32521053135395e-06 6.516474832892417e-06 6.636867796182632e-06 6.5020563948154445e-06 3.1081263470649716e-06 6.350122888684273e-06 6.380808253884315e-06 6.319328223466873e-06 5.0181450444459914e-06 6.510378618836402e-06 6.386841659545898e-06 6.362248485088348e-06 6.4045028883218765e-06 6.38272312760353e-06 5.87972154200077e-06 6.3623707491159435e-06 6.60470386326313e-06 6.618356977701187e-06 6.340130766034126e-06 5.489423920512199e-06 )
set i = 84
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

