nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 863.7993800640105 1429.7084754705427 1440.0568991899488 715.3398897498846 960.1469558477401 742.8989101946354 701.6549295186996 1254.1481977701185 953.0668160319327 737.6900309324265 1435.3484153747556 1437.967653274536 1330.4540324211118 1316.4589393138883 1230.2940070629118 1340.6465703248975 1361.6120004653928 1136.8378633260725 1353.2857388257978 907.203116416931 1413.5258358716962 1434.2302525043485 1411.6812282800672 1431.0802310705183 1432.96194255352 748.1277018785477 834.4030305743216 1302.7013605833051 1366.6619884967802 1387.8784388303754 638.0791663564742 703.9884983748198 1005.2269965410231 671.9292644411325 1434.5014077425 763.4313626587391 744.3131744861603 1416.9838196039198 1405.7695394754408 712.4378088861704 1307.2300142049787 904.0527981519698 1268.3948057889936 991.7018365859984 1037.7085345983503 1266.017732620239 768.9545984566212 1433.4580957889555 1434.0571999549863 1206.7620265483854 947.0141571760176 1409.163011908531 813.7423099577427 960.0278770923613 1435.8647036552427 808.9163552224636 752.7299572527409 736.6279691457748 1029.5414733886716 1063.0435663461683 735.6551422178745 1331.5311336517332 821.9812414050102 1403.2535493373869 727.2855679690838 1422.6383042335508 1076.7633980512617 1120.044295787811 1434.12784576416 713.7184373289347 1407.8714007139204 814.9344332516193 1330.967599749565 877.5196570158004 841.0590481758117 1044.025595784187 1413.029781579971 1000.8373340964316 1432.0633357763288 1431.073206067085 838.2187205553054 1433.6492055654523 689.0103933215141 1293.0982303619382 921.9589629769324 1169.2106622457502 1442.5465703010557 1435.0255620479581 862.0910921692847 1012.7342516183852 1215.7956367731092 1301.4085620641706 1433.7541353702543 865.6844556331633 1154.406308531761 925.6694757938384 1295.136322379112 1312.2614997625349 758.5337603092194 745.9389433264732 1192.202904820442 955.79175055027 783.337080925703 1442.0980089902876 1430.1302725076673 799.0779863297939 722.5767935067415 1411.5654146671293 869.5285671949385 1430.952197909355 830.1484015583991 1381.2180429697034 1010.9744882583617 898.4210211038588 1396.3169026374815 1168.4370213747022 1042.2200709581373 1065.1262325048444 1014.7576504945754 1088.569658398628 1062.0752042531965 1102.4192053079603 706.8468770384789 1261.8387955427168 778.7168425321579 782.6938726007938 823.6893685162067 1444.1672682762144 1067.9881793260572 1254.7452241182325 1412.8226429224012 742.150846272707 698.8376743346453 1443.0529147386549 1433.245317339897 1441.922433376312 1439.3880397081373 1425.6575715541837 1433.2343345880506 1195.2150481939314 987.589092850685 949.026424884796 1050.1154822111127 1248.2263177633283 1440.4109692573545 1428.7212646007536 1224.8245471715925 967.9573249816893 1058.749706149101 1016.882812976837 922.8305333852767 1417.0869189500806 938.2352775335311 1438.6200881004331 1311.5697842836378 1152.135599851608 1436.8261891603468 1382.2281593084333 1415.4836350679395 652.5149903073907 1330.2956730127332 636.9450488127768 722.3717883229256 1439.80320751667 1423.6939841508863 734.0064308047295 1435.653359889984 1419.4462317228315 1325.5112993717191 915.6468737125396 840.7537326216697 1381.9165855646131 1064.3360680341718 970.2243727445601 1127.0172053575513 1427.9806214570997 1366.764147877693 1084.2233580350874 1417.0089513063429 1208.7190836668012 905.2927854657172 1208.0677372217176 1001.2220519781112 828.5870450735092 1443.7424534559248 639.0914981067181 674.1927131265402 829.2537772655487 1341.37771487236 1294.2714554071424 883.2857006788253 676.8070780485868 1109.1248184442518 1133.3722114562986 1125.777094364166 1433.5058856010435 1391.1550587415693 648.0172287672758 784.5758438110352 1185.6171125173566 1433.767047524452 1097.061007618904 930.6813210248946 1434.420620203018 1028.6377710103986 1121.739795207977 950.6149661540984 990.6200355291365 1286.9233018159864 706.1989503353834 1421.2768882513044 1433.301319479942 1432.452036142349 1183.141738772392 1433.260158896446 1233.34666788578 877.3606050014495 1331.9531780481336 1435.6704276800153 745.8262588083744 1078.8581353425977 709.1648375242949 1411.5163880586622 1274.1360145807264 1152.1504908800123 1437.357665300369 1171.5102624893186 1007.0901313424109 1439.2954778671262 728.589448183775 768.8077041506767 740.8643183112144 1123.2757478952406 779.3699823319912 974.2618203163146 956.4736458659171 1300.2341496944425 1417.5408726930616 1442.422049641609 1215.4017418622968 788.8447454571724 1432.1167159080503 1183.754200339317 872.262480854988 1263.5595256090162 1258.3774971961973 1002.6702910661696 965.7284694910048 748.1099785864353 735.1232950389385 965.4879868030547 872.4532938003539 1433.765810728073 786.3761864602566 1420.9101039171217 1140.3125685453413 1294.4882410764692 788.6693553626537 943.9032679796218 1285.8774667978284 649.8326294124126 1420.9549254178999 1135.7136648893354 1433.9603835344312 1401.1146336793897 1434.0520054101942 697.2431593388319 1134.6347826719282 1244.4454312324522 793.8171492516994 836.7280840873717 1397.1703416109083 691.2609174847603 1173.419727683067 1436.523817181587 653.5104475170374 976.2753742933272 1432.7986854314802 1436.023904085159 934.853802025318 933.9103242754935 1110.904123187065 1422.2831457853315 1021.1653193831443 1167.1093451976774 1067.2930502891538 1148.2333093881605 1050.3682339191434 1281.2215715646742 1369.062709212303 1440.0952398777006 833.4322196245192 1237.0075356960294 1120.867210626602 932.8022536635398 1201.246854662895 1039.670984148979 1249.099644422531 1225.282903909683 1121.4596360921857 755.3478099405766 906.9541245698928 1142.192449569702 1437.8907245397565 1313.057848215103 660.8948948979378 1441.3681507110593 844.517452418804 1153.100053668022 755.7444876432419 1189.2650681734083 910.8519873023032 1272.608224749565 1443.5266572237012 1434.3136620521543 826.2898689508438 1393.5350012779234 1433.5316604375837 )
set r_array = ( 6.435324482917785e-06 6.41323917388916e-06 5.8486642169952385e-06 6.241735725402832e-06 6.459780650138854e-06 6.297188358306884e-06 6.231817774772644e-06 6.4553101587295525e-06 6.456571226119995e-06 6.290632610321044e-06 4.707308106422424e-06 5.792940573692321e-06 6.45963581085205e-06 6.450784091949462e-06 6.454140071868896e-06 6.465888791084289e-06 6.467112951278686e-06 6.444991164207458e-06 6.466049509048462e-06 6.4321983146667475e-06 3.299439500570297e-06 5.5023921060562125e-06 3.0427901852130887e-06 4.1088450479507445e-06 4.954247932434081e-06 6.313412933349608e-06 6.398583154678344e-06 6.461440830230712e-06 6.467378168106079e-06 6.468521862030029e-06 6.2384816694259635e-06 6.242366580963134e-06 6.463894300460815e-06 6.257273225784301e-06 5.502179675102233e-06 6.331756024360656e-06 6.25993140220642e-06 6.451982288360595e-06 6.462652330398559e-06 6.271798782348632e-06 6.46341257572174e-06 6.436354880332946e-06 6.4603728818893425e-06 6.465471010208129e-06 6.464908819198608e-06 6.462853174209594e-06 6.3300572204589834e-06 4.82872076511383e-06 4.545161705017089e-06 6.46133246898651e-06 6.4528820085525505e-06 6.461117677688598e-06 6.393713335990905e-06 6.4647772836685176e-06 5.6118219423294064e-06 6.336752228736877e-06 6.292774300575256e-06 6.270667533874511e-06 6.459487109184265e-06 6.463018612861632e-06 6.315307645797729e-06 6.458623652458191e-06 6.373353009223938e-06 6.465325956344604e-06 6.277647285461426e-06 6.440973000526428e-06 6.460556559562682e-06 6.449837164878844e-06 4.359133987426757e-06 6.231480460166931e-06 6.462239484786987e-06 6.3319639492034904e-06 6.461824922561645e-06 6.432861785888671e-06 6.374795608520507e-06 6.464472370147705e-06 6.457509355545043e-06 6.4615176486968984e-06 5.210845212936401e-06 4.1295244503021235e-06 6.410497527122497e-06 4.751882987022399e-06 6.259464054107666e-06 6.453192501068114e-06 6.458557133674621e-06 6.446319179534911e-06 6.060197381973266e-06 6.358631329536437e-06 6.42606807231903e-06 6.4638033199310295e-06 6.460469441413879e-06 6.464871912002563e-06 4.860277490615844e-06 6.437488489151e-06 6.4602344799041745e-06 6.461123256683349e-06 6.464072184562683e-06 6.465536456108093e-06 6.316944866180419e-06 6.276794986724853e-06 6.447603635787963e-06 6.464048151969909e-06 6.323196129798889e-06 5.95943000793457e-06 4.0877583789825435e-06 6.373245935440063e-06 6.258712606430053e-06 3.1012871253490445e-06 6.403125743865966e-06 4.1310608196258544e-06 6.397414140701293e-06 6.471817760467529e-06 6.460064964294433e-06 6.437268977165221e-06 6.468043785095215e-06 6.455541043281555e-06 6.458517866134643e-06 6.452869992256164e-06 6.462273817062377e-06 6.4611219692230215e-06 6.45929720878601e-06 6.44811819076538e-06 6.238375024795532e-06 6.45468466758728e-06 6.349912004470825e-06 6.342821745872497e-06 6.3873213100433345e-06 6.113342027664184e-06 6.458644680976867e-06 6.463168816566467e-06 2.9525672855973244e-06 6.318676071166992e-06 6.236161880493163e-06 6.2589037942886344e-06 5.033995585441589e-06 5.992442207336425e-06 6.3288193273544306e-06 3.858442168235778e-06 5.287115006446838e-06 6.452026062011718e-06 6.465813689231872e-06 6.464012103080749e-06 6.458437399864196e-06 6.462843089103698e-06 5.949310140609741e-06 3.987175540924072e-06 6.4531109619140616e-06 6.462410717010497e-06 6.456105380058288e-06 6.4665310192108144e-06 6.447021703720092e-06 3.4695260989665984e-06 6.462269525527953e-06 6.297334055900573e-06 6.462433462142943e-06 6.456243352890014e-06 5.671498947143554e-06 6.467867403030395e-06 3.396400122642517e-06 6.2451120901107785e-06 6.46603835105896e-06 6.214078502655029e-06 6.21800311088562e-06 6.334450893402099e-06 3.7481751072406768e-06 6.252369074821472e-06 4.609442882537841e-06 2.7838166552782057e-06 6.456171684265136e-06 6.4589483070373526e-06 6.407788066864013e-06 6.469302492141723e-06 6.461635665893554e-06 6.464795951843261e-06 6.457787661552428e-06 3.968088941574097e-06 6.467334823608398e-06 6.458470659255981e-06 6.446507363319396e-06 6.458840589523315e-06 6.450480465888976e-06 6.4587461757659905e-06 6.462060098648071e-06 6.372290210723877e-06 6.058433990478515e-06 6.231437973976135e-06 6.246599321365356e-06 6.359880380630493e-06 6.466254215240478e-06 6.464582448005676e-06 6.434487204551696e-06 6.260839920043945e-06 6.4627503919601435e-06 6.457700972557067e-06 6.442549495697021e-06 5.225095252990722e-06 6.469984846115112e-06 6.211821584701537e-06 6.349375133514404e-06 6.448049526214599e-06 4.968302278518677e-06 6.448643045425414e-06 6.461972980499267e-06 4.6422132539749145e-06 6.46687777519226e-06 6.454594116210937e-06 6.460826497077941e-06 6.4658555316925044e-06 6.464141492843628e-06 6.285837249755859e-06 3.6579522478580474e-06 4.372912817001342e-06 4.2715980577468865e-06 6.452016191482543e-06 4.869276623725891e-06 6.4612691688537595e-06 6.442502717971801e-06 6.4646753597259515e-06 4.661666779518127e-06 6.295419602394104e-06 6.449652414321899e-06 6.24870002746582e-06 3.0972214329242705e-06 6.461853246688842e-06 6.454614715576171e-06 6.364891176223754e-06 6.4509257125854485e-06 6.461922340393066e-06 5.878036122322082e-06 6.244479303359985e-06 6.2759920406341546e-06 6.309254007339477e-06 6.4439618396759024e-06 6.342999629974364e-06 6.4652847576141356e-06 6.463805465698242e-06 6.458192567825317e-06 3.4957087504863735e-06 6.094357566833496e-06 6.455049877166747e-06 6.330766396522521e-06 5.300543646812439e-06 6.450629596710205e-06 6.431409316062926e-06 6.45993106842041e-06 6.460756330490112e-06 6.463040285110473e-06 6.464034419059753e-06 6.3037681388854975e-06 6.261503820419311e-06 6.465022544860839e-06 6.423919944763183e-06 4.713882308006286e-06 6.292027788162231e-06 3.6390779721736906e-06 6.4464367675781244e-06 6.463684659004211e-06 6.324842147827148e-06 6.46358359336853e-06 6.463743667602538e-06 6.204164199829101e-06 2.7606678771972654e-06 6.451072483062743e-06 4.55601306438446e-06 6.465995221138e-06 4.3957922744750974e-06 6.255307703018188e-06 6.452711420059204e-06 6.461997442245483e-06 6.373001961708068e-06 6.4066821384429925e-06 6.467672996520995e-06 6.234995012283325e-06 6.448122053146362e-06 5.6932282733917235e-06 6.238818769454956e-06 6.4643629360198965e-06 5.341858677864074e-06 5.619987015724181e-06 6.455148797035216e-06 6.459387545585631e-06 6.448844532966613e-06 3.6930729317665098e-06 6.465144853591919e-06 6.443420248031615e-06 6.453702335357666e-06 6.460591750144958e-06 6.4523067283630365e-06 6.4636110591888424e-06 6.467626218795776e-06 6.031671767234802e-06 6.3823856163024894e-06 6.460113458633422e-06 6.445427613258361e-06 6.461218743324279e-06 6.459304933547973e-06 6.453441195487975e-06 6.460649685859679e-06 6.460016040802001e-06 6.460996441841125e-06 6.2764413642883295e-06 6.440287427902221e-06 6.445006828308105e-06 6.28477123260498e-06 6.464600043296813e-06 6.229127197265624e-06 5.984676675796508e-06 6.405368928909301e-06 6.462050228118896e-06 6.318162589073181e-06 6.456940727233886e-06 6.452835874557495e-06 6.461172180175781e-06 6.082450275421142e-06 4.495886521339416e-06 6.360331206321716e-06 6.469515566825866e-06 5.446639065742492e-06 )
set i = 318
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

