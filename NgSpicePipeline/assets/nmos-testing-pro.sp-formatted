nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 905.7747569680214 1320.9051144123077 664.6351978927851 971.4893874526024 763.8095845282078 916.5974748134613 1351.2124222517014 905.4620851576328 906.3151282072067 1222.2867485880852 1091.5403154492378 1350.3177535533905 1015.1515212655067 622.2018074989319 665.2633567154408 883.4109161794186 752.0887189358473 1015.7629732787609 1362.487981915474 1156.5899682044983 1048.7982732057571 1210.243585407734 1435.0599032640457 741.1762957274914 960.6104147434235 719.7981689870358 917.5899994373322 708.3203081786633 1431.560644209385 938.6102636158466 872.4523064494133 1101.1537012457848 851.2790870666504 1242.5470066070557 1321.3976886868477 653.8872365653515 1396.7646506428719 741.9933312386274 654.306738525629 1426.5828263759613 1286.58586114645 795.7451362907887 1355.1963385939598 883.4555906057358 1322.905210852623 1344.5206505060196 1037.2527492046356 654.1307207942009 632.8157578408718 730.6387861073017 818.4961718320847 1278.907613158226 1122.5220915675163 675.8293379843235 883.5169595479965 632.5040203332901 927.5804501771927 1004.176167845726 1333.771791756153 1200.3851172327995 675.6488208472729 949.5974433422089 1385.7353043556213 873.0405730009079 1178.531430363655 1091.006926894188 708.2892303168774 1430.8426570892334 708.8147387653589 1014.9983939528465 1058.471208512783 730.351537168026 730.2450020611286 1058.1071746349335 1266.4327037334442 720.1481944695115 1267.800375521183 927.7039502561092 1166.623495221138 632.3406402766705 927.5986936688423 1200.395296216011 1436.8163925409317 1276.661057472229 )
set r_array = ( 4.381382254064083e-06 2.8512736112996936e-06 5.902356033325195e-06 5.501669322252273e-06 4.765068565607071e-06 3.251339991688728e-06 3.2082058797776697e-06 3.252293908149004e-06 2.8710658551380035e-06 6.232105915546417e-06 6.242107425928115e-06 6.556865547895431e-06 3.6170550557970997e-06 4.046151165962219e-06 6.660265599489211e-06 3.6330556619167327e-06 6.27189201593399e-06 3.2439782220125198e-06 6.19931322813034e-06 5.494103034138679e-06 6.611844574213027e-06 2.868534185104072e-06 4.311374363601207e-06 6.273229991197586e-06 5.876295243501663e-06 3.6441937583684917e-06 2.8708238556236025e-06 4.775049065351486e-06 3.1772659841179844e-06 4.0039574477076524e-06 3.634151009023189e-06 3.2353052991628646e-06 4.757734959125519e-06 3.2258573296666145e-06 5.848993261456489e-06 4.788483579754829e-06 4.709323545098304e-06 3.268941429555416e-06 4.037073229551315e-06 4.697827597260475e-06 3.2211591053009033e-06 6.266667519807815e-06 4.71887131512165e-06 6.258267064690589e-06 5.102077846527099e-06 5.098967154622078e-06 3.2418674911558627e-06 4.413925831317901e-06 4.418930609822273e-06 4.39444673538208e-06 4.013283488452435e-06 5.106435765624046e-06 3.233455524891615e-06 6.277591710090637e-06 5.880392541289329e-06 2.915915812477469e-06 5.877849583625793e-06 3.995234903991222e-06 4.72176854789257e-06 6.2346803891658775e-06 4.40765616774559e-06 5.127703671455383e-06 4.332237367630005e-06 4.756561939716339e-06 6.598939125537872e-06 5.49760912835598e-06 5.899463047385216e-06 6.51466054201126e-06 3.6458658921718596e-06 3.993351657986641e-06 5.499037628173828e-06 5.145646308660507e-06 5.520781402587891e-06 3.6093634861707686e-06 3.9664486545324326e-06 3.2712622109055518e-06 5.107271050214767e-06 4.379972753226757e-06 2.8742289059981704e-06 3.2879236462712288e-06 5.502737511992454e-06 4.346705314815044e-06 2.836313632428646e-06 2.8579856717213987e-06 )
set i = 84
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

