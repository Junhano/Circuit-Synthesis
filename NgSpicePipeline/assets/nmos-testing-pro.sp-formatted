nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1431.1209318041801 1361.1235556006432 1036.1519929766655 1039.9481636285782 1263.625222146511 1425.3324341773987 1431.0008493065834 1430.4093864560127 1195.1338437199593 873.9607383310795 866.4798249304295 1408.6532112956047 1021.4162182807922 1210.4757842421532 835.8834241330624 1076.919902563095 1424.3468430638313 1430.4106649756432 910.4095135629177 1363.7391117215157 1240.6879898905754 859.0189006924629 1273.3060744404793 1429.5133408904076 855.2662734687328 1161.4402782917023 1218.752723634243 1429.3643441796303 893.7108916044235 1301.3750877976418 1079.586451947689 1168.8550528883934 1221.3220563530922 1052.492358982563 1059.5350843667984 1431.0319271683693 1050.9932455420494 1311.9710651040077 1226.8503752350807 752.6849516481161 812.4472004175186 853.380776643753 667.7030918002129 1409.6286234259605 1422.3430094122887 1429.446169435978 1244.6281906962395 1065.3718215227127 723.4912589937449 894.0088358521461 805.4923486709595 1424.0835663676262 1381.7245391011238 1437.3010990023613 1431.4373162388802 1173.116899728775 754.7099423408508 677.5745787471533 1155.9466269612312 1295.7984802126884 974.7999911010265 1155.4562655091286 1071.2587651610374 1028.1419445574284 1430.8156606554985 1432.9649505019188 896.7294518649578 869.4835838675499 1431.5700855851173 1430.162927210331 1188.7509819865227 1195.0086471438408 1006.7174960672855 1431.0577926039696 1430.7552260160446 1147.9143765568733 915.1114170253277 656.2798938527703 877.7307730913162 1156.070840060711 1055.4123994708061 1430.2121010422707 1429.5229789614677 920.4279933869839 )
set r_array = ( 4.4697113084793085e-06 6.634756897687911e-06 6.63266209244728e-06 6.630078231096268e-06 6.634374682903289e-06 3.5697144019603727e-06 4.58089267194271e-06 5.308390011191368e-06 6.631367926597595e-06 6.622403760552406e-06 6.622911145091057e-06 6.63280737876892e-06 6.632503395080566e-06 6.6304993379116056e-06 6.623129298090934e-06 6.629858513474464e-06 6.642081116437912e-06 4.8422375071048735e-06 6.631540929079056e-06 6.630036656856537e-06 6.63299334526062e-06 6.628887330293655e-06 6.635944222211837e-06 4.694041770994663e-06 6.630484138727188e-06 6.63362679362297e-06 6.632337992191314e-06 5.112386246323585e-06 6.629557211995125e-06 6.635620568990707e-06 6.628858496546745e-06 6.6309351968765255e-06 6.630338405370712e-06 6.6291597980260844e-06 6.632176165580749e-06 4.8923411715030665e-06 6.6328234720230095e-06 6.630119358301162e-06 6.632650916576385e-06 6.622311000823974e-06 6.6228016215562815e-06 6.624523599743843e-06 6.62781422317028e-06 6.632485066652298e-06 3.2483735243976114e-06 4.517407019734382e-06 6.632247244119644e-06 6.629094977974891e-06 6.627146353125572e-06 6.630885128974914e-06 6.6238347190618515e-06 3.0508400063216685e-06 6.633902614116668e-06 6.465351034998893e-06 6.011169900298118e-06 6.63266745686531e-06 6.627680336236953e-06 6.627073039412498e-06 6.631246333122253e-06 6.632761334180831e-06 6.628461082577705e-06 6.633549009561538e-06 6.6309602308273315e-06 6.628422190546989e-06 4.098829527497291e-06 6.133080770373344e-06 6.623031397461891e-06 6.627582659125328e-06 5.168055494427681e-06 4.644696165919304e-06 6.630664740800857e-06 6.633432780504227e-06 6.627186139225959e-06 4.699552816450596e-06 4.480088328123092e-06 6.631038014888763e-06 6.622994517087936e-06 6.627952356934547e-06 6.625035007596015e-06 6.630544935464859e-06 6.631242756843567e-06 5.398269941210747e-06 3.949037429988384e-06 6.62999038875103e-06 )
set i = 84
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

