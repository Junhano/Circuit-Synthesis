nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 773.3500367403029 1325.3160834312437 1335.3378197550771 959.0102533996104 1110.0953078269956 1113.3131799101827 1292.0443561673162 1281.495719850063 1334.316250681877 1196.0805211961267 657.4975141882895 1145.5995514988897 1171.5558755397794 749.3796613812445 1238.848321586847 769.7043567895888 698.2623723149298 1356.0694459080694 1378.8509383797643 1012.536237426102 1340.3405869007108 1371.8971991539 1135.798026770353 1426.2914791703222 1419.1403967142103 697.7118495106696 1396.3914319872854 1315.1107570528982 713.5602077841758 886.739887446165 1152.971760779619 881.0728369653224 759.6430924534797 724.170881807804 1273.7069204449651 1131.8245092034338 1208.8650009036062 1036.7560344189403 806.0100445151328 1043.3841344341633 617.8761237859725 782.612528502941 938.8490130007266 1347.2825023531911 1166.3989293575285 712.9240491986274 1286.822478175163 648.769145309925 1108.5734051465986 1278.8396996259687 666.1491027474402 1289.5223304629324 1224.3070591986177 1021.2547258473932 1137.2877851128576 771.0058376193045 1424.5228603482244 1379.649908840656 811.7038345336913 940.4059912264346 1174.1681997478006 876.4192669093608 1079.0375790372489 1153.021207898855 1064.626879058778 1125.4455710947511 1003.4323431551455 1434.1249516606329 682.7381536364554 1170.8022460341451 1384.6847584843633 928.2418267428874 1062.8521009907124 1047.3806625977156 1147.6367530226705 636.9065859913825 1275.0784534215925 1370.1197001338003 635.5318620800971 738.4585019946097 1384.247922003269 1238.238754123449 946.4272725582122 1084.9939100071786 876.3303165137767 614.7758710384368 1248.893989920616 928.2235592603682 779.2380037903785 1400.6305268406866 1405.182432234287 1083.1808221712706 939.837745130062 1310.7880547642706 988.1910725682973 692.7240476012229 848.6508135497569 944.0139117836951 956.5998485684394 865.4559451341628 1300.0940701365469 1268.654137253761 1133.9226971566675 1415.8306059241293 1424.982750713825 799.8736545443534 672.6363965868949 688.209369778633 1169.0509423613546 677.5312903523444 811.4079186320304 1211.9941328465936 1143.2008220255373 764.5991334319114 1199.6759377419946 1038.359522372484 866.8772096931933 667.5089851021766 996.0074927285312 879.2136104404925 927.3837992548941 860.5247019231318 688.568807542324 971.6247230768203 855.5218358337878 1336.2579962611196 925.3951419889926 903.7309218943118 840.8847464621066 1120.8070652186868 861.0329015552996 810.0225088000296 1311.6602188348768 683.0987539887427 1408.7199667096136 1307.6419168710706 1405.19467651844 671.9900715351104 780.5947941541671 782.6342219114302 713.4382596611975 828.8706548511981 1269.8288711905477 1041.8318591266868 1299.8513364791868 1193.2985827326772 985.4650063812732 881.5852788090705 1422.3358085751531 1382.513265609741 967.401187121868 1219.263180941343 764.2895385622977 935.9299014508723 1069.6627737954257 1214.4406644999979 966.380434334278 1260.56576102972 1311.246238350868 610.0093072652816 770.2304157614707 1258.850274980068 639.5020279288291 1255.9021481871603 1385.9275409579275 668.4807112812995 1445.5115917325018 1108.5157456994054 1136.4221142232416 1310.8026736974714 1084.9981584027407 1112.2168341279028 643.8223060965537 1125.7522100210188 697.8775802254676 775.2726367115973 1156.606086939573 1039.842029996216 970.3567965328692 1089.7963872551916 679.0224710106849 703.0122146010398 1364.742035269737 1419.4190964102743 985.863489806652 901.4985539019107 784.7880533337592 1047.2323521599171 1023.5985121876 1383.0623537302015 693.0966696143149 1147.3645712435243 1044.074875935912 709.7418710589408 1095.577074587345 675.6065136194228 737.5356045365332 906.0744407773017 1322.0958861708639 688.2395723462104 1295.6907781958578 955.0703272223471 839.5407940447329 1367.6067277789114 1170.7533307373521 1194.3053720891473 1344.9740466475484 1264.9319985508916 754.8422199487685 1331.1875268816946 882.0101802051066 919.9461510777472 1362.9264181852338 960.6914121657609 641.4114931225776 683.1415471434592 1367.3346573114393 1174.6430553495882 1335.1887610554693 1419.6872338652609 1131.964910328388 1158.2521145045755 993.0245284736155 1273.9116102457044 817.8385671973227 744.9467357993125 722.2430130839347 1213.894557058811 630.5704286694526 1253.6403691768644 822.8745794296264 1094.5525495707986 988.3515097945927 1209.0462534129617 1008.0188881233333 1000.5809771269559 625.7102146744727 1057.454044446349 1184.346378445625 1064.5193952694533 925.5795483291148 743.6995255947112 1038.0931380763648 1163.4368143975732 739.2704588174819 1395.6636020541189 620.4737672209739 1450.787295103073 1038.5207789763806 1424.4431117177007 628.8112342357634 698.4902891516684 748.7766736745833 1029.6875838749108 1372.8317967057226 1175.841140002012 1301.1796557903288 633.090524971485 1423.3614590764043 1331.4929166436193 875.7264383137225 1079.9252834543584 1075.0148617103694 886.4470882713794 631.9572979211806 996.047311387956 1424.6682333946226 723.0640479922293 1085.4590629413722 1194.28724065423 762.5116932392119 1069.488799832761 1114.1373810172079 845.4219587147235 673.2883366942405 1069.025267101824 708.6630135774611 798.3796539902686 841.9373096525668 1184.4399049878118 977.1493440866469 1429.7211650013921 638.6390408873557 1428.4579011797903 1232.8607676923273 1294.822250306606 1080.5685474351046 1272.995564639568 921.4552776515483 734.5465892553328 1235.8765719830988 949.9084338545798 756.8472400307654 1425.751889646053 1418.1029471755025 1421.337837576866 1243.0675163865087 1203.2970796525476 1355.5688649415968 1040.4709625989196 1294.6379181742666 1340.4933065176008 759.97287184 763.7181386351584 1378.2517847418783 1095.4364879429338 1129.210564792156 738.5032987594603 921.4695255458354 992.3101796209811 946.6838335990905 857.3102310299872 843.2054959237574 1390.1847425103185 1428.9376792311666 1005.9755737334489 1309.9490121006963 978.6242732405661 989.0081126242875 1059.5660721510646 )
set r_array = ( 3.6748616981506346e-06 5.363761221170425e-06 3.596622519493103e-06 6.330888812541961e-06 4.1100394892692566e-06 4.320447977185249e-06 3.7798153567314147e-06 6.3932193803787225e-06 6.227141396999358e-06 3.947614996433258e-06 5.055412863492965e-06 3.1425989913940427e-06 4.136589388847351e-06 3.293066518306732e-06 6.013383178710937e-06 4.676497579850256e-06 5.928215854167937e-06 3.177161507606506e-06 3.40608128786087e-06 3.5186605739593503e-06 3.1768705415725708e-06 6.473751955032348e-06 3.917913715839386e-06 5.929062895774841e-06 5.9537634658813475e-06 5.707933752536773e-06 6.3467891621589654e-06 4.589182742983102e-06 3.8643555271625515e-06 6.336792569160461e-06 2.953119807243347e-06 6.125523869991302e-06 4.456316602528095e-06 3.87410964846611e-06 6.5114520120620725e-06 3.5368060398101804e-06 3.1465403366088863e-06 3.914535956382751e-06 3.32349467754364e-06 5.345019714832305e-06 6.096625213623046e-06 6.5088743019104e-06 5.949602930545806e-06 5.173285596370696e-06 3.931373362541198e-06 4.669048572443425e-06 3.3692398595809936e-06 4.433467735648155e-06 3.907696645259857e-06 4.949315108656883e-06 6.3318339157104484e-06 5.163107578754424e-06 3.943956463336945e-06 5.749841659069061e-06 3.5429399299621577e-06 5.730344789028167e-06 4.209882574081421e-06 5.147568093538284e-06 4.476003748476505e-06 2.9368160533905026e-06 5.35649683356285e-06 2.912685077190399e-06 5.5394629168510435e-06 5.1398527729511256e-06 4.93288196504116e-06 4.111650745868683e-06 5.549150733947754e-06 3.1322812843322753e-06 3.2672763276100156e-06 4.3254250305891034e-06 4.752656556218862e-06 5.947499220371246e-06 4.316637899279594e-06 4.712819861546158e-06 2.952357630729675e-06 4.859345691204071e-06 6.038763527870177e-06 4.0060426282882685e-06 5.875106291770935e-06 4.871407799720764e-06 5.997856621742248e-06 3.3539971876144407e-06 4.695684768743812e-06 4.725818580687046e-06 4.297089530825615e-06 3.6422532248497007e-06 5.1522688794136046e-06 2.933538179397583e-06 3.313755576610565e-06 6.1816248464584345e-06 3.4108591604232788e-06 6.351957886219024e-06 3.123354570865631e-06 5.568592779636382e-06 5.341373949050903e-06 6.5382768917083735e-06 5.52253630042076e-06 3.12389111995697e-06 3.916689233779907e-06 3.5112448024749755e-06 5.567127006053924e-06 4.949441655278206e-06 4.93427049100399e-06 3.786748330593109e-06 3.1634255933761593e-06 3.50764356136322e-06 5.911046712398529e-06 5.272033588886261e-06 5.762052898406982e-06 3.2674727725982665e-06 5.5184852528572076e-06 2.9636782693862914e-06 5.748664062023162e-06 3.121901350021362e-06 6.00402913570404e-06 3.2981977987289425e-06 4.683251704014837e-06 5.9070560145378105e-06 3.7191473293304442e-06 6.504408316612243e-06 5.111077015399933e-06 3.7077269124984737e-06 5.065457038879394e-06 4.701348492801189e-06 3.7044880914688107e-06 5.7899699735641475e-06 5.3356427657604215e-06 6.494138031005859e-06 3.5136468815803525e-06 4.72710859246552e-06 5.929507069587707e-06 4.891982662975788e-06 4.964593051671981e-06 4.048460583686829e-06 4.021270977258682e-06 3.5780635643005367e-06 6.33980919599533e-06 5.47247807264328e-06 3.126789193153381e-06 3.884829525947571e-06 4.057375710010528e-06 6.3325210976600645e-06 6.036997346878052e-06 4.508983815014362e-06 4.172250162363052e-06 3.7333468365669246e-06 6.15168538570404e-06 3.5090105223655697e-06 5.300807898044586e-06 6.192670290470122e-06 5.126597000956535e-06 3.1506059217453e-06 4.67428549837321e-06 5.5425440239906304e-06 4.933795364499092e-06 6.375922136306762e-06 4.308938269615173e-06 5.5852386760711665e-06 3.988777785301208e-06 5.445674006938934e-06 6.3292604970932e-06 4.9484361487627025e-06 6.5060768651962276e-06 3.158900277614593e-06 5.564415990114212e-06 4.2423056262731545e-06 3.977041940689087e-06 4.933848123550415e-06 3.3419264960289e-06 5.788181047439575e-06 3.7130656886100765e-06 4.532543132007121e-06 4.032314007282257e-06 2.948856811523437e-06 4.663808173052966e-06 2.9243877696990964e-06 3.5477668333053588e-06 3.510044889450073e-06 6.1521003770828245e-06 4.933785789012909e-06 3.852224539518356e-06 4.6659654402360315e-06 4.751477209031582e-06 4.73056914165616e-06 4.112791113853454e-06 2.9252789068222044e-06 5.297560279369354e-06 6.1547447133064265e-06 5.347870742082595e-06 3.8077977168560026e-06 4.25200336754322e-06 3.5493151116371152e-06 2.954140119552612e-06 6.33969750881195e-06 4.726540550887584e-06 3.656576435565948e-06 6.526205234527588e-06 3.516721658706665e-06 5.168789945840835e-06 4.438130970597267e-06 4.5833886484801766e-06 2.9358141946792602e-06 3.887004904747009e-06 3.3981948423385617e-06 6.359064989089965e-06 5.999877612590789e-06 4.590854483395815e-06 3.967787675857544e-06 2.922225909233093e-06 4.96430825471878e-06 5.725762610435485e-06 3.328231029510498e-06 3.6124460506439207e-06 5.957249586582183e-06 5.464125137329101e-06 5.272206537723541e-06 5.370439277887344e-06 5.76499903678894e-06 3.176207821369171e-06 3.4066380071640013e-06 3.727985744476318e-06 5.7591945219039915e-06 3.3141230392456052e-06 5.35145739197731e-06 4.089111392498016e-06 6.329642658233642e-06 6.530505352020263e-06 3.7412263083457944e-06 5.870513813495635e-06 5.151635770797729e-06 4.08886709690094e-06 4.112622027397156e-06 3.31413827419281e-06 6.504320983886718e-06 5.549815814495086e-06 3.9177721488475795e-06 3.448543231487274e-06 6.495488576889037e-06 3.3496231484413145e-06 3.914142100811005e-06 5.544649558067321e-06 3.1076204109191894e-06 4.933746172785759e-06 4.937715708017349e-06 4.274842538237572e-06 3.0272884654998775e-06 5.858043365478515e-06 3.769534020423889e-06 5.345230965614319e-06 6.299234454631805e-06 3.8484907436370845e-06 3.081915621757507e-06 3.1130914735794067e-06 2.946028904914856e-06 3.8097032654285428e-06 2.9492941188812255e-06 6.037929790019988e-06 4.6468547630310055e-06 4.727047998011112e-06 4.377027620673179e-06 5.10713596522808e-06 3.3136153507232665e-06 4.5244416806101795e-06 6.125937144756317e-06 4.8566091942787165e-06 5.1329699563980094e-06 6.13509592294693e-06 4.672032154463231e-06 5.946294586658477e-06 4.947325606942177e-06 3.6735408711433406e-06 5.947754673957824e-06 5.342111556529999e-06 3.699310891628265e-06 5.062111439108848e-06 3.5046630907058713e-06 5.060509489774703e-06 3.886895577907562e-06 4.291771836876869e-06 4.9484794127941124e-06 5.1254312324523926e-06 5.9143535542488095e-06 3.84476359963417e-06 4.205181466341018e-06 6.376655023097991e-06 5.564940361976623e-06 2.9471773195266723e-06 6.242963104248046e-06 4.493174284994602e-06 5.712549190521239e-06 4.560980502068996e-06 2.9369496273994446e-06 6.134518604278564e-06 5.691412847042083e-06 5.305006306171416e-06 4.006794505119323e-06 3.744253234863281e-06 5.366695557832718e-06 4.5952287773787975e-06 6.493519835472106e-06 4.947355862259864e-06 6.506991176605224e-06 2.9240227746963497e-06 5.2897482383251186e-06 3.810405843257904e-06 6.165091710090637e-06 5.345681415796279e-06 4.671850394569337e-06 4.900690910518169e-06 6.489834694862365e-06 3.718624620437622e-06 3.303095405101776e-06 5.722699635028839e-06 3.02577956199646e-06 4.380847569108009e-06 3.9147601354122155e-06 5.366756014823913e-06 3.315925269126892e-06 3.111553816795349e-06 3.300166540145874e-06 )
set i = 320
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

