nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1005.6206983327866 1226.7120000720024 1433.0839511752129 894.4067505002022 719.6902754530311 674.12627607584 1247.5515750050545 994.438863992691 1432.4920457601547 1127.5054168701172 1104.246538579464 1369.7457444667816 1105.1735144853592 1027.8188478946686 1005.6648072600365 1225.2318677306175 1260.834853053093 618.0083491653204 1038.6595633625984 1137.168714106083 1270.7844403386116 1117.1447363495827 917.8905498981476 1049.32920306921 1039.168758392334 750.7859934866428 1270.0663548707962 1258.7369006872177 1410.545715391636 1259.2989084124565 673.3337291330099 1348.1902477145195 1359.2696037888527 695.8741838857532 1170.9810343384743 1247.7180776000023 961.3482680916786 762.3000954091549 973.0395925045013 1060.925720334053 1039.524285197258 1401.4404919743538 1005.4533106088638 928.3070427179337 1422.200798690319 784.3843952566385 795.6599303334951 1006.6329416632652 1006.6452842950821 1411.7790934443474 773.3178735524416 806.7764372378588 1443.400178551674 1359.7267237305641 973.5508528351784 1148.0620947480202 728.7047670036554 840.1169714331627 1016.7353120446205 762.3078279942274 1170.1406535506248 950.8137089014053 1192.1623182296753 1028.2436606287956 1236.1404430866241 1269.9301925301552 929.0081140398979 1442.015492618084 1236.7512312531471 1169.5987087488174 1401.5621972084045 1440.217353105545 817.2321461886168 1236.5611252188683 773.1182769685984 1246.8730744719505 1083.066090643406 873.4232437610626 962.4395337700844 651.7251553758979 995.2384796738625 795.1105602830648 862.3381343483925 1149.2048946022987 )
set r_array = ( 2.8749324829503893e-06 5.544046883583068e-06 4.781798844337463e-06 2.879731653369963e-06 2.8647979866899547e-06 6.604561929702758e-06 3.6435440491139886e-06 6.25594136595726e-06 3.6359897191822528e-06 6.262694274187088e-06 3.2574965833872556e-06 4.027719025611877e-06 6.259750549793243e-06 6.621719126701355e-06 6.6222408163547515e-06 3.641417783796787e-06 5.92271176457405e-06 5.49463388800621e-06 5.513262053132057e-06 3.634955392330885e-06 5.175166477560997e-06 6.624617253541946e-06 4.7538121166825294e-06 2.8774199873395263e-06 3.2552538096159696e-06 6.6121226298809045e-06 4.025885959267616e-06 3.644596536755562e-06 3.2694457686692475e-06 4.791968663334846e-06 6.23826113820076e-06 5.55828494310379e-06 5.929028366804122e-06 5.122752313613891e-06 5.531662230491638e-06 4.023714822828769e-06 2.8751289198361335e-06 5.498297338485717e-06 3.2539605378359554e-06 3.255883067026734e-06 3.6321589659154413e-06 5.921545897722244e-06 6.255829607248306e-06 3.2536574482172725e-06 5.544444968104362e-06 4.743862015306949e-06 5.121757661104202e-06 3.6312199133634565e-06 4.383616087138653e-06 5.918474321365356e-06 5.872698848247527e-06 5.122086008191108e-06 4.0112122642993925e-06 6.292794917821884e-06 4.00542238086462e-06 3.635498930811882e-06 5.87255222082138e-06 5.124180589914322e-06 5.512358595728874e-06 5.121901606321335e-06 4.0158380690217015e-06 5.5103400099277494e-06 4.0179105225205415e-06 3.25497173063457e-06 3.2684594980627295e-06 3.6456103558838364e-06 4.377758030891419e-06 6.26818609714508e-06 4.405494866073131e-06 3.2616354554146525e-06 3.6439579474925994e-06 3.2591631292551755e-06 3.991641973257065e-06 4.022552085220814e-06 6.2441199767589565e-06 2.905030255783349e-06 4.010396090447902e-06 5.879320328235626e-06 4.380664092600346e-06 3.633646362572908e-06 3.2542760326713323e-06 3.617883299589157e-06 5.126221974492072e-06 5.898899783492088e-06 )
set i = 84
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

