nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 5.279735015630722e-06 4.469435729384422e-06 3.671984117031097e-06 5.264563905000686e-06 5.219156359434127e-06 5.833614664077759e-06 5.212239532470703e-06 4.471435396671295e-06 4.065366332530975e-06 3.838190041780471e-06 3.6796702551841732e-06 4.475149853825569e-06 6.494573621749877e-06 5.482214437723159e-06 3.242440466880798e-06 3.867585657835007e-06 4.6958623829483986e-06 5.468183802366256e-06 4.071592437028884e-06 5.274674330949783e-06 )
set r_array = ( 755.7181686162947 1347.67530888319 941.9337006658315 876.2904793024062 1339.6026152372358 631.2032479047774 1355.5829149484632 986.628905981779 1080.6680013239381 1312.076722383499 792.4716755747794 1134.0181098133323 1017.5825753621756 1145.3590317070482 1306.3611152768133 999.5161758363246 819.2219981551169 729.6728694438933 782.4628019332885 813.6806803941726 )
set i = 20
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

