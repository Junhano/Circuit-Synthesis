nmos: cs amp

.include ../assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1325.9547650814054 945.6032446026801 1156.179231405258 1114.5904195308683 1139.6243655681608 940.6236550211905 1335.867539644241 725.271135866642 796.3441097736359 1224.265465736389 1374.7736907005308 1194.4101905822752 1055.7106006145475 1255.1211607456205 1419.5815372467039 996.0305991768836 845.4157623648642 1016.1075147986411 1409.9830079078672 1365.6170439720152 1175.0409698486326 791.9115057587624 1380.0709390640257 775.5548983812332 1020.704934298992 976.1340579390525 760.2967888116837 1020.7925489544867 1144.5824348926542 685.6923036277294 1006.2090870738028 680.4660721123219 1104.7728288173673 1193.9692974090574 1025.6359425187109 816.3481038808823 1000.7642146944999 1296.1705315113065 1075.2145826816557 889.8837372660636 984.8127570748328 1060.550135374069 1130.1416993141172 1309.7587680816648 1399.3290460109708 1035.930367708206 751.0551741719246 1189.4061124324796 1355.454634428024 1254.7836637496946 760.3244188427925 664.8562547564507 810.4563274979591 1404.7518539428709 765.929728448391 1050.5539512634275 1015.8337375521659 675.4868164658546 699.089418053627 1174.0133404731748 1179.0289950370786 1299.8336255550382 1060.3284025192258 1135.7895052433012 1114.8877453804014 1375.4875695705412 1100.3729999065397 1160.5615472793577 1241.1374461650846 645.3135238587856 885.2379095554351 1269.569613933563 1161.1965680122373 730.5257765948772 860.3995999693869 1045.8481884002683 810.3671544790268 1368.8849568367002 645.9102657437325 1442.5168871879575 1055.7127773761747 1180.351971387863 685.7819095253944 991.0024777054786 1304.6175539493559 870.277397930622 810.3489735722542 1219.2122125625608 1065.2435302734373 666.1309589445591 1400.1809513568876 1304.733417034149 1289.8102319240568 1394.9653315544126 825.5141255259514 770.5199003219604 1279.6098279953 1280.351411104202 1403.863339424133 986.2207260727881 950.61167627573 1134.7616779804227 704.2412438988686 910.6144234538077 915.0667914748191 1040.708953142166 1119.9696922302244 1085.2841830253599 925.5339476466178 1025.7794108986852 1316.2443304061887 965.620101392269 1119.5250391960142 1294.6511518955228 665.4616665840149 1423.4251046180723 1434.2999088764188 915.7867801189421 1315.9149467945097 920.3803160786628 1429.2858374118803 796.8368494510651 776.0260683298111 915.5263602733611 1437.6357960700986 1159.9126744270322 745.1566943526268 1124.7726178169248 1030.981079638004 915.5133986473082 1246.1516165733335 1195.9762716293333 673.803363442421 1447.5561892986295 795.4163393378258 1169.0171778202055 1215.250605344772 1215.4921269416807 1110.5190837383268 704.8394080996513 721.2989787757397 1005.8447268605231 1437.2067761421201 730.252061188221 1419.7971355915067 751.4110252261162 735.2619028091431 945.7070365548133 1130.7790946960447 1250.2668833732603 1016.0263314843177 1294.6463036537168 1345.6143856048582 1424.646564722061 1305.3270792961118 1174.907395839691 840.244988799095 894.199414551258 899.9365419149398 1389.785529375076 885.4593208432196 869.5975556969642 1020.4299697279929 981.2198141217231 1020.6415608525275 1439.101251363754 770.6777155399323 1325.604405403137 1315.196417570114 1384.50609087944 1424.6519076824186 760.6498941779137 1370.5326664447782 1434.2286694049833 1379.889575242996 920.7553127408027 1159.7520887851713 1264.6160960197446 1423.0481290817258 705.5649870634079 1045.572234392166 1384.9333298206327 1065.5330395698545 1264.7439312934873 1194.1381943225858 1006.1464062333106 940.5681970715522 740.3604474663734 970.6775102019309 770.3538480401039 1065.7152938842771 685.8227238059044 725.4995103180408 1418.264101743698 860.4105827212333 1010.6485429406165 1409.9349212646482 730.4377290606499 650.31081199646 1025.7647672295568 995.7956573367118 1389.5605313777921 695.8046352863312 1040.5897259712217 1060.58367729187 625.885635688901 745.7254722714424 626.0519909858704 1384.6292757987974 630.5773609131575 705.5418713390827 659.9105162918568 1144.8090159893034 1040.740120410919 730.4810664057732 855.0597563385962 1166.6108667850492 1174.422868490219 981.2554338574408 870.4312306642531 790.4068687558174 1271.194665431976 633.7715607136488 820.8321091532707 835.7468098402022 855.4097944498061 949.2647555470465 780.7644578814507 696.3394013047218 1080.3472876548765 1289.7245466709135 851.265685558319 1389.5404458045957 1136.1123585700986 910.617070198059 1130.5194664001463 1219.03955578804 1264.6436023712156 635.7697536796331 791.024326980114 1250.6840300559995 705.5634163320065 1398.8929021358488 1334.8033010959623 1388.8931560516355 1395.2711665630338 735.6152926385403 1209.2984485626218 925.17775028944 1398.6736428737638 1001.2272217869757 1229.9200987815855 1286.5642845630643 1369.2566883563993 970.9614291787146 1159.1714870929716 690.726720392704 1364.8761534690855 1315.3101038932798 626.9608508050442 995.6503584980964 875.8014500141143 1265.3873622417448 785.8640909194946 1325.8417713642118 1114.5987308025358 684.1139906644821 1340.3879809379575 895.1299306750296 780.8585038781166 719.6294520795345 1408.4268212318418 825.7872596383095 660.4389004409313 1076.268728971481 899.675751030445 1085.1098442077634 830.2703991532325 725.947242975235 705.8062489330769 1129.4922327995298 1075.9518122673032 1194.493600130081 1080.7209980487821 1155.5509388446806 865.032738149166 1340.8414399623869 930.501490831375 800.6850177049637 895.5479678511618 1159.106283187866 1229.4095492362974 715.4694998264313 1095.9984016418455 1345.5204880237577 1250.0774061679838 845.5525767803191 940.6877210736274 1447.0575129985807 1418.7635695934293 623.844593912363 1005.814746916294 1055.527455806732 1035.9260141849516 971.0161945223807 1443.8869607448576 850.0089272856711 715.573972016573 1194.2648422718046 650.1026344299316 685.4226078093052 950.9318581223487 975.4539683461188 811.1006984114647 1355.6310510635374 1326.0461890697477 1185.939025878906 683.7011727690697 )
set r_array = ( 5.878910737037658e-06 6.078170113563537e-06 6.280637412071227e-06 3.4754323232173917e-06 4.672144989967346e-06 3.883471684455871e-06 5.6781332302093505e-06 3.085095165967941e-06 3.0865425395965575e-06 3.2769803988933563e-06 3.6761120903491972e-06 4.668584733009338e-06 4.280126194953918e-06 5.0722095537185666e-06 4.269547991752624e-06 3.885703282356262e-06 5.483995156288146e-06 4.679440813064575e-06 4.47040081501007e-06 4.6711454916000364e-06 2.8713798630237576e-06 2.8910723197460173e-06 6.073215107917785e-06 3.677272306680679e-06 5.476554064750671e-06 4.878281121253967e-06 4.076078324317932e-06 5.276835494041442e-06 4.6717617559432976e-06 5.281564764976501e-06 4.2826890993118284e-06 5.681741766929626e-06 3.275307183265686e-06 3.867850499153137e-06 5.676527123451232e-06 2.888086377382278e-06 5.476427035331726e-06 6.0799292135238645e-06 3.6802732694149014e-06 3.6801081526279445e-06 2.869549094438553e-06 5.077037959098816e-06 5.4780831384658806e-06 3.4797478902339935e-06 3.673469363451004e-06 4.678948574066161e-06 3.086759530305862e-06 4.668829350471496e-06 6.46778736591339e-06 4.667429022789001e-06 3.8759881067276e-06 2.875582401752472e-06 3.677567135095596e-06 5.6741770792007445e-06 3.2828339982032773e-06 3.683124457597732e-06 6.2759965467453e-06 4.278502707481384e-06 3.2812461841106414e-06 3.868735628128052e-06 3.4721062767505644e-06 3.8720654296875e-06 3.4814626801013943e-06 6.08053174495697e-06 4.67410171508789e-06 4.470977168083191e-06 5.6785175371170035e-06 5.880970888137817e-06 6.081808047294616e-06 5.683034162521362e-06 4.0784667778015135e-06 4.06750319480896e-06 6.280775170326233e-06 5.879792432785034e-06 5.0807589340209954e-06 4.280903606414794e-06 4.68016028881073e-06 2.8658161032199857e-06 4.080202918052673e-06 3.463864814043045e-06 6.077184777259826e-06 5.680054335594177e-06 5.081232933998108e-06 6.475909523963928e-06 3.081980799436569e-06 4.277606635093689e-06 4.4785755443573e-06 4.26559226989746e-06 3.0742180573940273e-06 4.880777292251587e-06 5.274159722328186e-06 3.4795582044124603e-06 4.068743233680725e-06 4.071871976852417e-06 5.6857374000549315e-06 3.677192376852035e-06 3.870615534782409e-06 5.072331433296203e-06 3.472742174863815e-06 4.679571061134338e-06 6.077869277000427e-06 4.87365656375885e-06 3.2812353479862212e-06 4.279345350265503e-06 3.6821147668361662e-06 6.076715712547302e-06 5.075568108558655e-06 4.67632966518402e-06 5.879115657806396e-06 3.685228918790817e-06 6.4728024530410764e-06 5.876919035911559e-06 3.4749602544307707e-06 3.281998972892761e-06 5.6828723716735836e-06 6.067170052528381e-06 4.6692246007919305e-06 4.6783863830566405e-06 5.678736834526062e-06 3.88184519290924e-06 5.2722225236892694e-06 2.890619670152664e-06 3.2829182732105254e-06 4.080518345832824e-06 3.2634030032157896e-06 5.276232104301452e-06 4.075849800109863e-06 4.673316149711608e-06 4.679102854728698e-06 5.879872469902038e-06 6.08171148777008e-06 6.082004599571228e-06 3.081647454500198e-06 3.6635774838924404e-06 4.882167963981628e-06 3.670476983785629e-06 5.4779715585708615e-06 5.680136947631835e-06 5.879393534660339e-06 4.076333026885986e-06 6.475719408988952e-06 3.6861535298824307e-06 6.259242396354675e-06 4.478001980781555e-06 4.670399408340454e-06 6.475746445655822e-06 4.4780650663375855e-06 5.477311091423034e-06 6.080339913368224e-06 5.275047640800475e-06 4.878260307312011e-06 3.0822849082946777e-06 4.670507125854492e-06 4.6700657415390015e-06 4.6688076782226555e-06 5.2759851264953605e-06 4.277200226783752e-06 3.079158900976181e-06 3.6808695781230923e-06 6.072052960395812e-06 4.4780423212051385e-06 3.28037425160408e-06 3.2823626267910003e-06 4.6795311498641964e-06 5.876416068077087e-06 4.8697199392318725e-06 5.883290247917175e-06 4.87110095500946e-06 4.268883233070374e-06 6.463031916618347e-06 4.870976071357726e-06 5.882304482460021e-06 5.67661316871643e-06 5.0711225080490105e-06 6.269504313468932e-06 5.07800956249237e-06 5.074191169738769e-06 4.266151242256164e-06 6.26219883441925e-06 4.880371742248535e-06 5.676943402290344e-06 6.072644333839416e-06 4.877135710716247e-06 4.466315274238586e-06 4.266443281173705e-06 4.084281806945801e-06 5.878121094703674e-06 4.679722981452941e-06 5.67662754535675e-06 4.277177267074585e-06 6.077558140754699e-06 6.281024508476257e-06 5.281830840110778e-06 3.0642039227485656e-06 5.482897381782532e-06 5.87630856513977e-06 5.273656539916992e-06 4.8808079767227165e-06 5.883695154190063e-06 5.2768586683273315e-06 6.2761686372756954e-06 6.268064503669738e-06 6.279355101585388e-06 5.676824955940246e-06 5.87746491909027e-06 5.07638500213623e-06 6.079231839179992e-06 2.8657632100582122e-06 3.6752491700649258e-06 5.279135541915893e-06 6.078708701133727e-06 2.874404590129852e-06 5.074714093208313e-06 5.077266697883606e-06 5.081715517044067e-06 3.877456884384155e-06 6.4791140127182e-06 4.669675211906432e-06 4.48101420879364e-06 4.879227619171142e-06 4.076478724479675e-06 6.08100724697113e-06 3.488417648077011e-06 3.0846565711498257e-06 6.085621933937072e-06 5.483278040885925e-06 2.871214209794998e-06 3.4795539128780363e-06 6.479428153038024e-06 4.477081875801086e-06 3.871343379020691e-06 6.48440912246704e-06 3.674720023870468e-06 6.279965357780456e-06 5.278627209663391e-06 5.8801140832901e-06 3.8676749753952025e-06 3.0817768442630767e-06 6.280403523445129e-06 3.282789098024368e-06 5.679904561042785e-06 5.2812995481491085e-06 6.460314517021178e-06 3.4799779164791103e-06 3.2741870927810666e-06 4.470924167633056e-06 3.085861312150955e-06 4.466469984054565e-06 3.6829628813266753e-06 3.2722187268733974e-06 4.282750897407531e-06 5.072379283905029e-06 6.475617270469665e-06 3.2775875437259674e-06 6.476803021430969e-06 4.069087629318237e-06 5.081145172119141e-06 3.6767228829860684e-06 4.468521122932434e-06 4.27566535949707e-06 5.876300625801086e-06 6.283866362571716e-06 5.27499614238739e-06 6.083397631645202e-06 5.477089862823486e-06 3.675274060964584e-06 3.6788688647747037e-06 4.2703118848800655e-06 3.879785470962524e-06 6.082896809577941e-06 3.67671590924263e-06 6.4583695936203e-06 6.08563952922821e-06 4.0796173381805416e-06 6.476254992485046e-06 3.4812264311313626e-06 3.073037885427475e-06 4.277208595275879e-06 2.888304923772812e-06 6.277986531257629e-06 4.072308211326599e-06 6.277436785697937e-06 3.075722186565399e-06 6.078178696632385e-06 5.880852227210998e-06 3.877880887985229e-06 5.67795663356781e-06 3.8826809692382805e-06 5.885510687828064e-06 4.478261404037475e-06 3.869817309379577e-06 4.466012721061706e-06 5.879384307861327e-06 6.278285222053527e-06 4.470054059028625e-06 5.072219638824463e-06 5.8852785158157345e-06 5.477506356239318e-06 6.062763934135437e-06 3.6702018964290617e-06 3.490486704111099e-06 6.276031737327575e-06 5.477058534622192e-06 4.082929329872131e-06 5.0774078893661495e-06 4.8691927242279046e-06 3.67807214140892e-06 6.078197579383849e-06 4.467120795249938e-06 2.8720337855815887e-06 5.881089549064636e-06 4.082979540824889e-06 3.485670744180679e-06 6.284117846488952e-06 4.670861821174621e-06 6.2758111524581905e-06 6.08188615322113e-06 3.281655274629593e-06 )
set i = 318
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata ../out/r-test.csv $r_array[$&index]
    wrdata ../out/w-test.csv $w_array[$&index]
    wrdata ../out/bw-test.csv bw
    wrdata ../out/pw-test.csv pw
    wrdata ../out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

