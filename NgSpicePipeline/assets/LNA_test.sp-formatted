circuit: LNA
.include ../assets/45nm_CS.pm

.option TEMP=27C
R2 vdd net7 700
R1 net2 net9 10k
R0 vdd net2 800
C1 net7 net6 1p
C0 net8 net9 10p
Lg net9 net4 14.8n
Ld vdd net7 4.4n
Ls net5 0 58.3p
V0 vdd 0 dc 1.2
mn2 net2 net2 0 0 NMOS w=7u l=45n
mn1 net7 vdd net1 0 NMOS w=51u l=45n
mn0 net1 net4 net5 0 NMOS w=51u l=45n
V1 net9 0 dc 0 sin(0 100m 2.4G) portnum 1 z0 50
V2 net6 0 dc 0 ac 0 portnum 2 z0 50

.control
set ls_array = ( 6.190988944768906e-11 6.190979567766189e-11 6.190994250178337e-11 6.190985860228538e-11 6.190998938679695e-11 6.190992276072502e-11 6.190992111563682e-11 6.190986230373383e-11 6.190995566248893e-11 6.190978621840476e-11 6.190992605090142e-11 6.190958675146103e-11 6.190966530442237e-11 6.190986230373383e-11 6.190990096330642e-11 6.190952999591827e-11 5.486049446463585e-11 6.190999349951744e-11 6.1909889036417e-11 6.190998280644416e-11 6.19099326312542e-11 6.190990795493125e-11 6.190969121456147e-11 6.190990754365921e-11 6.190992605090142e-11 6.190999103188515e-11 6.19099470257759e-11 6.190999637842179e-11 6.190990589857102e-11 6.190963363647461e-11 5.486049446463585e-11 6.190994414687157e-11 6.190886579155922e-11 6.190990589857102e-11 6.191000090241431e-11 6.1909989798069e-11 6.190990096330642e-11 6.190969162583351e-11 6.190979485511779e-11 6.190990137457848e-11 6.190972617268562e-11 6.190980431437493e-11 6.190952999591827e-11 6.190990425348282e-11 6.190998033881187e-11 6.190966530442237e-11 6.19099470257759e-11 6.190989602804184e-11 6.190979567766189e-11 6.190996676683426e-11 6.190990425348282e-11 6.190979444384575e-11 6.190980431437493e-11 6.19099939107895e-11 6.190995607376098e-11 6.190995648503304e-11 6.190969203710556e-11 6.190988368988037e-11 6.190989726185799e-11 6.190995566248893e-11 6.19099462032318e-11 6.190995483994483e-11 6.190999432206154e-11 6.19099301636219e-11 6.19099470257759e-11 6.190988944768906e-11 6.190987752079963e-11 6.190988492369652e-11 6.190988944768906e-11 6.190982241034508e-11 6.190982241034508e-11 6.190959703326225e-11 6.190939715504647e-11 6.190994784832e-11 6.190999308824538e-11 6.190954809188842e-11 6.190974755883217e-11 6.190994414687157e-11 6.190980924963951e-11 6.190999349951744e-11 6.190999103188515e-11 6.190999144315719e-11 6.190979115366936e-11 6.190998033881187e-11 6.190983844995498e-11 6.190980431437493e-11 6.190990548729896e-11 6.190952917337418e-11 6.1909989798069e-11 6.190966489315033e-11 6.190986230373383e-11 6.190998280644416e-11 6.190999432206154e-11 6.190992605090142e-11 6.190963322520256e-11 5.486049446463585e-11 6.190987793207169e-11 6.190989685058593e-11 6.190993386507035e-11 6.190986230373383e-11 6.19097915649414e-11 6.190994784832e-11 6.19097705900669e-11 6.190958551764488e-11 5.486049446463585e-11 6.190954151153565e-11 6.190998321771622e-11 6.190886867046356e-11 6.190988944768906e-11 6.190958675146103e-11 6.19099470257759e-11 6.1909989798069e-11 6.190982282161712e-11 6.19090706050396e-11 6.190999185442924e-11 6.190982199907302e-11 6.190992605090142e-11 6.19097915649414e-11 6.190980431437493e-11 6.190939756631851e-11 6.190963281393051e-11 6.190980924963951e-11 6.190988410115242e-11 5.486049446463585e-11 6.190885098576546e-11 6.190988944768906e-11 6.190982282161712e-11 6.190868236422538e-11 6.190976113080978e-11 6.190959785580635e-11 6.190978621840476e-11 6.190974755883217e-11 6.190999349951744e-11 6.1909889036417e-11 6.190983680486679e-11 6.190999349951744e-11 6.190986230373383e-11 6.190986230373383e-11 6.190939715504647e-11 6.190999144315719e-11 6.190985819101334e-11 6.190993057489395e-11 6.190999349951744e-11 6.19099462032318e-11 6.190992563962936e-11 6.190990754365921e-11 6.190998938679695e-11 6.190983803868294e-11 6.190948804616928e-11 6.190999432206154e-11 6.1909889036417e-11 6.190871362090111e-11 5.486049446463585e-11 6.190994455814361e-11 6.190934081077575e-11 6.190979444384575e-11 6.190963363647461e-11 6.190965461134911e-11 6.191000049114227e-11 6.190959826707839e-11 6.190993221998214e-11 6.190999637842179e-11 6.190998404026031e-11 6.190999103188515e-11 6.190980719327926e-11 6.190988944768906e-11 6.190949010252953e-11 6.190989685058593e-11 6.190999349951744e-11 6.190992605090142e-11 6.190954110026359e-11 6.190998033881187e-11 6.1909889036417e-11 6.19097907423973e-11 6.190983803868294e-11 6.190982282161712e-11 6.190976071953774e-11 6.190992234945297e-11 6.190990260839461e-11 6.190989726185799e-11 6.190988410115242e-11 5.486049446463585e-11 6.190966365933418e-11 6.190980966091155e-11 5.486049446463585e-11 6.190999637842179e-11 6.19099470257759e-11 6.190988944768906e-11 6.190980431437493e-11 6.19099470257759e-11 6.190990754365921e-11 6.190982241034508e-11 6.190969162583351e-11 6.19099462032318e-11 6.190992646217346e-11 )
set ld_array = ( 3.7927913486957555e-09 3.792745661735534e-09 3.792743784189224e-09 3.792741531133652e-09 3.79276631474495e-09 3.792739403247833e-09 3.792740279436112e-09 3.79274052977562e-09 3.792746913433075e-09 3.792818635702133e-09 3.792781335115433e-09 3.792781835794449e-09 3.7927669405937196e-09 3.79274052977562e-09 3.792739653587341e-09 3.792795604467392e-09 3.786160856485367e-09 3.792756301164627e-09 3.792739278078079e-09 3.79275267124176e-09 3.792741656303406e-09 3.792740154266357e-09 3.792762684822083e-09 3.792739403247833e-09 3.792781460285187e-09 3.792755675315857e-09 3.792744910717011e-09 3.7927585542202e-09 3.792739903926849e-09 3.792773824930191e-09 3.786160856485367e-09 3.792744159698487e-09 3.792994248867035e-09 3.7927397787570955e-09 3.792763185501099e-09 3.792754423618317e-09 3.792739653587341e-09 3.7927628099918365e-09 3.792746537923813e-09 3.792739528417587e-09 3.792756551504135e-09 3.792745786905289e-09 3.792795604467392e-09 3.792740029096604e-09 3.79275204539299e-09 3.79276631474495e-09 3.7927447855472565e-09 3.792740154266357e-09 3.7927459120750425e-09 3.792749166488648e-09 3.792739903926849e-09 3.792746412754059e-09 3.792745661735534e-09 3.7927564263343814e-09 3.792746788263321e-09 3.792746913433075e-09 3.792762684822083e-09 3.792740154266357e-09 3.792740029096604e-09 3.792746788263321e-09 3.792744410037995e-09 3.792746537923813e-09 3.792765188217163e-09 3.792741531133652e-09 3.792744910717011e-09 3.792739278078079e-09 3.792740029096604e-09 3.792792224884033e-09 3.792791223526001e-09 3.79274240732193e-09 3.7927430331707e-09 3.792780709266663e-09 3.792815381288529e-09 3.7927450358867646e-09 3.792756927013398e-09 3.792790973186493e-09 3.7927536725997924e-09 3.792744159698487e-09 3.7927450358867646e-09 3.792756301164627e-09 3.792755800485611e-09 3.792755675315857e-09 3.7927461624145506e-09 3.79275204539299e-09 3.792742532491684e-09 3.792745661735534e-09 3.7927397787570955e-09 3.792795729637146e-09 3.792754423618317e-09 3.7927669405937196e-09 3.792740404605865e-09 3.79275267124176e-09 3.792765188217163e-09 3.792781335115433e-09 3.792773699760437e-09 3.786160856485367e-09 3.792740029096604e-09 3.792740029096604e-09 3.79274178147316e-09 3.792740404605865e-09 3.7927461624145506e-09 3.792744910717011e-09 3.792749291658401e-09 3.792782086133957e-09 3.786160856485367e-09 3.792792600393295e-09 3.792753171920776e-09 3.792993748188019e-09 3.792791223526001e-09 3.792781835794449e-09 3.7927447855472565e-09 3.792754423618317e-09 3.792742532491684e-09 3.7929236531257634e-09 3.792755675315857e-09 3.792742532491684e-09 3.792781335115433e-09 3.7927461624145506e-09 3.792745786905289e-09 3.792815381288529e-09 3.792773824930191e-09 3.7927450358867646e-09 3.792740154266357e-09 3.786160856485367e-09 3.792997252941132e-09 3.792791223526001e-09 3.792742532491684e-09 3.7930306732654576e-09 3.792749667167664e-09 3.792780709266663e-09 3.792818635702133e-09 3.7927536725997924e-09 3.792756551504135e-09 3.792739278078079e-09 3.792805117368698e-09 3.792756301164627e-09 3.792740404605865e-09 3.79274052977562e-09 3.792815381288529e-09 3.792755800485611e-09 3.792741656303406e-09 3.79274178147316e-09 3.7927564263343814e-09 3.792744535207748e-09 3.792781460285187e-09 3.792739528417587e-09 3.79276631474495e-09 3.792742532491684e-09 3.792801111936569e-09 3.792765188217163e-09 3.792739278078079e-09 3.793024665117264e-09 3.786160856485367e-09 3.792744034528732e-09 3.79282101392746e-09 3.792746788263321e-09 3.792773824930191e-09 3.792769944667817e-09 3.792763060331345e-09 3.7927805840969084e-09 3.792741531133652e-09 3.7927585542202e-09 3.792753046751023e-09 3.792755675315857e-09 3.7927450358867646e-09 3.792791223526001e-09 3.792799234390259e-09 3.792740029096604e-09 3.7927564263343814e-09 3.792781585454941e-09 3.7927927255630496e-09 3.792752170562744e-09 3.792739278078079e-09 3.792746287584305e-09 3.792742532491684e-09 3.792742657661438e-09 3.792749667167664e-09 3.792739278078079e-09 3.792739903926849e-09 3.792740029096604e-09 3.792740154266357e-09 3.786160856485367e-09 3.792767941951752e-09 3.7927450358867646e-09 3.786160856485367e-09 3.7927585542202e-09 3.7927447855472565e-09 3.7927913486957555e-09 3.792745786905289e-09 3.792744910717011e-09 3.792739403247833e-09 3.792742532491684e-09 3.792762684822083e-09 3.792744535207748e-09 3.792781460285187e-09 )
set lg_array = ( 1.6407487428188326e-08 1.640746055841446e-08 1.640749660730362e-08 1.6407473409175873e-08 1.6407506620883943e-08 1.6407487761974338e-08 1.6407487678527835e-08 1.64074741601944e-08 1.6407501947879793e-08 1.6407467234134676e-08 1.640749477148056e-08 1.6407423925399782e-08 1.6407434356212617e-08 1.6407473993301394e-08 1.640748258829117e-08 1.640742317438126e-08 1.3951193308830261e-08 1.6407508957386017e-08 1.6407479834556582e-08 1.640750812292099e-08 1.640749251842499e-08 1.6407484257221223e-08 1.6407439696788788e-08 1.6407484257221223e-08 1.6407494854927064e-08 1.6407508957386017e-08 1.6407498610019684e-08 1.640750904083252e-08 1.6407483756542208e-08 1.640742918252945e-08 1.3951193308830261e-08 1.640749752521515e-08 1.6407296419143677e-08 1.640748392343521e-08 1.6407508540153505e-08 1.6407508957386017e-08 1.6407482755184176e-08 1.6407439696788788e-08 1.6407460391521455e-08 1.6407482671737673e-08 1.6407446539402008e-08 1.6407462310791017e-08 1.640742317438126e-08 1.6407483422756196e-08 1.6407507789134982e-08 1.6407434022426605e-08 1.6407498610019684e-08 1.6407481420040132e-08 1.6407460391521455e-08 1.6407506120204926e-08 1.64074835062027e-08 1.6407460391521455e-08 1.640746239423752e-08 1.6407508957386017e-08 1.6407501947879793e-08 1.6407501947879793e-08 1.6407439863681794e-08 1.6407478666305544e-08 1.6407481753826144e-08 1.6407501947879793e-08 1.640749810934067e-08 1.640750161409378e-08 1.6407507288455964e-08 1.6407491767406464e-08 1.6407498610019684e-08 1.6407479918003085e-08 1.64074773311615e-08 1.64074865937233e-08 1.640748751163483e-08 1.6407465648651123e-08 1.6407465565204623e-08 1.6407424926757815e-08 1.640742017030716e-08 1.6407498860359193e-08 1.6407508957386017e-08 1.640742334127426e-08 1.6407451212406158e-08 1.6407497441768646e-08 1.6407463145256044e-08 1.640750904083252e-08 1.6407508957386017e-08 1.6407508790493014e-08 1.640745955705643e-08 1.6407507789134982e-08 1.640746890306473e-08 1.640746239423752e-08 1.640748383998871e-08 1.640742317438126e-08 1.6407508957386017e-08 1.6407434356212617e-08 1.6407474076747897e-08 1.6407507956027988e-08 1.640750745534897e-08 1.6407494854927064e-08 1.6407429015636447e-08 1.3951193308830261e-08 1.6407477414608002e-08 1.6407481753826144e-08 1.6407493102550508e-08 1.6407474076747897e-08 1.6407459723949435e-08 1.640749877691269e-08 1.6407455384731294e-08 1.6407423925399782e-08 1.3951193308830261e-08 1.6407423007488253e-08 1.6407508289813996e-08 1.6407297337055206e-08 1.6407487595081332e-08 1.6407424008846285e-08 1.640749844312668e-08 1.6407508957386017e-08 1.6407465648651123e-08 1.6407363343238833e-08 1.6407508957386017e-08 1.6407465565204623e-08 1.6407494854927064e-08 1.6407459723949435e-08 1.6407462310791017e-08 1.640742017030716e-08 1.640742884874344e-08 1.6407463228702547e-08 1.6407478749752047e-08 1.3951193308830261e-08 1.6407290995121004e-08 1.6407487595081332e-08 1.6407465648651123e-08 1.6407229745388034e-08 1.6407453215122223e-08 1.6407425010204318e-08 1.640746731758118e-08 1.640745112895966e-08 1.6407508957386017e-08 1.6407479918003085e-08 1.6407477164268497e-08 1.6407508957386017e-08 1.6407474076747897e-08 1.6407474076747897e-08 1.640742017030716e-08 1.6407508957386017e-08 1.640747324228287e-08 1.640749193429947e-08 1.6407508957386017e-08 1.6407498276233676e-08 1.6407494938373567e-08 1.6407484340667726e-08 1.6407506620883943e-08 1.640746890306473e-08 1.640742167234421e-08 1.6407507288455964e-08 1.6407479918003085e-08 1.6407241094112398e-08 1.3951193308830261e-08 1.6407497274875644e-08 1.64074120759964e-08 1.6407460391521455e-08 1.6407429015636447e-08 1.640743285417557e-08 1.6407508456707002e-08 1.6407425010204318e-08 1.640749260187149e-08 1.640750904083252e-08 1.6407508206367493e-08 1.6407508790493014e-08 1.6407462728023532e-08 1.6407487595081332e-08 1.640742075443268e-08 1.6407481753826144e-08 1.6407508957386017e-08 1.640749477148056e-08 1.640742317438126e-08 1.6407507789134982e-08 1.6407479834556582e-08 1.640745955705643e-08 1.640746890306473e-08 1.6407465565204623e-08 1.6407452964782717e-08 1.6407487761974338e-08 1.6407483088970185e-08 1.6407481753826144e-08 1.6407478749752047e-08 1.3951193308830261e-08 1.6407434523105623e-08 1.6407463228702547e-08 1.3951193308830261e-08 1.6407508957386017e-08 1.640749852657318e-08 1.6407487595081332e-08 1.6407462310791017e-08 1.6407498693466187e-08 1.6407484257221223e-08 1.6407465565204623e-08 1.6407439696788788e-08 1.6407498192787173e-08 1.640749477148056e-08 )
set w_array = ( 4.8995160698890685e-05 4.899508798122406e-05 4.8995117485523223e-05 4.899509453773498e-05 4.8995140135288235e-05 4.8995106756687164e-05 4.899510735273361e-05 4.899509453773498e-05 4.899512553215027e-05 4.8995183348655697e-05 4.899515235424042e-05 4.899512732028961e-05 4.8995112121105194e-05 4.899509453773498e-05 4.899510169029236e-05 4.899513655900955e-05 4.898327940702438e-05 4.899513298273086e-05 4.8995098114013666e-05 4.899513179063797e-05 4.899511152505874e-05 4.899510407447815e-05 4.899510616064071e-05 4.899510377645492e-05 4.899515265226364e-05 4.8995132386684414e-05 4.8995120763778685e-05 4.899513447284698e-05 4.8995103478431696e-05 4.8995118677616116e-05 4.898327940702438e-05 4.899511897563934e-05 4.899561220407486e-05 4.899510318040847e-05 4.899513775110244e-05 4.8995132386684414e-05 4.899510169029236e-05 4.899510616064071e-05 4.8995088577270506e-05 4.8995101392269134e-05 4.899509900808334e-05 4.8995089471340175e-05 4.899513655900955e-05 4.899510288238525e-05 4.899513119459152e-05 4.8995111823081964e-05 4.8995120763778685e-05 4.899510079622268e-05 4.899508798122406e-05 4.8995129406452176e-05 4.899510288238525e-05 4.8995088577270506e-05 4.899508917331695e-05 4.899513268470764e-05 4.899512583017349e-05 4.899512553215027e-05 4.899510616064071e-05 4.899509751796722e-05 4.899510079622268e-05 4.899512553215027e-05 4.899511986970901e-05 4.8995124936103815e-05 4.899513953924179e-05 4.899511063098907e-05 4.8995120763778685e-05 4.8995098114013666e-05 4.899509662389755e-05 4.899516129493713e-05 4.899516040086746e-05 4.899508917331695e-05 4.8995089471340175e-05 4.899512553215027e-05 4.8995161592960354e-05 4.899512135982513e-05 4.899513328075408e-05 4.899513357877731e-05 4.899509513378143e-05 4.899511897563934e-05 4.8995089471340175e-05 4.899513298273086e-05 4.8995132386684414e-05 4.899513208866119e-05 4.899508768320083e-05 4.899513119459152e-05 4.899509185552597e-05 4.899508917331695e-05 4.899510288238525e-05 4.8995136857032774e-05 4.899513208866119e-05 4.8995111823081964e-05 4.899509453773498e-05 4.899513179063797e-05 4.8995139241218566e-05 4.899515235424042e-05 4.8995118677616116e-05 4.898327940702438e-05 4.899509632587433e-05 4.899510079622268e-05 4.899511241912842e-05 4.899509423971176e-05 4.899508768320083e-05 4.899512135982513e-05 4.8995090365409845e-05 4.899512732028961e-05 4.898327940702438e-05 4.8995134770870205e-05 4.899513179063797e-05 4.899561131000519e-05 4.899516010284423e-05 4.899512732028961e-05 4.899512046575546e-05 4.8995132386684414e-05 4.899508917331695e-05 4.899543011188507e-05 4.899513208866119e-05 4.899508917331695e-05 4.899515235424042e-05 4.899508768320083e-05 4.8995089471340175e-05 4.899516129493713e-05 4.8995118677616116e-05 4.8995089471340175e-05 4.899509751796722e-05 4.898327940702438e-05 4.89956202507019e-05 4.899516040086746e-05 4.8995089471340175e-05 4.899570727348327e-05 4.899509185552597e-05 4.899512553215027e-05 4.8995183050632473e-05 4.899509513378143e-05 4.899513298273086e-05 4.8995098114013666e-05 4.8995172321796414e-05 4.899513298273086e-05 4.899509453773498e-05 4.899509453773498e-05 4.8995161592960354e-05 4.8995132386684414e-05 4.899509423971176e-05 4.899511063098907e-05 4.8995132386684414e-05 4.899511986970901e-05 4.899515235424042e-05 4.8995103478431696e-05 4.8995140135288235e-05 4.899509215354919e-05 4.899514430761337e-05 4.8995139241218566e-05 4.8995098114013666e-05 4.899569118022918e-05 4.898327940702438e-05 4.899511897563934e-05 4.899517410993576e-05 4.8995088577270506e-05 4.899511837959289e-05 4.8995114207267756e-05 4.899513775110244e-05 4.899512553215027e-05 4.899511152505874e-05 4.899513447284698e-05 4.899513179063797e-05 4.899513208866119e-05 4.899508887529373e-05 4.8995160698890685e-05 4.899514400959014e-05 4.899510079622268e-05 4.899513298273086e-05 4.899515265226364e-05 4.899513506889343e-05 4.8995131492614744e-05 4.899509841203689e-05 4.899508768320083e-05 4.899509215354919e-05 4.8995089471340175e-05 4.899509185552597e-05 4.8995106756687164e-05 4.8995102286338803e-05 4.899510079622268e-05 4.8995097219944e-05 4.898327940702438e-05 4.8995112121105194e-05 4.899508917331695e-05 4.898327940702438e-05 4.899513447284698e-05 4.8995120763778685e-05 4.899516040086746e-05 4.8995089471340175e-05 4.8995120763778685e-05 4.8995103478431696e-05 4.899508917331695e-05 4.899510616064071e-05 4.899512016773224e-05 4.899515265226364e-05 )
set i = 195
let index = 1
repeat $i
    alter Ls = $ls_array[$&index]
    alter Ld = $ld_array[$&index]
    alter Lg = $lg_array[$&index]
    alter @mn0[w] = $w_array[$&index]

    sp lin 100 1k 100G 1
    let s21 = abs(S_2_1)
    let s12 = abs(S_1_2)
    let s11 = abs(S_1_1)
    let reals11 = real(minimum(S_1_1))



    let gmax = s21/s12
    let Gmax2 = vecmax(gmax)
    print Gmax2 >> ../out/Gp-test.csv


    print reals11 >> ../out/s11-test.csv
    let nf = real(minimum(NF))
    print nf >> ../out/nf-test.csv

    print $ls_array[$&index]
    print $ls_array[$&index] >> ../out/ls-test.csv
    print $ld_array[$&index] >> ../out/ld-test.csv
    print $lg_array[$&index] >> ../out/lg-test.csv
    print $w_array[$&index] >> ../out/w-test.csv

    let index = index + 1
end

.endc
.end