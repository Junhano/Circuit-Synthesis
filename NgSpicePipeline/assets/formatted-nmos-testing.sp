nmos: cs amp

.include NgSpicePipeline/assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 724.118237644434 1059.6497577428818 1351.42711520195 625.4717566817999 927.0461764931679 899.9944959580898 700.6856220588088 751.6705323755741 900.0964087247849 1153.575513958931 741.6681938618422 1427.8540682792664 1031.584211140871 925.8890178799629 850.1726266741753 1189.091510772705 935.7557472586632 1171.8474280834198 927.4542209506035 684.3940426409245 1109.3549621105194 1349.6824276447296 1360.1872366666794 757.904778495431 1362.1488791704178 813.1806527078152 915.2395394444466 767.1838928759098 872.7580693364143 736.0610862076283 620.8019637316465 1213.7675297260284 971.850126683712 685.2608359232545 972.6045516133308 1427.6564878225327 935.2964390814304 1383.9174461364746 1166.0720598697662 1340.5667793750763 834.0264973044395 1217.516444325447 945.8883349597454 694.747322499752 789.5529583841562 845.7823377847672 1282.9169523715973 1274.6474874019623 1395.7920414209366 801.8404294550419 717.6066203787923 926.611455231905 898.4839741885662 1379.477737545967 1305.876214504242 785.8922493457794 1432.1897250413895 956.5306340157986 1053.7737306952477 678.288312330842 1031.8879579007626 936.6276730597019 1005.2143011987209 662.8583844564855 915.3671209514141 1010.3179302811623 877.8912764787674 1262.2221451997757 1064.0376862883568 745.2729922533035 1200.669292807579 1194.9158561229706 994.271697551012 1004.14027094841 991.7430807650089 1079.8249942064285 640.5725057050586 1280.1716756820679 1239.275176525116 944.3089206516743 1174.8550963401794 1401.8916618824005 1325.8398067951202 1183.192617893219 1200.1043838262558 723.0683394521475 1359.8520678281784 949.8223152756691 1432.9392325878143 1360.8465594053268 895.1439154148102 1418.8619446754456 888.6512485146523 1025.969100445509 1198.6952584981918 789.2886982113123 1103.9532166719437 888.9574539661407 687.9561028257012 806.263320595026 1042.9943841695786 1340.0790733098984 775.2149876952171 857.7338655292988 1302.9277515411377 1189.155928492546 1008.1777375936508 1224.5368939638138 1052.674154639244 1004.2745155096054 1147.546900510788 720.5680467933416 780.8469527214766 1126.3119679689407 1222.0768254995346 1245.0560522079468 1095.3623515367508 1251.3805937767029 761.7109929025173 1349.8838436603546 1086.994932293892 1400.4722100496292 1224.7784358263016 1088.7566339969635 629.1300193220377 1154.8624914884567 1256.6806477308273 840.4588279128075 764.0869126468897 1415.0758546590805 1153.4367454051971 646.3801012188196 628.8262664154172 1072.4265944957733 1310.900894999504 1335.697881579399 1195.2413868904114 1271.5581905841827 1336.6020900011063 1037.0750349760056 961.8730266392231 944.1010628640652 625.6947784498334 904.6033379435539 1205.917517542839 626.8248115479946 997.9504410922527 1417.9252815246582 717.2421132028103 943.9106126129627 1221.8346935510635 1280.436624288559 1021.0901711881161 999.0916673839092 822.582886070013 1086.9477254152298 772.8381090611219 1227.632976770401 630.3955693542957 1058.3457660675049 866.8118712306023 751.1649516224861 813.2132303714752 774.2885649949312 1159.8170500993729 1279.3009054660797 1109.0610992908478 )
set r_array = ( 3.650176704972982e-06 2.7500368031859395e-06 6.397266288399696e-06 3.216567554622888e-06 5.1199954497814175e-06 5.4808873432874676e-06 4.0047338354587556e-06 4.38351382791996e-06 6.56095614016056e-06 5.917980571389198e-06 3.299912952929735e-06 5.352418695688248e-06 5.537682672142982e-06 4.368725021481514e-06 6.2134473520517346e-06 4.824189593195915e-06 3.19492592766881e-06 4.436094512343407e-06 5.8502820628881455e-06 3.2723159837722777e-06 5.91787037730217e-06 4.389808301925659e-06 3.625537597686052e-06 4.016531755328178e-06 5.437635381817818e-06 3.2775616581737995e-06 4.366566737294197e-06 5.866523956060409e-06 5.1092663902044295e-06 2.953699112981558e-06 4.696430166363716e-06 5.899407168030738e-06 6.56374116718769e-06 5.485723813176155e-06 3.992386956810951e-06 4.335406174063682e-06 3.986036603450775e-06 6.343448211550712e-06 4.436007340550423e-06 6.108903561830521e-06 5.483053674101829e-06 4.035436187982559e-06 3.987364743947982e-06 4.3726687628030775e-06 5.4928844171762465e-06 3.9957088726758956e-06 6.489992936253547e-06 4.03108273923397e-06 5.396637369990349e-06 2.927599039971828e-06 5.494871934056282e-06 4.74697818338871e-06 3.985341017246246e-06 2.823637093529105e-06 6.152277787327766e-06 2.939873331338167e-06 4.331349556446075e-06 3.989111085534096e-06 5.547766436934471e-06 3.6264409433305263e-06 5.894208599925041e-06 2.7866221341490746e-06 4.000568141341209e-06 5.103890349268913e-06 3.2047937746345995e-06 6.5731016296148295e-06 6.207483013272285e-06 4.8049807298183435e-06 3.6030914197862145e-06 5.8671017485857005e-06 4.435026769638061e-06 4.435440053343773e-06 3.997670014500617e-06 2.753994570225477e-06 3.5933171148598193e-06 4.422725935578346e-06 3.2316892343759535e-06 5.514944468736648e-06 3.630040803104639e-06 6.5596279996633525e-06 3.6221503029763695e-06 6.311033715605735e-06 6.128153552412986e-06 3.204828140437603e-06 4.035427917838097e-06 5.495816071629524e-06 6.081852589845657e-06 6.560193945765495e-06 3.9690995711088175e-06 4.009143834114075e-06 3.2169369171559807e-06 5.3653404611349106e-06 4.363782604336738e-06 2.750362915098667e-06 5.558447663784027e-06 5.8630965399742125e-06 5.56365629017353e-06 6.206175436377525e-06 6.22817849099636e-06 5.489204202890396e-06 3.1782540987432e-06 4.016479675769806e-06 3.652984307259321e-06 2.8670881251990795e-06 6.465900887846946e-06 4.435753871798515e-06 4.783344690799713e-06 3.2156423042714596e-06 3.6011707346141335e-06 3.1785286898910998e-06 2.7705291594564915e-06 6.59424950659275e-06 3.2947289134562015e-06 5.566841860413551e-06 5.190542240738868e-06 3.6305211420357224e-06 4.023408492207527e-06 5.876799275279045e-06 5.497082968354224e-06 3.6275737296044826e-06 3.6071384261548516e-06 5.39050092279911e-06 2.800691940933466e-06 3.18346417799592e-06 6.2814619141817085e-06 4.825931240916252e-06 4.807148178219795e-06 4.368276422023773e-06 2.9508490423858163e-06 6.286069502234458e-06 4.032534484863281e-06 2.882574836835265e-06 5.853059490323066e-06 4.018309389352798e-06 6.146423419117927e-06 2.830295118615031e-06 2.7888067933917043e-06 5.167709936499595e-06 3.234142393916845e-06 2.749598960503936e-06 3.990122725367546e-06 6.210507203936576e-06 4.702239831089973e-06 4.364987586736679e-06 4.035497431755066e-06 5.073521708250045e-06 5.153887395858764e-06 5.037611846923828e-06 4.751299669146538e-06 5.8552526432275765e-06 3.6283316771686075e-06 6.179644589424133e-06 6.23701547563076e-06 6.228542377352714e-06 2.9074189375340935e-06 6.588818033337593e-06 5.495812495350838e-06 5.188535054326057e-06 3.221483261436224e-06 3.6021204601228235e-06 6.209455330967903e-06 6.233609070181846e-06 4.374326144456863e-06 4.38198183953762e-06 5.566568722128868e-06 3.6322900588810444e-06 6.259257693886756e-06 )
set i = 167
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata NgSpicePipeline/out/r-test.csv $r_array[$&index]
    wrdata NgSpicePipeline/out/w-test.csv $w_array[$&index]
    wrdata NgSpicePipeline/out/bw-test.csv bw
    wrdata NgSpicePipeline/out/pw-test.csv pw
    wrdata NgSpicePipeline/out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

