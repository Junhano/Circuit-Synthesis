nmos: cs amp

.include NgSpicePipeline/assets/45nm_CS.pm

.option TEMP=27C

V6 net2 0 dc 822.6m ac 1
Vdd net1 0 dc 1.2
R0 net1 out 500
mn0 out net2 0 0 NMOS W=5u L=45n

.control
set w_array = ( 1172.7675688266754 1050.1915153861046 1309.4922614097595 1028.973916620016 1134.614723622799 931.8973471224308 879.0853154659271 678.1524204462767 1148.9463385939598 924.4794991612434 921.1810168623924 1129.2619061470032 1007.2543759644032 851.7612364888191 628.360774628818 983.5062180459499 643.9910705015063 705.6422275304794 1077.9985305666924 941.674457192421 1178.2994282245636 937.2606877982616 819.9948672950268 1391.8420058488846 1174.9042701721191 1257.1556669473648 638.4059988707304 1289.4747745990753 936.276153922081 961.7121052742004 1012.7138023078442 1126.856469810009 1373.7145644426346 928.2207918167114 660.9271713346243 781.5596413612366 1299.6132385730743 1015.4452611505985 857.5017650425434 801.1157301068306 947.9974989593029 923.0896745622158 1235.883657336235 737.8986385464668 955.4937545955181 1420.5178734660149 1353.71050208807 1048.2419204711914 1260.64159989357 1184.6007597446442 659.6848559379578 1373.248691558838 688.2992070913315 993.6604176461697 953.3713874220848 929.0890787541866 1221.9355490803719 670.79758875072 767.0559917390347 754.9534019827843 1333.2013261318207 1378.538419008255 934.518066495657 999.8623196780682 1346.9476741552353 1094.4412764906883 1339.1211178898811 824.7638192772865 741.5595319867134 1218.3476787805557 798.4621380269527 1165.5784529447556 1173.1359791755676 632.1763382107019 933.6695720255375 982.6517243683338 1159.1456797719002 963.2990677654743 1430.8075469732285 1264.8839247226715 794.2582056671381 716.9801642000675 1223.8833245635033 1217.0478177070618 732.7885799854994 1173.6264389753342 659.8118104785681 688.3186676353216 1421.7589718103409 832.2222356498241 671.2483283877373 1403.1349730491638 863.0693738162518 1367.696965932846 946.1434733867645 687.751607298851 654.6416276879609 1446.7601281404495 1374.0065586566925 1116.4620560407639 1071.3468354940414 967.8579491376877 724.8834070563316 692.8469628840685 687.2578467056155 978.729226142168 1264.3946450948715 1273.5833165049553 1326.19395673275 1271.8566757440567 1304.3363359570503 1294.1087198257446 1324.867148399353 696.5586344525218 1376.1779275536537 1241.3167756795883 1329.229063987732 1065.3017979860306 750.46047501266 1369.6242851018906 1184.105923473835 905.1303339004517 764.9356652796268 1417.7787926793098 1061.610760986805 835.7570473849773 1335.958109498024 748.8536339998245 1181.2839356064796 1298.3777952194214 1110.9458339214325 1271.4534503221512 728.2372345030308 1043.0663254857063 890.5529972910881 1301.7839682102203 1356.748018860817 1091.4837655425072 1265.967322587967 1211.1228626966476 1409.5346030592918 1298.3636331558228 694.5833892375231 1036.8040379881859 1340.982101559639 638.1830078363419 1059.8471906781197 819.4521848857403 1167.6953864097595 1059.4152969121933 1183.6849462985992 1155.29531955719 1432.4098762869835 884.5672388374805 628.6885305121541 759.6828673779964 819.6050417423248 1200.433750152588 835.7249860465527 1027.1272425353527 881.3545402884483 900.9865534305573 654.77847231552 643.612972907722 1021.2575589120388 1381.5908354520798 841.2979055941105 )
set r_array = ( 6.266858850717544e-06 3.664886386245489e-06 4.02923682063818e-06 3.2904836750775576e-06 6.271903415322303e-06 3.292995172664523e-06 5.555977125763893e-06 4.449059193134307e-06 3.6543641920387744e-06 4.051260103583336e-06 3.292297686561942e-06 5.903816272616386e-06 2.9115821939148005e-06 3.286814385205507e-06 5.917115335464477e-06 4.423920300900936e-06 6.291813676357269e-06 4.818918605446815e-06 3.285363561585545e-06 3.6725510220229624e-06 2.9116188577562567e-06 3.2932822528481484e-06 5.185772602558135e-06 4.030764673948288e-06 4.401381139755249e-06 4.772040520906448e-06 5.178018112778664e-06 5.143831347227096e-06 3.672541522532701e-06 4.425648202300071e-06 3.2919329061359165e-06 3.6559212143719196e-06 2.951367463096976e-06 5.1780844974517815e-06 2.9024772398360074e-06 5.5597013729810715e-06 5.514223625063896e-06 5.546296139359474e-06 6.307353501319885e-06 4.063868497610092e-06 3.293715960457921e-06 4.803512443900108e-06 4.398726199865341e-06 6.670031522512436e-06 5.926887964010238e-06 5.1343852776288984e-06 4.031021607220173e-06 5.167553697824478e-06 3.657528528124094e-06 5.1508828747272485e-06 5.551198099851608e-06 6.586422597169876e-06 3.2977051316946745e-06 5.54863077878952e-06 3.2938567205518484e-06 4.427856219112873e-06 6.2601797032356255e-06 5.927971799969673e-06 2.9061710048653183e-06 5.189121340513229e-06 3.6639839346706866e-06 6.584628199338912e-06 4.427499597072601e-06 4.422404294013977e-06 4.400160511136055e-06 3.2838412403315303e-06 5.14136527955532e-06 5.9339260804653165e-06 4.074499433040618e-06 4.7735582041740415e-06 5.187523414492607e-06 3.653679334670305e-06 6.630562816858291e-06 6.664388154745101e-06 5.928821836709976e-06 6.294422124624252e-06 4.027702038288116e-06 3.672248547077179e-06 6.5646736818552015e-06 4.026891787648201e-06 2.9031049046851694e-06 4.820054520964622e-06 4.773272995948791e-06 3.286115613877773e-06 5.188279126882553e-06 5.151970063447952e-06 5.1799913245439525e-06 6.6636648523807526e-06 4.766621117591858e-06 4.4381481903791426e-06 6.300014530420303e-06 5.502421905398368e-06 5.182165031433105e-06 4.770104413032531e-06 4.050365810394287e-06 6.3033994781970975e-06 3.296379058733582e-06 3.6577766324579715e-06 6.2314004945755e-06 3.282299556881189e-06 4.037928071916103e-06 4.049201284646988e-06 4.076173802018165e-06 5.555178050994873e-06 5.55455443739891e-06 4.04846602410078e-06 2.9316504468396306e-06 3.2945737923681734e-06 5.879019473791122e-06 3.658574142605066e-06 5.882128601074219e-06 5.51470709323883e-06 4.3998491513729095e-06 4.077371520102024e-06 5.506248523592948e-06 2.92560356028378e-06 4.770976801514626e-06 4.41447188436985e-06 4.821299512982368e-06 5.871861999034881e-06 5.524938379526138e-06 3.2910158421099186e-06 6.3093521940708155e-06 5.861785386800766e-06 3.2870665407925844e-06 6.308298979997635e-06 6.597982918024063e-06 6.671042268276214e-06 4.026382167935371e-06 6.2479141849279396e-06 3.282621170505881e-06 5.886395101547241e-06 4.8208627599477765e-06 4.792895143032074e-06 4.805969794392585e-06 3.2989584497362373e-06 4.770441924333572e-06 5.536488865613937e-06 5.8870723593235015e-06 5.893614267110824e-06 3.663570650964975e-06 4.028634329438209e-06 2.90992931753397e-06 6.648529146909713e-06 3.3036384015530345e-06 3.295851445868611e-06 4.4152164208889005e-06 6.308817540407181e-06 5.526773904561996e-06 4.790821124911308e-06 6.265412916541099e-06 3.2815376418828962e-06 4.765461062192917e-06 5.9318583208322526e-06 4.448443402647972e-06 5.559691091179847e-06 6.673465197086333e-06 6.626642768383026e-06 5.5578575778007506e-06 4.419421901106834e-06 4.053268854618072e-06 6.668529485464096e-06 4.812844296097755e-06 6.661773895025253e-06 4.795449053049087e-06 5.50553796172142e-06 6.672943060398101e-06 )
set i = 167
let index = 1
repeat $i
    let r_test = $r_array[$&index]
    alter @mn0[w] = $w_array[$&index]
    alter R0 = r_test
    op
    let gm = @mn0[gm]
    let ro = 1/@mn0[gds]
    let a0 = gm*r_test
    let id = @mn0[id]
    let pw = id*1.2
    let cgd = @mn0[cgd]
    let cdb = abs(@mn0[cdb])
    let cp = (1+a0)*cgd+cdb
    let bw = 1/(2*pi*r_test*cp)
    wrdata NgSpicePipeline/out/r-test.csv $r_array[$&index]
    wrdata NgSpicePipeline/out/w-test.csv $w_array[$&index]
    wrdata NgSpicePipeline/out/bw-test.csv bw
    wrdata NgSpicePipeline/out/pw-test.csv pw
    wrdata NgSpicePipeline/out/a0-test.csv a0
    set appendwrite
    let index = index + 1
end

.endc

.end

